{"version":3,"file":"keigai.min.js","sources":["keigai.js"],"names":["global","format","http","https","lib","mongodb","url","RENDER","TIME","WORKER","document","location","navigator","server","process","webWorker","Blob","Worker","MAX","VERSIONS","CACHE","EVENTS","require","MongoClient","Promise","Storage","localStorage","XMLHttpRequest","btoa","Buffer","LRU","max","this","cache","first","last","length","LRUItem","value","next","previous","Observable","arg","limit","listeners","hooks","Base","observer","KXMLHttpRequest","xhr","observable","factory","defer","deferred","DataListFilter","element","list","debounce","filters","DataGrid","target","store","fields","sortable","options","filtered","sortOrder","order","string","isEmpty","explode","map","i","replace","regex","after_space","create","class","filter","DataList","template","callback","current","emptyMsg","label","noData","id","utility","genId","items","listFilter","mutation","pageIndex","pageSize","pageRange","pagination","placeholder","records","total","where","Deferred","self","promise","onDone","onAlways","onFail","then","array","each","DataStore","autosave","credentials","lists","events","expires","headers","Accept","ignore","index","indexes","key","loaded","source","versions","versioning","views","uri","dispatch","success","failure","state","UNSENT","OPENED","HEADERS_RECEIVED","LOADING","DONE","ERR_REFUSED","ready","RegExp","user-agent","node","capitalize","platform","v8","content-type","accept","fn","dispatchEvent","readyState","call","_error","res","status","statusCode","_resheaders","Array","join","on","setEncoding","_send","responseText","e","test","message","statusText","onabort","onerror","onload","onloadend","onloadstart","onreadystatechange","response","responseType","responseXML","_headers","_params","_request","prototype","base","constructor","abort","getAllResponseHeaders","result","Error","invalidStateNoHeaders","iterate","v","k","getResponseHeader","header","toLowerCase","open","method","async","user","password","invalidStateNoSync","overrideMimeType","mime","send","data","parsed","request","obj","invalidStateNotOpen","invalidStateNotSending","parse","port","protocol","auth","put_post","byteLength","toString","invalidArguments","host","hostname","path","rejectUnauthorized","agent","setSocketKeepAlive","write","end","setRequestHeader","invalidStateNotUsable","bootstrap","client","version","ie","upgrade","undefined","Element","getElementsByClassName","querySelectorAll","documentElement","classList","view","ClassList","getter","proto","descriptor","classes","className","push","updateClassName","HTMLElement","add","contains","remove","toggle","Object","defineProperty","get","enumerable","configurable","__defineGetter__","has","hasOwnProperty","slice","URL","createObjectURL","blob","fromObject","worker","Date","getTime","requestAnimationFrame","offset","external","allow","allow_cors","and","args","bool","caps","cdata","checked_disabled","complete_loaded","csv_quote","del","domain","down","endslash","eol_nl","element_update","get_headers","get_remove_set","hash","header_replace","header_value_replace","html","http_body","http_ports","ip","is_xml","json_maybe","json_wrap","klass","no","not_dotnotation","not_endpoint","null_undefined","number","number_format_1","number_format_2","number_present","number_string","number_string_object","object_type","patch","primitive","priv","radio_checkbox","root","select","selector_is","selector_complex","set_del","space_hyphen","string_object","svg","top_bottom","word","xdomainrequest","xml","lru","evict","item","set","cast","arguments","ev","shift","handler","apply","scope","hook","addEventListener","off","uuid","keys","once","concat","unhook","removeEventListener","listener","addListener","emit","removeListener","binIndex","idx","val","min","Math","floor","o","isNaN","chunk","size","nth","round","start","clear","clone","shallow","indexOf","collect","compact","diff","count","obj1","obj2","repeat","eachReverse","empty","equal","json","encode","fib","sum","second","fill","l","flat","reduce","a","b","forEach","mingle","indexed","intersect","keepIf","keySort","query","sub","queries","split","sorts","braceS","braceE","s","sort","Function","n","mean","median","mid","sorted","odd","merge","mode","values","percents","precision","padding","custom","toFixed","range","rassoc","reject","remaining","removeIf","removeWhile","rest","rindex","rotate","series","ceil","c","d","types","divisor","low","lower","lowered","stddev","sqrt","variance","prev","cur","take","toObject","ar","unique","math","sqr","zip","x","expire","expired","href","property","permission","userAgent","trim","allows","verb","bit","Boolean","permissions","cors","type","setSeconds","getSeconds","exec","timestamp","decode","csv","valid","cached","partial","read","delete","unknown","jsonp","cbid","keigai","clearTimers","resolve","destroy","src","dom","kxhr","payload","contentType","doc","ab","XDomainRequest","Document","ArrayBuffer","notAvailable","delay","toUpperCase","etag","withCredentials","r","t","redirect","xdr","shared","serverError","isUrl","Location","serverUnauthorized","serverForbidden","serverInvalidMethod","scroll","dest","ms","scrollPos","pos","bezier","window","scrollTo","scrollX","scrollY","delimiter","row","rows","coerce","prepare","input","output","ref","attr","update","teardown","escape","refresh","grid","width","css","trimmed","el","innerHTML","unCamelCase","unhyphenate","style","data-field","parentNode","hasClass","currentTarget","record","error","dump","find","field","stop","splice","listFiltered","page","nodeName","MutationObserver","observe","childList","subtree","pages","more","data-page","ceiling","reg","registry","match","walk","compile","li","render","callbacks","childNodes","reverse","$","always","done","fail","appendTo","child","appendChild","namespaceURI","getAttributeNS","setAttributeNS","selected","removeAttribute","setAttribute","getAttribute","reset","fragment","uid","frag","body","createElementNS","createElement","prependChild","after","insertBefore","nextSibling","before","toCamelCase","removeChild","disable","disabled","bubbles","cancelable","CustomEvent","createEvent","initCustomEvent","enable","createDocumentFragment","hidden","display","is","position","left","top","right","bottom","height","offsetWidth","offsetHeight","offsetParent","offsetTop","offsetLeft","removeAttr","removeAttributeNS","serialize","children","elements","name","encodeURIComponent","paddingLeft","paddingRight","borderLeft","borderRight","paddingTop","paddingBottom","borderTop","borderBottom","text","textContent","toggleClass","expectedProperty","checked","selectedIndex","silent","JSON","stringify","expectedNumber","expectedObject","datastoreNoPrevVersion","S0","Q0","Q1","Q2","C0","C1","C2","C3","pop","P","pow","dist","num1","num2","abs","even","every","p","charAt","substring","half","parseFloat","parseInt","random","direction","pCatch","pResolve","pReject","pThen","catch","recs","batch","clauses","cond","functions","cmd","b1","postMessage","sync","deferreds","when","reindex","save","buildUri","pathname","resave","delComplete","purge","f","Number","results","databaseMoreThanOne","only","storage","tmp","setIndexes","restore","overwrite","ogdata","ndata","op","odata","rdefer","setComplete","change","setExpires","delimter","kdx","setUri","authorization","Authorization","decodeURIComponent","mongo","session","sessionStorage","connect","db","close","collection","_id","toArray","rec","safe","w","upsert","defer2","getItem","removeItem","setItem","recordUri","undo","all","hyphenate","camel","isBoolean","isNumber","singular","toFunction","uncapitalize","timer","repeating","BlobBuilder","MSBlobBuilder","WebKitBlobBuilder","MozBlobBuilder","append","getBlob","clearTimeout","__proto__","extend","pattern","modifiers","curry","cfn","setTimeout","setImmediate","nextTick","getElementById","getElementsByTagName","domId","warning","stack","toUTCString","log","String","ts","msg","console","toLocaleTimeString","y","search","queryString","prevent","preventDefault","qstring","prop","race","now","recursive","stopPropagation","srcElement","strip","substr","err","terminate","onmessage","DOMParser","parseFromString","wrap","XMLSerializer","serializeToString","boolean_number_string","util","exports","module","define"],"mappings":"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","sourcesContent":["/**\n * Lightweight data store library, with a utility belt\n *\n * @author Jason Mulligan <jason.mulligan@avoidwork.com>\n * @copyright 2015 Jason Mulligan\n * @license BSD-3 <https://raw.github.com/avoidwork/keigai/master/LICENSE>\n * @link http://keigai.io\n * @module keigai\n * @version 1.0.3\n */\n( function ( global ) {\n\nvar document  = global.document,\n    location  = global.location,\n    navigator = global.navigator,\n    server    = typeof process != \"undefined\",\n    webWorker = typeof Blob != \"undefined\" && typeof Worker != \"undefined\",\n    MAX       = 10,\n    VERSIONS  = 100,\n    CACHE     = 500,\n    EVENTS    = [\"readystatechange\", \"abort\", \"load\", \"loadstart\", \"loadend\", \"error\", \"progress\", \"timeout\"],\n    format, http, https, lib, mongodb, url, RENDER, TIME, WORKER;\n\nif ( server ) {\n\turl     = require( \"url\" );\n\thttp    = require( \"http\" );\n\thttps   = require( \"https\" );\n\tmongodb = require( \"mongodb\" ).MongoClient;\n\tformat  = require( \"util\" ).format;\n\n\tif ( typeof Promise == \"undefined\" ) {\n\t\tPromise = require( \"es6-promise\" ).Promise;\n\t}\n\n\tif ( typeof Storage == \"undefined\" ) {\n\t\tlocalStorage = require( \"localStorage\" );\n\t}\n\n\tif ( typeof XMLHttpRequest == \"undefined\" ) {\n\t\tXMLHttpRequest = null;\n\t}\n\n\tif ( typeof btoa == \"undefined\" ) {\n\t\tbtoa = require( \"btoa\" );\n\t}\n}\nelse if ( typeof Buffer == \"undefined\" ) {\n\tBuffer = function () {};\n}\n\nlib = ( function () {\n\"use strict\";\n\nvar external, has, slice;\n\n/**\n * Regex patterns used through keigai\n *\n * `url` was authored by Diego Perini\n *\n * @namespace regex\n * @private\n * @type {Object}\n */\nvar regex = {\n\tafter_space          : /\\s+.*/,\n\tallow                : /^allow$/i,\n\tallow_cors           : /^access-control-allow-methods$/i,\n\tand                  : /^&/,\n\targs                 : /\\((.*)\\)/,\n\tauth                 : /\\/\\/(.*)\\@/,\n\tbool                 : /^(true|false)?$/,\n\tcaps                 : /[A-Z]/,\n\tcdata                : /\\&|<|>|\\\"|\\'|\\t|\\r|\\n|\\@|\\$/,\n\tchecked_disabled     : /checked|disabled/i,\n\tcomplete_loaded      : /^(complete|loaded)$/i,\n\tcsv_quote            : /^\\s|\\\"|\\n|,|\\s$/,\n\tdel                  : /^del/,\n\tdomain               : /^[\\w.-_]+\\.[A-Za-z]{2,}$/,\n\tdown                 : /down/,\n\tendslash             : /\\/$/,\n\teol_nl               : /\\n$/,\n\telement_update       : /id|innerHTML|innerText|textContent|type|src/,\n\tget_headers          : /^(head|get|options)$/,\n\tget_remove_set       : /get|remove|set/,\n\thash                 : /^\\#/,\n\theader_replace       : /:.*/,\n\theader_value_replace : /.*:\\s+/,\n\thtml                 : /^<.*>$/,\n\thttp_body            : /200|201|202|203|206/,\n\thttp_ports           : /80|443/,\n\thost                 : /\\/\\/(.*)\\//,\n\tie                   : /msie|ie|\\.net|windows\\snt/i,\n\tip                   : /^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/,\n\tis_xml               : /^<\\?xml.*\\?>/,\n\tjson_maybe           : /json|plain|javascript/,\n\tjson_wrap            : /^[\\[\\{]/,\n\tklass                : /^\\./,\n\tno                   : /no-store|no-cache/i,\n\tnot_dotnotation      : /-|\\s/,\n\tnot_endpoint         : /.*\\//,\n\tnull_undefined       : /null|undefined/,\n\tnumber               : /(^-?\\d\\d*\\.\\d*$)|(^-?\\d\\d*$)|(^-?\\.\\d\\d*$)|number/,\n\tnumber_format_1      : /.*\\./,\n\tnumber_format_2      : /\\..*/,\n\tnumber_present       : /\\d{1,}/,\n\tnumber_string        : /number|string/i,\n\tnumber_string_object : /number|object|string/i,\n\tobject_type          : /\\[object Object\\]/,\n\tpatch                : /^patch$/,\n\tprimitive            : /^(boolean|function|number|string)$/,\n\tpriv                 : /private/,\n\tprotocol             : /^(.*)\\/\\//,\n\tput_post             : /^(post|put)$/i,\n\tradio_checkbox       : /^(radio|checkbox)$/i,\n\troot                 : /^\\/[^\\/]/,\n\tselect               : /select/i,\n\tselector_is          : /^:/,\n\tselector_complex     : /\\s+|\\>|\\+|\\~|\\:|\\[/,\n\tset_del              : /^(set|del|delete)$/,\n\tspace_hyphen         : /\\s|-/,\n\tstring_object        : /string|object/i,\n\tsvg                  : /svg/,\n\ttop_bottom           : /top|bottom/i,\n\turl                  : /^(?:(?:https?|ftp):\\/\\/)(?:\\S+(?::\\S*)?@)?(?:(?!10(?:\\.\\d{1,3}){3})(?!127(?:\\.\\d{1,3}){3})(?!169\\.254(?:\\.\\d{1,3}){2})(?!192\\.168(?:\\.\\d{1,3}){2})(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))|(?:(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]+-?)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:\\/[^\\s]*)?$/i,\n\tword                 : /^\\w+$/,\n\txdomainrequest       : /^(get|post)$/i,\n\txml                  : /xml/i\n};\n\n/**\n * @namespace lru\n */\nvar lru = {\n\t/**\n\t * LRU factory\n\t *\n\t * @method factory\n\t * @memberOf lru\n\t * @return {Object} {@link keigai.LRU}\n\t * @example\n\t * var lru = keigai.util.lru( 50 );\n\t */\n\t factory : function ( max ) {\n\t\treturn new LRU( max );\n\t}\n};\n\n/**\n * Creates a new Least Recently Used cache\n *\n * @constructor\n * @memberOf keigai\n * @param  {Number} max [Optional] Max size of cache, default is 1000\n * @example\n * var lru = keigai.util.lru( 50 );\n */\nfunction LRU ( max ) {\n\tthis.cache  = {};\n\tthis.max    = max || 1000;\n\tthis.first  = null;\n\tthis.last   = null;\n\tthis.length = 0;\n}\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.LRU\n * @type {Function}\n * @private\n */\nLRU.prototype.constructor = LRU;\n\n/**\n * Evicts the least recently used item from cache\n *\n * @method evict\n * @memberOf keigai.LRU\n * @return {Object} {@link keigai.LRU}\n * @example\n * lru.evict();\n */\nLRU.prototype.evict = function () {\n\tif ( this.last !== null ) {\n\t\tthis.remove( this.last );\n\t}\n\n\treturn this;\n};\n\n/**\n * Gets cached item and moves it to the front\n *\n * @method get\n * @memberOf keigai.LRU\n * @param  {String} key Item key\n * @return {Object} {@link keigai.LRUItem}\n * @example\n * var item = lru.get( \"key\" );\n */\nLRU.prototype.get = function ( key ) {\n\tvar item = this.cache[key];\n\n\tif ( item === undefined ) {\n\t\treturn;\n\t}\n\n\tthis.set( key, item.value );\n\n\treturn item.value;\n};\n\n/**\n * Removes item from cache\n *\n * @method remove\n * @memberOf keigai.LRU\n * @param  {String} key Item key\n * @return {Object} {@link keigai.LRUItem}\n * @example\n * lru.remove( \"key\" );\n */\nLRU.prototype.remove = function ( key ) {\n\tvar item = this.cache[ key ];\n\n\tif ( item ) {\n\t\tdelete this.cache[key];\n\n\t\tthis.length--;\n\n\t\tif ( item.previous !== null ) {\n\t\t\tthis.cache[item.previous].next = item.next;\n\t\t}\n\n\t\tif ( item.next !== null ) {\n\t\t\tthis.cache[item.next].previous = item.previous;\n\t\t}\n\n\t\tif ( this.first === key ) {\n\t\t\tthis.first = item.previous;\n\t\t}\n\n\t\tif ( this.last === key ) {\n\t\t\tthis.last = item.next;\n\t\t}\n\t}\n\n\treturn item;\n};\n\n/**\n * Sets item in cache as `first`\n *\n * @method set\n * @memberOf keigai.LRU\n * @param  {String} key   Item key\n * @param  {Mixed}  value Item value\n * @return {Object} {@link keigai.LRU}\n * @example\n * lru.set( \"key\", {x: true} );\n */\nLRU.prototype.set = function ( key, value ) {\n\tvar item = this.remove( key );\n\n\tif ( item === undefined ) {\n\t\titem = new LRUItem( value );\n\t}\n\telse {\n\t\titem.value = value;\n\t}\n\n\titem.next       = null;\n\titem.previous   = this.first;\n\tthis.cache[key] = item;\n\n\tif ( this.first !== null ) {\n\t\tthis.cache[this.first].next = key;\n\t}\n\n\tthis.first = key;\n\n\tif ( this.last === null ) {\n\t\tthis.last = key;\n\t}\n\n\tif ( ++this.length > this.max ) {\n\t\tthis.evict();\n\t}\n\n\treturn this;\n};\n\n/**\n * Creates a new LRUItem\n *\n * @constructor\n * @memberOf keigai\n * @param {Mixed} value Item value\n * @private\n */\nfunction LRUItem ( value ) {\n\tthis.next     = null;\n\tthis.previous = null;\n\tthis.value    = value;\n}\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.LRUItem\n * @type {Function}\n */\nLRUItem.prototype.constructor = LRUItem;\n\n/**\n * @namespace observable\n */\nvar observable = {\n\t/**\n\t * Observable factory\n\t *\n\t * @method factory\n\t * @memberOf observable\n\t * @return {Object} {@link keigai.Observable}\n\t * @example\n\t * var observer = keigai.util.observer( 50 );\n\t */\n\t factory : function ( arg ) {\n\t\treturn new Observable( arg );\n\t}\n};\n\n/**\n * Creates a new Observable\n *\n * @constructor\n * @memberOf keigai\n * @param  {Number} arg Maximum listeners, default is 10\n * @example\n * var observer = keigai.util.observer( 50 );\n */\nfunction Observable ( arg ) {\n\tthis.limit     = arg || MAX;\n\tthis.listeners = {};\n\tthis.hooks     = {};\n}\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.Observable\n * @type {Function}\n * @private\n */\nObservable.prototype.constructor = Observable;\n\n/**\n * Dispatches an event, with optional arguments\n *\n * @method dispatch\n * @memberOf keigai.Observable\n * @return {Object} {@link keigai.Observable}\n * @example\n * observer.dispatch( \"event\", ... );\n */\nObservable.prototype.dispatch = function () {\n\tvar args = array.cast( arguments ),\n\t    ev   = args.shift();\n\n\tif ( ev && this.listeners[ev] ) {\n\t\tutility.iterate( this.listeners[ev], function ( i ) {\n\t\t\ti.handler.apply( i.scope, args );\n\t\t} );\n\t}\n\n\treturn this;\n};\n\n/**\n * Hooks into `target` for a DOM event\n *\n * @method hook\n * @memberOf keigai.Observable\n * @param  {Object} target Element\n * @param  {String} ev     Event\n * @return {Object}        Element\n * @example\n * observer.hook( document.querySelector( \"a\" ), \"click\" );\n */\nObservable.prototype.hook = function ( target, ev ) {\n\tvar self = this;\n\n\tif ( typeof target.addEventListener != \"function\" ) {\n\t\tthrow new Error( label.invalidArguments );\n\t}\n\n\tutility.genId( target );\n\n\tthis.hooks[target.id] = function ( arg ) {\n\t\tself.dispatch( ev, arg );\n\t};\n\n\ttarget.addEventListener( ev, this.hooks[target.id], false );\n\n\treturn target;\n};\n\n/**\n * Removes all, or a specific listener for an event\n *\n * @method off\n * @memberOf keigai.Observable\n * @param {String} ev Event name\n * @param {String} id [Optional] Listener ID\n * @return {Object} {@link keigai.Observable}\n * @example\n * observer.off( \"click\", \"myHook\" );\n */\nObservable.prototype.off = function ( ev, id ) {\n\tif ( this.listeners[ev] ) {\n\t\tif ( id ) {\n\t\t\tdelete this.listeners[ev][id];\n\t\t}\n\t\telse {\n\t\t\tdelete this.listeners[ev];\n\t\t}\n\t}\n\n\treturn this;\n};\n\n/**\n * Adds a listener for an event\n *\n * @method on\n * @memberOf keigai.Observable\n * @param  {String}   ev      Event name\n * @param  {Function} handler Handler\n * @param  {String}   id      [Optional] Handler ID\n * @param  {String}   scope   [Optional] Handler scope, default is `this`\n * @return {Object} {@link keigai.Observable}\n * @example\n * observer.on( \"click\", function ( ev ) {\n *   ...\n * }, \"myHook\" );\n */\nObservable.prototype.on = function ( ev, handler, id, scope ) {\n\tid    = id    || utility.uuid();\n\tscope = scope || this;\n\n\tif ( !this.listeners[ev] ) {\n\t\tthis.listeners[ev] = {};\n\t}\n\n\tif ( array.keys( this.listeners[ev] ).length >= this.limit ) {\n\t\tthrow( new Error( \"Possible memory leak, more than \" + this.limit + \" listeners for event: \" + ev ) );\n\t}\n\n\tthis.listeners[ev][id] = {scope: scope, handler: handler};\n\n\treturn this;\n};\n\n/**\n * Adds a short lived listener for an event\n *\n * @method once\n * @memberOf keigai.Observable\n * @param  {String}   ev      Event name\n * @param  {Function} handler Handler\n * @param  {String}   id      [Optional] Handler ID\n * @param  {String}   scope   [Optional] Handler scope, default is `this`\n * @return {Object} {@link keigai.Observable}\n * @example\n * observer.once( \"click\", function ( ev ) {\n *   ...\n * } );\n */\nObservable.prototype.once = function ( ev, handler, id, scope  ) {\n\tvar self = this;\n\n\tid    = id    || utility.uuid();\n\tscope = scope || this;\n\n\treturn this.on( ev, function () {\n\t\thandler.apply( scope, [].concat( array.cast( arguments ) ) );\n\t\tself.off( ev, id );\n\t}, id, scope );\n};\n\n/**\n * Unhooks from `target` for a DOM event\n *\n * @method unhook\n * @memberOf keigai.Observable\n * @param  {Object} target Element\n * @param  {String} ev     Event\n * @return {Object}        Element\n * @example\n * observer.unhook( document.querySelector( \"a\" ), \"click\" );\n */\nObservable.prototype.unhook = function ( target, ev ) {\n\ttarget.removeEventListener( ev, this.hooks[target.id], false );\n\tdelete this.hooks[target.id];\n\n\treturn target;\n};\n\n/**\n * @namespace base\n * @private\n */\nvar base = {\n\t/**\n\t * Base factory\n\t *\n\t * @memberOf base\n\t * @method factory\n\t * @return {Object} {@link keigai.Base}\n\t */\n\tfactory : function () {\n\t\treturn new Base();\n\t}\n};\n\n/**\n * Base Object\n *\n * @constructor\n * @memberOf keigai\n */\nfunction Base () {\n\t/**\n\t * {@link keigai.Observable}\n\t *\n\t * @abstract\n\t * @type {Object}\n\t */\n\tthis.observer = null;\n}\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.Base\n * @type {Function}\n * @private\n */\nBase.prototype.constructor = Base;\n\n/**\n * Adds an event listener\n *\n * @method addEventListener\n * @memberOf keigai.Base\n * @param  {String}   ev       Event name\n * @param  {Function} listener Function to execute\n * @param  {String}   id       [Optional] Listener ID\n * @param  {String}   scope    [Optional] Listener scope, default is `this`\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.addEventListener( \"event\", function ( ev ) {\n *   ...\n * }, \"myHook\" );\n */\nBase.prototype.addEventListener = function ( ev, listener, id, scope ) {\n\tthis.observer.on( ev, listener, id, scope || this );\n\n\treturn this;\n};\n\n/**\n * Adds an event listener\n *\n * @method addListener\n * @memberOf keigai.Base\n * @param  {String}   ev       Event name\n * @param  {Function} listener Function to execute\n * @param  {String}   id       [Optional] Listener ID\n * @param  {String}   scope    [Optional] Listener scope, default is `this`\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.addEventListener( \"event\", function ( ev ) {\n *   ...\n * }, \"myHook\" );\n */\nBase.prototype.addListener = function ( ev, listener, id, scope ) {\n\tthis.observer.on( ev, listener, id, scope || this );\n\n\treturn this;\n};\n\n/**\n * Dispatches an event, with optional arguments\n *\n * @method dispatch\n * @memberOf keigai.Base\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.dispatch( \"event\", ... );\n */\nBase.prototype.dispatch = function () {\n\tthis.observer.dispatch.apply( this.observer, [].concat( array.cast( arguments ) ) );\n\n\treturn this;\n};\n\n/**\n * Dispatches an event, with optional arguments\n *\n * @method dispatchEvent\n * @memberOf keigai.Base\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.dispatchEvent( \"event\", ... );\n */\nBase.prototype.dispatchEvent = function () {\n\tthis.observer.dispatch.apply( this.observer, [].concat( array.cast( arguments ) ) );\n\n\treturn this;\n};\n\n/**\n * Dispatches an event, with optional arguments\n *\n * @method emit\n * @memberOf keigai.Base\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.emit( \"event\", ... );\n */\nBase.prototype.emit = function () {\n\tthis.observer.dispatch.apply( this.observer, [].concat( array.cast( arguments ) ) );\n\n\treturn this;\n};\n\n/**\n * Hooks into `target` for an event\n *\n * @method hook\n * @memberOf keigai.Base\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.hook( document.querySelector( \"a\" ), \"click\" );\n */\nBase.prototype.hook = function () {\n\tthis.observer.hook.apply( this.observer, [].concat( array.cast( arguments ) ) );\n\n\treturn this;\n};\n\n/**\n * Gets listeners\n *\n * @method listeners\n * @memberOf keigai.Base\n * @param  {String} ev [Optional] Event name\n * @return {Object} Listeners\n * @example\n * keigai.util.iterate( obj.listeners(), function ( fn, id ) {\n *   ...\n * } );\n */\nBase.prototype.listeners = function ( ev ) {\n\treturn ev ? this.observer.listeners[ev] : this.listeners;\n};\n\n/**\n * Removes an event listener\n *\n * @method off\n * @memberOf keigai.Base\n * @param  {String} ev Event name\n * @param  {String} id [Optional] Listener ID\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.off( \"event\", \"myHook\" );\n */\nBase.prototype.off = function ( ev, id ) {\n\tthis.observer.off( ev, id );\n\n\treturn this;\n};\n\n/**\n * Adds an event listener\n *\n * @method on\n * @memberOf keigai.Base\n * @param  {String}   ev       Event name\n * @param  {Function} listener Function to execute\n * @param  {String}   id       [Optional] Listener ID\n * @param  {String}   scope    [Optional] Listener scope, default is `this`\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.on( \"event\", function ( ev ) {\n *   ...\n * }, \"myHook\" );\n */\nBase.prototype.on = function ( ev, listener, id, scope ) {\n\tthis.observer.on( ev, listener, id, scope || this );\n\n\treturn this;\n};\n\n/**\n * Adds a short lived event listener\n *\n * @method once\n * @memberOf keigai.Base\n * @param  {String}   ev       Event name\n * @param  {Function} listener Function to execute\n * @param  {String}   id       [Optional] Listener ID\n * @param  {String}   scope    [Optional] Listener scope, default is `this`\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.once( \"event\", function ( ev ) {\n *   ...\n * } );\n */\nBase.prototype.once = function ( ev, listener, id, scope ) {\n\tthis.observer.once( ev, listener, id, scope || this );\n\n\treturn this;\n};\n\n/**\n * Removes an event listener\n *\n * @method removeEventListener\n * @memberOf keigai.Base\n * @param  {String} ev Event name\n * @param  {String} id [Optional] Listener ID\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.removeListener( \"event\", \"myHook\" );\n */\nBase.prototype.removeEventListener = function ( ev, id ) {\n\tthis.observer.off( ev, id );\n\n\treturn this;\n};\n\n/**\n * Removes an event listener\n *\n * @method removeListener\n * @memberOf keigai.Base\n * @param  {String} ev Event name\n * @param  {String} id [Optional] Listener ID\n * @return {Object} {@link keigai.Base}\n * @example\n * obj.removeListener( \"event\", \"myHook\" );\n */\nBase.prototype.removeListener = function ( ev, id ) {\n\tthis.observer.off( ev, id );\n\n\treturn this;\n};\n\n/**\n * @namespace array\n */\nvar array = {\n\t/**\n\t * Adds 'arg' to 'obj' if it is not found\n\t *\n\t * @method add\n\t * @memberOf array\n\t * @param  {Array} obj Array to receive 'arg'\n\t * @param  {Mixed} arg Argument to set in 'obj'\n\t * @return {Array}     Array that was queried\n\t * @example\n\t * var myArray = [1, 2];\n\t *\n\t * keigai.util.array.add( myArray, 3 ); // [1, 2, 3]\n\t * keigai.util.array.add( myArray, 1 ); // [1, 2, 3]\n\t */\n\tadd : function ( obj, arg ) {\n\t\tif ( !array.contains( obj, arg ) ) {\n\t\t\tobj.push( arg );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Preforms a binary search on a sorted Array\n\t *\n\t * @method binIndex\n\t * @memberOf array\n\t * @param  {Array} obj Array to search\n\t * @param  {Mixed} arg Value to find index of\n\t * @return {Number}    Index of `arg` within `obj`\n\t * @example\n\t * var myArray = [1, 5, 10, 15, 20, 25, ...];\n\t *\n\t * keigai.util.array.binIndex( myArray, 5 ); // 1\n\t */\n\tbinIndex : function ( obj, arg ) {\n\t\tvar min = 0,\n\t\t    max = obj.length - 1,\n\t\t    idx, val;\n\n\t\twhile ( min <= max ) {\n\t\t\tidx = Math.floor( ( min + max ) / 2 );\n\t\t\tval = obj[idx];\n\n\t\t\tif ( val < arg ) {\n\t\t\t\tmin = idx + 1;\n\t\t\t}\n\t\t\telse if ( val > arg ) {\n\t\t\t\tmax = idx - 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn idx;\n\t\t\t}\n\t\t}\n\n\t\treturn -1;\n\t},\n\n\t/**\n\t * Returns an Object ( NodeList, etc. ) as an Array\n\t *\n\t * @method cast\n\t * @memberOf array\n\t * @param  {Object}  obj Object to cast\n\t * @param  {Boolean} key [Optional] Returns key or value, only applies to Objects without a length property\n\t * @return {Array}       Object as an Array\n\t * @example\n\t * keigai.util.array.cast( document.querySelectorAll( \"...\" ) );\n\t */\n\tcast : function ( obj, key ) {\n\t\tkey   = ( key === true );\n\t\tvar o = [];\n\n\t\tif ( !isNaN( obj.length ) ) {\n\t\t\to = slice.call( obj );\n\t\t}\n\t\telse if ( key ) {\n\t\t\to = array.keys( obj );\n\t\t}\n\t\telse {\n\t\t\tutility.iterate( obj, function ( i ) {\n\t\t\t\to.push( i );\n\t\t\t} );\n\t\t}\n\n\t\treturn o;\n\t},\n\n\t/**\n\t * Transforms an Array to a 2D Array of chunks\n\t *\n\t * @method chunk\n\t * @memberOf array\n\t * @param  {Array}  obj  Array to process\n\t * @param  {Number} size Chunk size ( integer )\n\t * @return {Array}       Chunked Array\n\t * @example\n\t * keigai.util.array.chunk( [0, 1, 2, 3], 2 ); // [[0, 1], [2, 3]]\n\t */\n\tchunk : function ( obj, size ) {\n\t\tvar result = [],\n\t\t    nth    = number.round( ( obj.length / size ), \"up\" ),\n\t\t    start  = 0,\n\t\t    i      = -1;\n\n\t\twhile ( ++i < nth ) {\n\t\t\tstart = i * size;\n\t\t\tresult.push( array.limit( obj, start, size ) );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Clears an Array without destroying it\n\t *\n\t * @method clear\n\t * @memberOf array\n\t * @param  {Array} obj Array to clear\n\t * @return {Array}     Cleared Array\n\t * @example\n\t * var myArray = [1, 2, 3, 4, 5];\n\t *\n\t * keigai.util.array.clear( myArray );\n\t * myArray.length; // 0\n\t */\n\tclear : function ( obj ) {\n\t\treturn obj.length > 0 ? array.remove( obj, 0, obj.length ) : obj;\n\t},\n\n\t/**\n\t * Clones an Array\n\t *\n\t * @method clone\n\t * @memberOf array\n\t * @param  {Array}   obj     Array to clone\n\t * @param  {Boolean} shallow [Optional] Default is `true`\n\t * @return {Array}           Clone of Array\n\t * @example\n\t * var myArray      = [1, 2, 3, 4, 5],\n\t *     myArrayClone = keigai.util.array.clone( myArray );\n\t *\n\t * myArrayClone.push( 6 );\n\t *\n\t * myArray.length;      // 5\n\t * myArrayClone.length; // 6\n\t */\n\tclone : function ( obj, shallow ) {\n\t\treturn utility.clone( obj, shallow !== false );\n\t},\n\n\t/**\n\t * Determines if obj contains arg\n\t *\n\t * @method contains\n\t * @memberOf array\n\t * @param  {Array} obj Array to search\n\t * @param  {Mixed} arg Value to look for\n\t * @return {Boolean}   True if found, false if not\n\t * @example\n\t * if ( keigai.util.array.contains( [1], 1 ) ) { ... }\n\t */\n\tcontains : function ( obj, arg ) {\n\t\treturn obj.indexOf( arg ) > -1;\n\t},\n\n\t/**\n\t * Creates a new Array of the result of `fn` executed against every index of `obj`\n\t *\n\t * @method collect\n\t * @memberOf array\n\t * @param  {Array}    obj Array to iterate\n\t * @param  {Function} fn  Function to execute against indices\n\t * @return {Array}        New Array\n\t * @example\n\t * var results = keigai.util.array.collect( [...], function ( ... ) { ... } );\n\t */\n\tcollect : function ( obj, fn ) {\n\t\tvar result = [];\n\n\t\tarray.each( obj, function ( i ) {\n\t\t\tresult.push( fn( i ) );\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Compacts a Array by removing `null` or `undefined` indices\n\t *\n\t * @method compact\n\t * @memberOf array\n\t * @param  {Array}   obj  Array to compact\n\t * @param  {Boolean} diff Indicates to return resulting Array only if there's a difference\n\t * @return {Array}        Compacted copy of `obj`, or null ( if `diff` is passed & no diff is found )\n\t * @example\n\t * keigai.util.array.compact( [null, \"a\", \"b\", \"c\", null, \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\n\t * keigai.util.array.compact( [\"a\", \"b\", \"c\", \"d\"], true );       // null\n\t */\n\tcompact : function ( obj, diff ) {\n\t\tdiff = ( diff === true );\n\t\tvar result;\n\n\t\tresult = obj.filter( function ( i ) {\n\t\t\treturn !regex.null_undefined.test( i );\n\t\t} );\n\n\t\treturn !diff ? result : ( result.length < obj.length ? result : null );\n\t},\n\n\t/**\n\t * Counts `value` in `obj`\n\t *\n\t * @method count\n\t * @memberOf array\n\t * @param  {Array} obj   Array to search\n\t * @param  {Mixed} value Value to compare\n\t * @return {Array}       Array of counts\n\t * @example\n\t * keigai.util.array.count( [\"apple\", \"banana\", \"orange\", \"apple\"], \"apple\" ); // 2\n\t */\n\tcount : function ( obj, value ) {\n\t\treturn obj.filter( function ( i ) {\n\t\t\treturn ( i === value );\n\t\t} ).length;\n\t},\n\n\t/**\n\t * Finds the difference between two Arrays\n\t *\n\t * @method diff\n\t * @memberOf array\n\t * @param  {Array} obj1 Source Array\n\t * @param  {Array} obj2 Comparison Array\n\t * @return {Array}      Array of the differences\n\t * @example\n\t * keigai.util.array.diff( [\"a\"], [\"a\", \"b\"] ); // [\"b\"]\n\t */\n\tdiff : function ( obj1, obj2 ) {\n\t\tvar result = [];\n\n\t\tarray.each( obj1, function ( i ) {\n\t\t\tif ( !array.contains( obj2, i ) ) {\n\t\t\t\tarray.add( result, i );\n\t\t\t}\n\t\t} );\n\n\t\tarray.each( obj2, function ( i ) {\n\t\t\tif ( !array.contains( obj1, i ) ) {\n\t\t\t\tarray.add( result, i );\n\t\t\t}\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\n\t * Returning `false` halts iteration.\n\t *\n\t * @method each\n\t * @memberOf array\n\t * @param  {Array}    obj   Array to iterate\n\t * @param  {Function} fn    Function to execute on index values\n\t * @param  {Boolean}  async [Optional] Asynchronous iteration\n\t * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n\t * @return {Array}          Array\n\t * @example\n\t * keigai.util.array.each( [ ... ], function ( ... ) { ... } );\n\t * keigai.util.array.each( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n\t */\n\teach : function ( obj, fn, async, size ) {\n\t\tvar nth = obj.length,\n\t\t    i, offset;\n\n\t\tif ( async !== true ) {\n\t\t\ti = -1;\n\t\t\twhile ( ++i < nth ) {\n\t\t\t\tif ( fn.call( obj, obj[i], i ) === false ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tsize   = size || 10;\n\t\t\toffset = 0;\n\n\t\t\tif ( size > nth ) {\n\t\t\t\tsize = nth;\n\t\t\t}\n\n\t\t\tutility.repeat( function () {\n\t\t\t\tvar i = -1,\n\t\t\t\t    idx;\n\n\t\t\t\twhile ( ++i < size ) {\n\t\t\t\t\tidx = i + offset;\n\n\t\t\t\t\tif ( idx === nth || fn.call( obj, obj[idx], idx ) === false ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toffset += size;\n\n\t\t\t\tif ( offset >= nth ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}, undefined, undefined, false );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Iterates `obj` in reverse and executes `fn` with arguments [`value`, `index`].\n\t * Returning `false` halts iteration.\n\t *\n\t * @method eachReverse\n\t * @memberOf array\n\t * @param  {Array}    obj   Array to iterate\n\t * @param  {Function} fn    Function to execute on index values\n\t * @param  {Boolean}  async [Optional] Asynchronous iteration\n\t * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n\t * @return {Array}          Array\n\t * @example\n\t * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... } );\n\t * keigai.util.array.eachReverse( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n\t */\n\teachReverse : function ( obj, fn, async, size ) {\n\t\tvar nth = obj.length,\n\t\t\ti, offset;\n\n\t\tif ( async !== true ) {\n\t\t\ti = nth;\n\t\t\twhile ( --i > -1 ) {\n\t\t\t\tif ( fn.call( obj, obj[i], i ) === false ) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tsize   = size || 10;\n\t\t\toffset = nth - 1;\n\n\t\t\tif ( size > nth ) {\n\t\t\t\tsize = nth;\n\t\t\t}\n\n\t\t\tutility.repeat( function () {\n\t\t\t\tvar i = -1,\n\t\t\t\t\tidx;\n\n\t\t\t\twhile ( ++i < size ) {\n\t\t\t\t\tidx = offset - i;\n\n\t\t\t\t\tif ( idx < 0 || fn.call( obj, obj[idx], idx ) === false ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\toffset -= size;\n\n\t\t\t\tif ( offset < 0 ) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}, undefined, undefined, false );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Determines if an Array is empty\n\t *\n\t * @method empty\n\t * @memberOf array\n\t * @param  {Array} obj Array to inspect\n\t * @return {Boolean}   `true` if there's no indices\n\t * @example\n\t * keigai.util.array.empty( [] );    // true\n\t * keigai.util.array.empty( [\"a\"] ); // false\n\t */\n\tempty : function ( obj ) {\n\t\treturn ( obj.length === 0 );\n\t},\n\n\t/**\n\t * Determines if two Arrays are equal\n\t *\n\t * @method equal\n\t * @memberOf array\n\t * @param  {Array} obj1 Array to compare\n\t * @param  {Array} obj2 Array to compare\n\t * @return {Boolean} `true` if the Arrays match\n\t * @example\n\t * keigai.util.array.equal( [\"a\"], [\"a\"] );      // true\n\t * keigai.util.array.equal( [\"a\"], [\"a\", \"b\"] ); // false\n\t */\n\tequal : function ( obj1, obj2 ) {\n\t\treturn ( json.encode( obj1 ) === json.encode( obj2 ) );\n\t},\n\n\t/**\n\t * Fibonacci generator\n\t *\n\t * @method fib\n\t * @memberOf array\n\t * @param  {Number} arg [Optional] Amount of numbers to generate, default is 100\n\t * @return {Array}      Array of numbers\n\t * @example\n\t * keigai.util.array.fib( 5 ) // [1, 1, 2, 3, 5];\n\t * keigai.util.array.fib( 6 ) // [1, 1, 2, 3, 5, 8];\n\t */\n\tfib : function ( arg ) {\n\t\tvar result = [1, 1],\n\t\t    first  = result[0],\n\t\t    second = result[1],\n\t\t    sum;\n\n\t\t// Subtracting 1 to account for `first` & `second`\n\t\targ = ( arg || 100 ) - 1;\n\t\t\n\t\tif ( isNaN( arg ) || arg < 2 ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\twhile ( --arg ) {\n\t\t\tsum    = first + second;\n\t\t\tfirst  = second;\n\t\t\tsecond = sum;\n\t\t\tresult.push( sum );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Fills `obj` with the evalution of `arg`, optionally from `start` to `offset`\n\t *\n\t * @method fill\n\t * @memberOf array\n\t * @param  {Array}  obj   Array to fill\n\t * @param  {Mixed}  arg   String, Number of Function to fill with\n\t * @param  {Number} start [Optional] Index to begin filling at\n\t * @param  {Number} end   [Optional] Offset from start to stop filling at\n\t * @return {Array}        Filled Array\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\"];\n\t *\n\t * keigai.util.array.fill( myArray, function ( i ) { return i + \"a\"; } );\n\t * myArray[0]; // \"aa\"\n\t */\n\tfill : function ( obj, arg, start, offset ) {\n\t\tvar fn  = typeof arg == \"function\",\n\t\t    l   = obj.length,\n\t\t    i   = !isNaN( start ) ? start : 0,\n\t\t    nth = !isNaN( offset ) ? i + offset : l - 1;\n\n\t\tif ( nth > ( l - 1 ) ) {\n\t\t\tnth = l - 1;\n\t\t}\n\n\t\twhile ( i <= nth ) {\n\t\t\tobj[i] = fn ? arg( obj[i] ) : arg;\n\t\t\ti++;\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Returns the first Array index\n\t *\n\t * @method first\n\t * @memberOf array\n\t * @param  {Array} obj The array\n\t * @return {Mixed}     The first node of the array\n\t * @example\n\t * keigai.util.array.first( [\"a\", \"b\"] ); // \"a\"\n\t */\n\tfirst : function ( obj ) {\n\t\treturn obj[0];\n\t},\n\n\t/**\n\t * Flattens a 2D Array\n\t *\n\t * @method flat\n\t * @memberOf array\n\t * @param  {Array} obj 2D Array to flatten\n\t * @return {Array}     Flatten Array\n\t * @example\n\t * keigai.util.array.flat( [[0, 1], [2, 3]] ); // [0, 1, 2, 3]\n\t */\n\tflat : function ( obj ) {\n\t\tvar result = [];\n\n\t\tresult = obj.reduce( function ( a, b ) {\n\t\t\treturn a.concat( b );\n\t\t}, result );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Iterates `obj` and executes `fn` with arguments [`value`, `index`].\n\t * Returning `false` halts iteration.\n\t *\n\t * @method forEach\n\t * @memberOf array\n\t * @see array.each\n\t * @param  {Array}    obj   Array to iterate\n\t * @param  {Function} fn    Function to execute on index values\n\t * @param  {Boolean}  async [Optional] Asynchronous iteration\n\t * @param  {Number}   size  [Optional] Batch size for async iteration, default is 10\n\t * @return {Array}          Array\n\t * @example\n\t * keigai.util.array.forEach( [ ... ], function ( ... ) { ... } );\n\t * keigai.util.array.forEach( [ ... ], function ( ... ) { ... }, true, 100 ); // processing batches of a 100\n\t */\n\tforEach : function ( obj, fn, async, size ) {\n\t\treturn array.each( obj, fn, async, size );\n\t},\n\n\t/**\n\t * Creates a 2D Array from an Object\n\t *\n\t * @method fromObject\n\t * @memberOf array\n\t * @param  {Object} obj Object to convert\n\t * @return {Array}      2D Array\n\t * @example\n\t * keigai.util.array.fromObject( {name: \"John\", sex: \"male\"} ); // [[\"name\", \"John\"], [\"sex\", \"male\"]]\n\t */\n\tfromObject : function ( obj ) {\n\t\treturn array.mingle( array.keys( obj ), array.cast( obj ) );\n\t},\n\n\t/**\n\t * Facade of indexOf\n\t *\n\t * @method index\n\t * @memberOf array\n\t * @param  {Array} obj Array to search\n\t * @param  {Mixed} arg Value to find index of\n\t * @return {Number}    The position of arg in instance\n\t * @example\n\t * keigai.util.array.index( [\"a\", \"b\", \"c\"], \"b\" ); // 1\n\t */\n\tindex : function ( obj, arg ) {\n\t\treturn obj.indexOf( arg );\n\t},\n\n\t/**\n\t * Returns an Associative Array as an Indexed Array\n\t *\n\t * @method indexed\n\t * @memberOf array\n\t * @param  {Array} obj Array to index\n\t * @return {Array}     Indexed Array\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\"];\n\t *\n\t * myArray.prop = \"d\";\n\t * keigai.util.array.indexed( myArray ); [\"a\", \"b\", \"c\", \"d\"];\n\t */\n\tindexed : function ( obj ) {\n\t\tvar indexed = [];\n\n\t\tutility.iterate( obj, function ( v ) {\n\t\t\tindexed.push( v );\n\t\t} );\n\n\t\treturn indexed;\n\t},\n\n\t/**\n\t * Finds the intersections between obj1 and obj2\n\t *\n\t * @method intersect\n\t * @memberOf array\n\t * @param  {Array} obj1 Source Array\n\t * @param  {Array} obj2 Comparison Array\n\t * @return {Array}      Array of the intersections\n\t * @example\n\t * keigai.util.array.intersect( [\"a\", \"b\", \"d\"], [\"b\", \"c\", \"d\"] ); // [\"b\", \"d\"]\n\t */\n\tintersect : function ( obj1, obj2 ) {\n\t\tvar a = obj1.length > obj2.length ? obj1 : obj2,\n\t\t    b = ( a === obj1 ? obj2 : obj1 );\n\n\t\treturn a.filter( function ( key ) {\n\t\t\treturn array.contains( b, key );\n\t\t} );\n\t},\n\n\t/**\n\t * Keeps every element of `obj` for which `fn` evaluates to true\n\t *\n\t * @method keepIf\n\t * @memberOf array\n\t * @param  {Array}    obj Array to iterate\n\t * @param  {Function} fn  Function to test indices against\n\t * @return {Array}        Array\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\"];\n\t *\n\t * keigai.util.array.keepIf( myArray, function ( i ) { return /a|c/.test( i ); } );\n\t * myArray[1]; // \"c\"\n\t */\n\tkeepIf : function ( obj, fn ) {\n\t\tvar result = [],\n\t\t    remove = [];\n\n\t\tresult = obj.filter( fn );\n\t\tremove = array.diff( obj, result );\n\n\t\tarray.each( remove, function ( i ) {\n\t\t\tarray.remove( obj, array.index( obj, i ) );\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Returns the keys in an \"Associative Array\"\n\t *\n\t * @method keys\n\t * @memberOf array\n\t * @param  {Mixed} obj Array or Object to extract keys from\n\t * @return {Array}     Array of the keys\n\t * @example\n\t * keigai.util.array.keys( {abc: true, xyz: false} ); // [\"abc\", \"xyz\"]\n\t */\n\tkeys : function ( obj ) {\n\t\treturn Object.keys( obj );\n\t},\n\n\t/**\n\t * Sorts an Array based on key values, like an SQL ORDER BY clause\n\t *\n\t * @method keySort\n\t * @memberOf array\n\t * @param  {Array}  obj   Array to sort\n\t * @param  {String} query Sort query, e.g. \"name, age desc, country\"\n\t * @param  {String} sub   [Optional] Key which holds data, e.g. \"{data: {}}\" = \"data\"\n\t * @return {Array}        Sorted Array\n\t * @example\n\t * var myArray = [{abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 2, xyz: 5}];\n\t *\n\t * keigai.util.array.keySort( myArray, \"abc\" );           // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 5}, {abc: 123124, xyz: 6}];\n\t * keigai.util.array.keySort( myArray, \"abc, xyz desc\" ); // [{abc: 2, xyz: 5}, {abc: 123124, xyz: 6}, {abc: 123124, xyz: 5}];\n\t */\n\tkeySort : function ( obj, query, sub ) {\n\t\tquery       = query.replace( /\\s*asc/ig, \"\" ).replace( /\\s*desc/ig, \" desc\" );\n\t\tvar queries = string.explode( query ).map( function ( i ) { return i.split( \" \" ); } ),\n\t\t    sorts   = [],\n\t\t    braceS  = \"[\\\"\",\n\t\t    braceE  = \"\\\"]\";\n\n\t\tif ( sub && sub !== \"\" ) {\n\t\t\tsub = \".\" + sub;\n\t\t}\n\t\telse {\n\t\t\tsub = \"\";\n\t\t}\n\n\t\tarray.each( queries, function ( i ) {\n\t\t\tvar s = \".\",\n\t\t\t    e = \"\";\n\n\t\t\tif ( regex.not_dotnotation.test( i[0] ) ) {\n\t\t\t\ts = braceS;\n\t\t\t\te = braceE;\n\t\t\t}\n\n\t\t\tsorts.push( \"try {\" );\n\n\t\t\tif ( i[1] === \"desc\" ) {\n\t\t\t\tsorts.push( \"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return 1;\" );\n\t\t\t\tsorts.push( \"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return -1;\" );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tsorts.push( \"if ( a\" + sub + s + i[0] + e + \" < b\" + sub + s + i[0] + e + \" ) return -1;\" );\n\t\t\t\tsorts.push( \"if ( a\" + sub + s + i[0] + e + \" > b\" + sub + s + i[0] + e + \" ) return 1;\" );\n\t\t\t}\n\n\t\t\tsorts.push( \"} catch (e) {\" );\n\t\t\tsorts.push( \"try {\" );\n\t\t\tsorts.push( \"if ( a\" + sub + s + i[0] + e + \" !== undefined ) return \" + ( i[1] === \"desc\" ? \"-1\" : \"1\") + \";\" );\n\t\t\tsorts.push( \"} catch (e) {}\" );\n\t\t\tsorts.push( \"try {\" );\n\t\t\tsorts.push( \"if ( b\" + sub + s + i[0] + e + \" !== undefined ) return \" + ( i[1] === \"desc\" ? \"1\" : \"-1\") + \";\" );\n\t\t\tsorts.push( \"} catch (e) {}\" );\n\t\t\tsorts.push( \"}\" );\n\t\t} );\n\n\t\tsorts.push( \"return 0;\" );\n\n\t\treturn obj.sort( new Function( \"a\", \"b\", sorts.join( \"\\n\" ) ) );\n\t},\n\n\t/**\n\t * Returns the last index of the Array\n\t *\n\t * @method last\n\t * @memberOf array\n\t * @param  {Array}  obj Array\n\t * @param  {Number} arg [Optional] Negative offset from last index to return\n\t * @return {Mixed}      Last index( s ) of Array\n\t * @example\n\t * var myArray = [1, 2, 3, 4];\n\t *\n\t * keigai.util.array.last( myArray );    // 4\n\t * keigai.util.array.last( myArray, 2 ); // [3, 4]\n\t */\n\tlast : function ( obj, arg ) {\n\t\tvar n = obj.length - 1;\n\n\t\tif ( arg >= ( n + 1 ) ) {\n\t\t\treturn obj;\n\t\t}\n\t\telse if ( isNaN( arg ) || arg === 1 ) {\n\t\t\treturn obj[n];\n\t\t}\n\t\telse {\n\t\t\treturn array.limit( obj, ( n - ( --arg ) ), n );\n\t\t}\n\t},\n\n\t/**\n\t * Returns a limited range of indices from the Array\n\t *\n\t * @method limit\n\t * @memberOf array\n\t * @param  {Array}  obj    Array to iterate\n\t * @param  {Number} start  Starting index\n\t * @param  {Number} offset Number of indices to return\n\t * @return {Array}         Array of indices\n\t * @example\n\t * var myArray = [1, 2, 3, 4];\n\t *\n\t * keigai.util.array.limit( myArray, 0, 2 ); // [1, 2]\n\t * keigai.util.array.limit( myArray, 2, 2 ); // [3, 4]\n\t */\n\tlimit : function ( obj, start, offset ) {\n\t\tvar result = [],\n\t\t    i      = start - 1,\n\t\t    nth    = start + offset,\n\t\t    max    = obj.length;\n\n\t\tif ( max > 0 ) {\n\t\t\twhile ( ++i < nth && i < max ) {\n\t\t\t\tresult.push( obj[i] );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Finds the maximum value in an Array\n\t *\n\t * @method max\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Mixed}     Number, String, etc.\n\t * @example\n\t * keigai.util.array.max( [5, 3, 9, 1, 4] ); // 9\n\t */\n\tmax : function ( obj ) {\n\t\treturn array.last( obj.sort( array.sort ) );\n\t},\n\n\t/**\n\t * Finds the mean of an Array ( of numbers )\n\t *\n\t * @method mean\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Number}    Mean of the Array ( float or integer )\n\t * @example\n\t * keigai.util.array.mean( [1, 3, 5] ); // 3\n\t */\n\tmean : function ( obj ) {\n\t\treturn obj.length > 0 ? ( array.sum( obj ) / obj.length ) : undefined;\n\t},\n\n\t/**\n\t * Finds the median value of an Array ( of numbers )\n\t *\n\t * @method median\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Number}    Median number of the Array ( float or integer )\n\t * @example\n\t * keigai.util.array.median( [5, 1, 3, 8] ); // 4\n\t * keigai.util.array.median( [5, 1, 3] );    // 3\n\t */\n\tmedian : function ( obj ) {\n\t\tvar nth    = obj.length,\n\t\t    mid    = number.round( nth / 2, \"down\" ),\n\t\t    sorted = obj.sort( array.sort );\n\n\t\treturn number.odd( nth ) ? sorted[mid] : ( ( sorted[mid - 1] + sorted[mid] ) / 2 );\n\t},\n\n\t/**\n\t * Merges `arg` into `obj`, excluding duplicate indices\n\t *\n\t * @method merge\n\t * @memberOf array\n\t * @param  {Array} obj1 Array to receive indices\n\t * @param  {Array} obj2 Array to merge\n\t * @return {Array}      First argument\n\t * @example\n\t * var a = [\"a\", \"b\", \"c\"],\n\t *     b = [\"d\"];\n\t *\n\t * keigai.util.array.merge( a, b );\n\t * a[3]; // \"d\"\n\t */\n\tmerge : function ( obj1, obj2 ) {\n\t\tarray.each( obj2, function ( i ) {\n\t\t\tarray.add( obj1, i );\n\t\t} );\n\n\t\treturn obj1;\n\t},\n\n\t/**\n\t * Finds the minimum value in an Array\n\t *\n\t * @method min\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Mixed}     Number, String, etc.\n\t * @example\n\t * keigai.util.array.min( [5, 3, 9, 1, 4] ); // 1\n\t */\n\tmin : function ( obj ) {\n\t\treturn obj.sort( array.sort )[0];\n\t},\n\n\t/**\n\t * Mingles Arrays and returns a 2D Array\n\t *\n\t * @method mingle\n\t * @memberOf array\n\t * @param  {Array} obj1 Array to mingle\n\t * @param  {Array} obj2 Array to mingle\n\t * @return {Array}      2D Array\n\t * @example\n\t * var a = [\"a\", \"b\"],\n\t *     b = [\"c\", \"d\"];\n\t *\n\t * keigai.util.array.mingle( a, b ); // [[\"a\", \"c\"], [\"b\", \"d\"]]\n\t */\n\tmingle : function ( obj1, obj2 ) {\n\t\tvar result;\n\n\t\tresult = obj1.map( function ( i, idx ) {\n\t\t\treturn [i, obj2[idx]];\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Finds the mode value of an Array\n\t *\n\t * @method mode\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Mixed}     Mode value of the Array\n\t * @example\n\t * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10] );     // 7\n\t * keigai.util.array.mode( [1, 3, 7, 1, 2, 10, 7, 7, 3, 10, 10] ); // [7, 10]\n\t */\n\tmode : function ( obj ) {\n\t\tvar values = {},\n\t\t    count  = 0,\n\t\t    mode   = [],\n\t\t    nth, result;\n\n\t\t// Counting values\n\t\tarray.each( obj, function ( i ) {\n\t\t\tif ( !isNaN( values[i] ) ) {\n\t\t\t\tvalues[i]++;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvalues[i] = 1;\n\t\t\t}\n\t\t} );\n\n\t\t// Finding the highest occurring count\n\t\tcount = array.max( array.cast( values ) );\n\n\t\t// Finding values that match the count\n\t\tutility.iterate( values, function ( v, k ) {\n\t\t\tif ( v === count ) {\n\t\t\t\tmode.push( number.parse( k ) );\n\t\t\t}\n\t\t} );\n\n\t\t// Determining the result\n\t\tnth = mode.length;\n\n\t\tif ( nth > 0 ) {\n\t\t\tresult = nth === 1 ? mode[0] : mode;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Creates an Array of percentages from an Array of Numbers (ints/floats)\n\t *\n\t * @method percents\n\t * @memberOf array\n\t * @param  {Array}  obj       Array to iterate\n\t * @param  {Number} precision [Optional] Rounding precision\n\t * @param  {Number} total     [Optional] Value to compare against\n\t * @return {Array}            Array of percents\n\t * @example\n\t * keigai.util.array.percents( [1, 2, 3, 37] ); // [2, 5, 7, 86]\n\t */\n\tpercents : function ( obj, precision, total ) {\n\t\tvar result = [],\n\t\t    custom = false,\n\t\t    last, padding, sum;\n\n\t\tprecision = precision || 0;\n\t\t\n\t\tif ( total === undefined ) {\n\t\t\ttotal = array.sum( obj );\n\t\t}\n\t\telse {\n\t\t\tcustom = true;\n\t\t}\n\n\t\tarray.each( obj, function ( i ) {\n\t\t\tresult.push( number.parse( ( ( i / total ) * 100 ).toFixed( precision ) ) );\n\t\t} );\n\n\t\t// Dealing with the awesomeness of JavaScript \"integers\"\n\t\tif ( !custom ) {\n\t\t\tsum = array.sum( result );\n\n\t\t\tif ( sum < 100 ) {\n\t\t\t\tpadding = number.parse( number.diff( sum, 100 ).toFixed( precision ) );\n\t\t\t\tlast    = array.last( result ) + padding;\n\t\t\t\tresult[result.length - 1] = last;\n\t\t\t}\n\t\t\telse if ( sum > 100 ) {\n\t\t\t\tpadding = number.parse( number.diff( sum, 100 ).toFixed( precision ) );\n\t\t\t\tlast    = number.parse( ( array.last( result ) - padding ).toFixed( precision ) );\n\t\t\t\tresult[result.length - 1] = last;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Finds the range of the Array ( of numbers ) values\n\t *\n\t * @method range\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Number}    Range of the array ( float or integer )\n\t * @example\n\t * keigai.util.array.range( [5, 1, 3, 8] ); // 7\n\t */\n\trange : function ( obj ) {\n\t\treturn array.max( obj ) - array.min( obj );\n\t},\n\n\t/**\n\t * Searches a 2D Array `obj` for the first match of `arg` as a second index\n\t *\n\t * @method rassoc\n\t * @memberOf array\n\t * @param  {Array} obj 2D Array to search\n\t * @param  {Mixed} arg Primitive to find\n\t * @return {Mixed}     Array or undefined\n\t * @example\n\t * keigai.util.array.rassoc( [[1, 3], [7, 2], [4, 3]], 3 ); // [1, 3]\n\t */\n\trassoc : function ( obj, arg ) {\n\t\tvar result;\n\n\t\tarray.each( obj, function ( i, idx ) {\n\t\t\tif ( i[1] === arg ) {\n\t\t\t\tresult = obj[idx];\n\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Returns Array containing the items in `obj` for which `fn()` is not true\n\t *\n\t * @method reject\n\t * @memberOf array\n\t * @param  {Array}    obj Array to iterate\n\t * @param  {Function} fn  Function to execute against `obj` indices\n\t * @return {Array}        Array of indices which fn() is not true\n\t * @example\n\t * keigai.util.array.reject( [0, 1, 2, 3, 4, 5], function ( i ) { return i % 2 > 0; } ); // [0, 2, 4]\n\t */\n\treject : function ( obj, fn ) {\n\t\treturn array.diff( obj, obj.filter( fn ) );\n\t},\n\n\t/**\n\t * Removes indices from an Array without recreating it\n\t *\n\t * @method remove\n\t * @memberOf array\n\t * @param  {Array}  obj   Array to remove from\n\t * @param  {Mixed}  start Starting index, or value to find within obj\n\t * @param  {Number} end   [Optional] Ending index\n\t * @return {Array}        Modified Array\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\", \"d\", \"e\"];\n\t *\n\t * keigai.util.array.remove( myArray, 2, 3 );\n\t * myArray[2]; // \"e\"\n\t */\n\tremove : function ( obj, start, end ) {\n\t\tif ( isNaN( start ) ) {\n\t\t\tstart = obj.indexOf( start );\n\n\t\t\tif ( start === -1 ) {\n\t\t\t\treturn obj;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tstart = start || 0;\n\t\t}\n\n\t\tvar length    = obj.length,\n\t\t    remaining = obj.slice( ( end || start ) + 1 || length );\n\n\t\tobj.length = start < 0 ? ( length + start ) : start;\n\t\tobj.push.apply( obj, remaining );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Deletes every element of `obj` for which `fn` evaluates to true\n\t *\n\t * @method removeIf\n\t * @memberOf array\n\t * @param  {Array}    obj Array to iterate\n\t * @param  {Function} fn  Function to test indices against\n\t * @return {Array}        Array\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\"];\n\t *\n\t * keigai.util.array.removeIf( myArray, function ( i ) { return /a|c/.test( i ); } );\n\t * myArray[0]; // \"b\"\n\t */\n\tremoveIf : function ( obj, fn ) {\n\t\tvar remove = obj.filter( fn );\n\n\t\tarray.each( remove, function ( i ) {\n\t\t\tarray.remove( obj, array.index ( obj, i ) );\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Deletes elements of `obj` until `fn` evaluates to false\n\t *\n\t * @method removeWhile\n\t * @memberOf array\n\t * @param  {Array}    obj Array to iterate\n\t * @param  {Function} fn  Function to test indices against\n\t * @return {Array}        Array\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\"];\n\t *\n\t * keigai.util.array.removeWhile( myArray, function ( i ) { return /a|c/.test( i ); } );\n\t * myArray[0];     // \"b\"\n\t * myArray.length; // 2\n\t */\n\tremoveWhile : function ( obj, fn ) {\n\t\tvar remove = [];\n\n\t\tarray.each( obj, function ( i ) {\n\t\t\tif ( fn( i ) !== false ) {\n\t\t\t\tremove.push( i );\n\t\t\t}\n\t\t\telse {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} );\n\n\t\tarray.each( remove, function ( i ) {\n\t\t\tarray.remove( obj, array.index( obj, i ) );\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Replaces the contents of `obj` with `arg`\n\t *\n\t * @method replace\n\t * @memberOf array\n\t * @param  {Array} obj1 Array to modify\n\t * @param  {Array} obj2 Array to values to push into `obj1`\n\t * @return {Array}      Array to modify\n\t * @example\n\t * var myArray = [\"a\", \"b\", \"c\"];\n\t *\n\t * keigai.util.array.replace( myArray, [true, false] );\n\t * myArray[0];     // true\n\t * myArray.length; // 2\n\t */\n\treplace : function ( obj1, obj2 ) {\n\t\tarray.remove( obj1, 0, obj1.length );\n\t\tarray.each( obj2, function ( i ) {\n\t\t\tobj1.push( i );\n\t\t} );\n\n\t\treturn obj1;\n\t},\n\n\t/**\n\t * Returns the \"rest\" of `obj` from `arg`\n\t *\n\t * @method rest\n\t * @memberOf array\n\t * @param  {Array}  obj Array to process\n\t * @param  {Number} arg [Optional] Start position of subset of `obj` ( positive number only )\n\t * @return {Array}      Array of a subset of `obj`\n\t * @example\n\t * keigai.util.array.rest( [1, 2, 3, 4, 5, 6] );    // [2, 3, 4, 5, 6]\n\t * keigai.util.array.rest( [1, 2, 3, 4, 5, 6], 3 ); // [4, 5, 6]\n\t */\n\trest : function ( obj, arg ) {\n\t\targ = arg || 1;\n\n\t\tif ( arg < 1 ) {\n\t\t\targ = 1;\n\t\t}\n\n\t\treturn array.limit( obj, arg, obj.length );\n\t},\n\n\t/**\n\t * Finds the last index of `arg` in `obj`\n\t *\n\t * @method rindex\n\t * @memberOf array\n\t * @param  {Array} obj Array to search\n\t * @param  {Mixed} arg Primitive to find\n\t * @return {Mixed}     Index or undefined\n\t * @example\n\t * keigai.util.array.rindex( [1, 2, 3, 2, 1], 2 ); // 3\n\t */\n\trindex : function ( obj, arg ) {\n\t\tvar result = -1;\n\n\t\tarray.each( obj, function ( i, idx ) {\n\t\t\tif ( i === arg ) {\n\t\t\t\tresult = idx;\n\t\t\t}\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Returns new Array with `arg` moved to the first index\n\t *\n\t * @method rotate\n\t * @memberOf array\n\t * @param  {Array}  obj Array to rotate\n\t * @param  {Number} arg Index to become the first index, if negative the rotation is in the opposite direction\n\t * @return {Array}      Newly rotated Array\n\t * @example\n\t * keigai.util.array.rotate( [0, 1, 2, 3, 4],  3 )[0] // 2;\n\t * keigai.util.array.rotate( [0, 1, 2, 3, 4], -2 )[0] // 3;\n\t */\n\trotate : function ( obj, arg ) {\n\t\tvar nth = obj.length,\n\t\t    result;\n\n\t\tif ( arg === 0 ) {\n\t\t\tresult = obj;\n\t\t}\n\t\telse {\n\t\t\tif ( arg < 0 ) {\n\t\t\t\targ += nth;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targ--;\n\t\t\t}\n\n\t\t\tresult = array.limit( obj, arg, nth );\n\t\t\tresult = result.concat( array.limit( obj, 0, arg ) );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Generates a series Array\n\t *\n\t * @method series\n\t * @memberOf array\n\t * @param  {Number} start  Start value the series\n\t * @param  {Number} end    [Optional] The end of the series\n\t * @param  {Number} offset [Optional] Offset for indices, default is 1\n\t * @return {Array}         Array of new series\n\t * @example\n\t * keigai.util.array.series( 0, 5 );     // [0, 1, 2, 3, 4]\n\t * keigai.util.array.series( 0, 25, 5 ); // [0, 5, 10, 15, 20]\n\t */\n\tseries : function ( start, end, offset ) {\n\t\tstart      = start  || 0;\n\t\tend        = end    || start;\n\t\toffset     = offset || 1;\n\t\tvar result = [],\n\t\t    n      = -1,\n\t\t    nth    = Math.max( 0, Math.ceil( ( end - start ) / offset ) );\n\n\t\twhile ( ++n < nth ) {\n\t\t\tresult[n]  = start;\n\t\t\tstart     += offset;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Sorts the Array by parsing values\n\t *\n\t * @method sort\n\t * @memberOf array\n\t * @param  {Mixed} a Argument to compare\n\t * @param  {Mixed} b Argument to compare\n\t * @return {Number}  Number indicating sort order\n\t * @example\n\t * keigai.util.array.sort( 2, 3 ); // -1\n\t */\n\tsort : function ( a, b ) {\n\t\tvar types = {a: typeof a, b: typeof b},\n\t\t    c, d, result;\n\n\t\tif ( types.a === \"number\" && types.b === \"number\" ) {\n\t\t\tresult = a - b;\n\t\t}\n\t\telse {\n\t\t\tc = a.toString();\n\t\t\td = b.toString();\n\n\t\t\tif ( c < d ) {\n\t\t\t\tresult = -1;\n\t\t\t}\n\t\t\telse if ( c > d ) {\n\t\t\t\tresult = 1;\n\t\t\t}\n\t\t\telse if ( types.a === types.b ) {\n\t\t\t\tresult = 0;\n\t\t\t}\n\t\t\telse if ( types.a === \"boolean\" ) {\n\t\t\t\tresult = -1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresult = 1;\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Sorts `obj` using `array.sort`\n\t *\n\t * @method sorted\n\t * @memberOf array\n\t * @param  {Array} obj Array to sort\n\t * @return {Array}     Sorted Array\n\t * @example\n\t * var myArray = [5, 9, 2, 4];\n\t *\n\t * keigai.util.array.sorted( myArray );\n\t * myArray[0]; // 2\n\t */\n\tsorted : function ( obj ) {\n\t\treturn obj.sort( array.sort );\n\t},\n\n\t/**\n\t * Splits an Array by divisor\n\t *\n\t * @method split\n\t * @memberOf array\n\t * @param  {Array}  obj     Array to process\n\t * @param  {Number} divisor Integer to divide the Array by\n\t * @return {Array}          Split Array\n\t * @example\n\t * var myArray = [],\n\t *     i       = -1,\n\t *     results;\n\t *\n\t * while ( ++i < 100 ) {\n\t *   myArray.push( i + 1 );\n\t * }\n\t *\n\t * results = keigai.util.array.split( myArray, 21 );\n\t * results.length;     // 21\n\t * results[0].length;  // 5\n\t * results[19].length; // 4\n\t * results[19][0];     // 99\n\t * results[20].length; // 1\n\t * results[20][0];     // 100\n\t */\n\tsplit : function ( obj, divisor ) {\n\t\tvar result  = [],\n\t\t    total   = obj.length,\n\t\t    nth     = Math.ceil( total / divisor ),\n\t\t    low     = Math.floor( total / divisor ),\n\t\t    lower   = Math.ceil( total / nth ),\n\t\t    lowered = false,\n\t\t    start   = 0,\n\t\t    i       = -1;\n\n\t\t// Finding the fold\n\t\tif ( number.diff( total, ( divisor * nth ) ) > nth ) {\n\t\t\tlower = total - ( low * divisor ) + low - 1;\n\t\t}\n\t\telse if ( total % divisor > 0 && lower * nth >= total ) {\n\t\t\tlower--;\n\t\t}\n\n\t\twhile ( ++i < divisor ) {\n\t\t\tif ( i > 0 ) {\n\t\t\t\tstart = start + nth;\n\t\t\t}\n\n\t\t\tif ( !lowered && lower < divisor && i === lower ) {\n\t\t\t\t--nth;\n\t\t\t\tlowered = true;\n\t\t\t}\n\n\t\t\tresult.push( array.limit( obj, start, nth ) );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Finds the standard deviation of an Array ( of numbers )\n\t *\n\t * @method stddev\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Number}    Standard deviation of the Array ( float or integer )\n\t * @example\n\t * keigai.util.array.stddev( [1, 3, 5] ); // 1.632993161855452\n\t */\n\tstddev : function ( obj ) {\n\t\treturn Math.sqrt( array.variance( obj ) );\n\t},\n\n\t/**\n\t * Gets the summation of an Array of numbers\n\t *\n\t * @method sum\n\t * @memberOf array\n\t * @param  {Array} obj Array to sum\n\t * @return {Number}    Summation of Array\n\t * @example\n\t * keigai.util.array.sum( [2, 4, 3, 1] ); // 10\n\t */\n\tsum : function ( obj ) {\n\t\tvar result = 0;\n\n\t\tif ( obj.length > 0 ) {\n\t\t\tresult = obj.reduce( function ( prev, cur ) {\n\t\t\t\treturn prev + cur;\n\t\t\t} );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Takes the first `n` indices from `obj`\n\t *\n\t * @method take\n\t * @memberOf array\n\t * @param  {Array}  obj Array to process\n\t * @param  {Number} n   Offset from 0 to return\n\t * @return {Array}      Subset of `obj`\n\t * @example\n\t * keigai.util.array.take( [1, 2, 3, 4], 2 ); // [1, 2]\n\t */\n\ttake : function ( obj, n ) {\n\t\treturn array.limit( obj, 0, n );\n\t},\n\n\t/**\n\t * Casts an Array to Object\n\t *\n\t * @method toObject\n\t * @memberOf array\n\t * @param  {Array} ar Array to transform\n\t * @return {Object}   New object\n\t * @example\n\t * keigai.util.array.toObject( [\"abc\", \"def\"] ); // {0: \"abc\", 1: \"def\"}\n\t */\n\ttoObject : function ( ar ) {\n\t\tvar obj = {},\n\t\t    i   = ar.length;\n\n\t\twhile ( i-- ) {\n\t\t\tobj[i.toString()] = ar[i];\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Gets the total keys in an Array\n\t *\n\t * @method total\n\t * @memberOf array\n\t * @param  {Array} obj Array to find the length of\n\t * @return {Number}    Number of keys in Array\n\t * @example\n\t * var myArray = [true, true, false];\n\t *\n\t * myArray.extra = true;\n\t * keigai.util.array.total( myArray ); // 4\n\t */\n\ttotal : function ( obj ) {\n\t\treturn array.indexed( obj ).length;\n\t},\n\n\t/**\n\t * Returns an Array of unique indices of `obj`\n\t *\n\t * @method unique\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Array}     Array of unique indices\n\t * @example\n\t * keigai.util.array.unique( [\"a\", \"b\", \"a\", \"c\", \"b\", \"d\"] ); // [\"a\", \"b\", \"c\", \"d\"]\n\t */\n\tunique : function ( obj ) {\n\t\tvar result = [];\n\n\t\tarray.each( obj, function ( i ) {\n\t\t\tarray.add( result, i );\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Finds the variance of an Array ( of numbers )\n\t *\n\t * @method variance\n\t * @memberOf array\n\t * @param  {Array} obj Array to process\n\t * @return {Number}    Variance of the Array ( float or integer )\n\t * @example\n\t * keigai.util.array.variance( [1, 3, 5] ); // 2.6666666666666665\n\t */\n\tvariance : function ( obj ) {\n\t\tvar nth = obj.length,\n\t\t    n   = 0,\n\t\t    mean;\n\n\t\tif ( nth > 0 ) {\n\t\t\tmean = array.mean( obj );\n\n\t\t\tarray.each( obj, function ( i ) {\n\t\t\t\tn += math.sqr( i - mean );\n\t\t\t} );\n\n\t\t\treturn n / nth;\n\t\t}\n\t\telse {\n\t\t\treturn n;\n\t\t}\n\t},\n\n\t/**\n\t * Converts any arguments to Arrays, then merges elements of `obj` with corresponding elements from each argument\n\t *\n\t * @method zip\n\t * @memberOf array\n\t * @param  {Array} obj  Array to transform\n\t * @param  {Mixed} args Argument instance or Array to merge\n\t * @return {Array}      Array\n\t * @example\n\t * keigai.util.array.zip( [0, 1], 1 ); // [[0, 1], [1, null]]\n\t */\n\tzip : function ( obj, args ) {\n\t\tvar result = [];\n\n\t\t// Preparing args\n\t\tif ( !( args instanceof Array ) ) {\n\t\t\targs = typeof args == \"object\" ? array.cast( args ) : [args];\n\t\t}\n\n\t\tarray.each( args, function ( i, idx ) {\n\t\t\tif ( !( i instanceof Array ) ) {\n\t\t\t\tthis[idx] = [i];\n\t\t\t}\n\t\t} );\n\n\t\t// Building result Array\n\t\tarray.each( obj, function ( i, idx ) {\n\t\t\tresult[idx] = [i];\n\t\t\tarray.each( args, function ( x ) {\n\t\t\t\tresult[idx].push( x[idx] || null );\n\t\t\t} );\n\t\t} );\n\n\t\treturn result;\n\t}\n};\n\n/**\n * @namespace cache\n * @private\n */\nvar cache = {\n\t/**\n\t * Collection URIs\n\t *\n\t * @memberOf cache\n\t * @type {Object}\n\t */\n\tlru : lru.factory( CACHE ),\n\n\t/**\n\t * Expires a URI from the local cache\n\t *\n\t * @method expire\n\t * @memberOf cache\n\t * @param  {String} uri URI of the local representation\n\t * @return {Boolean} `true` if successful\n\t */\n\texpire : function ( uri ) {\n\t\tif ( cache.lru.cache[uri] ) {\n\t\t\tcache.lru.remove( uri );\n\n\t\t\treturn true;\n\t\t}\n\t\telse {\n\t\t\treturn false;\n\t\t}\n\t},\n\n\t/**\n\t * Determines if a URI has expired\n\t *\n\t * @method expired\n\t * @memberOf cache\n\t * @param  {Object} uri Cached URI object\n\t * @return {Boolean}    True if the URI has expired\n\t */\n\texpired : function ( uri ) {\n\t\tvar item = cache.lru.cache[uri];\n\n\t\treturn item && item.value.expires < new Date().getTime();\n\t},\n\n\t/**\n\t * Returns the cached object {headers, response} of the URI or false\n\t *\n\t * @method get\n\t * @memberOf cache\n\t * @param  {String}  uri    URI/Identifier for the resource to retrieve from cache\n\t * @param  {Boolean} expire [Optional] If 'false' the URI will not expire\n\t * @param  {Boolean} silent [Optional] If 'true', the event will not fire\n\t * @return {Mixed}          URI Object {headers, response} or False\n\t */\n\tget : function ( uri, expire ) {\n\t\turi      = utility.parse( uri ).href;\n\t\tvar item = cache.lru.get( uri );\n\n\t\tif ( !item ) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ( expire !== false && cache.expired( uri ) ) {\n\t\t\tcache.expire( uri );\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn utility.clone( item, true );\n\t},\n\n\t/**\n\t * Sets, or updates an item in cache.items\n\t *\n\t * @method set\n\t * @memberOf cache\n\t * @param  {String} uri      URI to set or update\n\t * @param  {String} property Property of the cached URI to set\n\t * @param  {Mixed} value     Value to set\n\t * @return {Mixed}           URI Object {headers, response} or undefined\n\t */\n\tset : function ( uri, property, value ) {\n\t\turi      = utility.parse( uri ).href;\n\t\tvar item = cache.lru.get( uri );\n\n\t\tif ( !item ) {\n\t\t\titem = {\n\t\t\t\tpermission : 0\n\t\t\t};\n\t\t}\n\n\t\tif ( property === \"permission\" ) {\n\t\t\titem.permission |= value;\n\t\t}\n\t\telse if ( property === \"!permission\" ) {\n\t\t\titem.permission &= ~value;\n\t\t}\n\t\telse {\n\t\t\titem[property] = value;\n\t\t}\n\n\t\tcache.lru.set( uri, item );\n\n\t\treturn item;\n\t}\n};\n\n/**\n * Custom Object returned from `client.request()`\n *\n * @constructor\n * @memberOf keigai\n * @extends {keigai.Base}\n * @param {Object} xhr XMLHttpRequest\n */\nfunction KXMLHttpRequest ( xhr ) {\n\tthis.observer = observable.factory();\n\tthis.defer    = deferred.factory();\n\tthis.xhr      = xhr;\n}\n\n/**\n * Extending Base\n *\n * @memberOf keigai.KXMLHttpRequest\n * @type {Object} {@link keigai.Base}\n */\nKXMLHttpRequest.prototype = base.factory();\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.KXMLHttpRequest\n * @type {Function}\n * @private\n */\nKXMLHttpRequest.prototype.constructor = KXMLHttpRequest;\n\n/**\n * @namespace client\n */\nvar client = {\n\t/**\n\t * Internet Explorer browser\n\t *\n\t * @memberOf client\n\t * @type {Boolean}\n\t * @private\n\t */\n\tie : function () {\n\t\treturn !server && regex.ie.test( navigator.userAgent );\n\t}(),\n\n\t/**\n\t * Client version\n\t *\n\t * @memberOf client\n\t * @type {Number}\n\t * @private\n\t */\n\tversion : function () {\n\t\tvar version = 0;\n\n\t\tif ( this.ie ) {\n\t\t\tversion = navigator.userAgent.replace(/(.*msie|;.*)/gi, \"\");\n\t\t\tversion = number.parse( string.trim( version ) || 9, 10 );\n\t\t}\n\n\t\treturn version;\n\t},\n\n\t/**\n\t * Quick way to see if a URI allows a specific verb\n\t *\n\t * @method allows\n\t * @memberOf client\n\t * @param  {String} uri  URI to query\n\t * @param  {String} verb HTTP verb\n\t * @return {Boolean}     `true` if the verb is allowed, undefined if unknown\n\t * @private\n\t */\n\tallows : function ( uri, verb ) {\n\t\tif ( string.isEmpty( uri ) || string.isEmpty( verb ) ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\turi        = utility.parse( uri ).href;\n\t\tverb       = verb.toLowerCase();\n\t\tvar result = false,\n\t\t    bit    = 0;\n\n\t\tif ( !cache.get( uri, false ) ) {\n\t\t\tresult = undefined;\n\t\t}\n\t\telse {\n\t\t\tif ( regex.del.test( verb ) ) {\n\t\t\t\tbit = 1;\n\t\t\t}\n\t\t\telse if ( regex.get_headers.test( verb ) ) {\n\t\t\t\tbit = 4;\n\t\t\t}\n\t\t\telse if ( regex.put_post.test( verb ) ) {\n\t\t\t\tbit = 2;\n\t\t\t}\n\t\t\telse if ( regex.patch.test( verb ) ) {\n\t\t\t\tbit = 8;\n\t\t\t}\n\n\t\t\tresult = Boolean( client.permissions( uri, verb ).bit & bit );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Gets bit value based on args\n\t *\n\t * @method bit\n\t * @memberOf client\n\t * @param  {Array} args Array of commands the URI accepts\n\t * @return {Number} To be set as a bit\n\t * @private\n\t */\n\tbit : function ( args ) {\n\t\tvar result = 0;\n\n\t\tarray.each( args, function ( verb ) {\n\t\t\tverb = verb.toLowerCase();\n\n\t\t\tif ( regex.get_headers.test( verb ) ) {\n\t\t\t\tresult |= 4;\n\t\t\t}\n\t\t\telse if ( regex.put_post.test( verb ) ) {\n\t\t\t\tresult |= 2;\n\t\t\t}\n\t\t\telse if ( regex.patch.test( verb ) ) {\n\t\t\t\tresult |= 8;\n\t\t\t}\n\t\t\telse if ( regex.del.test( verb ) ) {\n\t\t\t\tresult |= 1;\n\t\t\t}\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Determines if a URI is a CORS end point\n\t *\n\t * @method cors\n\t * @memberOf client\n\t * @param  {String} uri  URI to parse\n\t * @return {Boolean}     True if CORS\n\t * @private\n\t */\n\tcors : function ( uri ) {\n\t\treturn ( !server && uri.indexOf( \"//\" ) > -1 && uri.indexOf( \"//\" + location.host ) === -1 );\n\t},\n\n\t/**\n\t * Caches the headers from the XHR response\n\t *\n\t * @method headers\n\t * @memberOf client\n\t * @param  {Object} xhr  XMLHttpRequest Object\n\t * @param  {String} uri  URI to request\n\t * @param  {String} type Type of request\n\t * @return {Object}      Cached URI representation\n\t * @private\n\t */\n\theaders : function ( xhr, uri, type ) {\n\t\tvar headers = string.trim( xhr.getAllResponseHeaders() ).split( \"\\n\" ),\n\t\t    items   = {},\n\t\t    o       = {},\n\t\t    allow   = null,\n\t\t    expires = new Date(),\n\t\t    cors    = client.cors( uri );\n\n\t\tarray.each( headers, function ( i ) {\n\t\t\tvar header = i.split( \": \" );\n\n\t\t\titems[header[0].toLowerCase()] = string.trim( header[1] );\n\n\t\t\tif ( allow === null ) {\n\t\t\t\tif ( ( !cors && regex.allow.test( header ) ) || ( cors && regex.allow_cors.test( header ) ) ) {\n\t\t\t\t\tallow = header[1];\n\t\t\t\t}\n\t\t\t}\n\t\t} );\n\n\t\tif ( regex.no.test( items[\"cache-control\"] ) ) {\n\t\t\texpires = expires.getTime();\n\t\t}\n\t\telse if ( items[\"cache-control\"] && regex.number_present.test( items[\"cache-control\"] ) ) {\n\t\t\texpires = expires.setSeconds( expires.getSeconds() + number.parse( regex.number_present.exec( items[\"cache-control\"] )[0], 10 ) );\n\t\t}\n\t\telse if ( items.expires ) {\n\t\t\texpires = new Date( items.expires ).getTime();\n\t\t}\n\t\telse {\n\t\t\texpires = expires.getTime();\n\t\t}\n\n\t\to.expires    = expires;\n\t\to.headers    = items;\n\t\to.timestamp  = new Date();\n\t\to.permission = client.bit( allow !== null ? string.explode( allow ) : [type] );\n\n\t\tif ( type === \"get\" ) {\n\t\t\tcache.set( uri, \"expires\",    o.expires );\n\t\t\tcache.set( uri, \"headers\",    o.headers );\n\t\t\tcache.set( uri, \"timestamp\",  o.timestamp );\n\t\t\tcache.set( uri, \"permission\", o.permission );\n\t\t}\n\n\t\treturn o;\n\t},\n\n\t/**\n\t * Parses an XHR response\n\t *\n\t * @method parse\n\t * @memberOf client\n\t * @param  {Object} xhr  XHR Object\n\t * @param  {String} type [Optional] content-type header value\n\t * @return {Mixed}       Array, Boolean, Document, Number, Object or String\n\t * @private\n\t */\n\tparse : function ( xhr, type ) {\n\t\ttype = type || \"\";\n\t\tvar result, obj;\n\n\t\tif ( ( regex.json_maybe.test( type ) || string.isEmpty( type ) ) && ( regex.json_wrap.test( xhr.responseText ) && Boolean( obj = json.decode( xhr.responseText, true ) ) ) ) {\n\t\t\tresult = obj;\n\t\t}\n\t\telse if ( type === \"text/csv\" ) {\n\t\t\tresult = csv.decode( xhr.responseText );\n\t\t}\n\t\telse if ( type === \"text/tsv\" ) {\n\t\t\tresult = csv.decode( xhr.responseText, \"\\t\" );\n\t\t}\n\t\telse if ( regex.xml.test( type ) ) {\n\t\t\tif ( type !== \"text/xml\" ) {\n\t\t\t\txhr.overrideMimeType( \"text/xml\" );\n\t\t\t}\n\n\t\t\tresult = xhr.responseXML;\n\t\t}\n\t\telse if ( type === \"text/plain\" && regex.is_xml.test( xhr.responseText ) && xml.valid( xhr.responseText ) ) {\n\t\t\tresult = xml.decode( xhr.responseText );\n\t\t}\n\t\telse {\n\t\t\tresult = xhr.responseText;\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Returns the permission of the cached URI\n\t *\n\t * @method permissions\n\t * @memberOf client\n\t * @param  {String} uri URI to query\n\t * @return {Object}     Contains an Array of available commands, the permission bit and a map\n\t * @private\n\t */\n\tpermissions : function ( uri ) {\n\t\tvar cached = cache.get( uri, false ),\n\t\t    bit    = !cached ? 0 : cached.permission,\n\t\t    result = {allows: [], bit: bit, map: {partial: 8, read: 4, write: 2, \"delete\": 1, unknown: 0}};\n\n\t\tif ( bit & 1 ) {\n\t\t\tresult.allows.push( \"DELETE\" );\n\t\t}\n\n\t\tif ( bit & 2 ) {\n\t\t\tresult.allows.push( \"POST\" );\n\t\t\tresult.allows.push( \"PUT\" );\n\t\t}\n\n\t\tif ( bit & 4 ) {\n\t\t\tresult.allows.push( \"GET\" );\n\t\t}\n\n\t\tif ( bit & 8 ) {\n\t\t\tresult.allows.push( \"PATCH\" );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Creates a JSONP request\n\t *\n\t * @method jsonp\n\t * @memberOf client\n\t * @param  {String} uri  URI to request\n\t * @param  {Mixed}  args Custom JSONP handler parameter name, default is \"callback\"; or custom headers for GET request ( CORS )\n\t * @return {Object} {@link keigai.Deferred}\n\t * @example\n\t * keigai.util.jsonp( \"http://somedomain.com/resource?callback=\", function ( arg ) {\n\t *   // `arg` is the coerced response body\n\t * }, function ( err ) {\n\t *   // Handle `err`\n\t * } );\n\t */\n\tjsonp : function ( uri, args ) {\n\t\tvar defer    = deferred.factory(),\n\t\t    callback = \"callback\",\n\t\t    cbid, s;\n\n\t\tif ( external === undefined ) {\n\t\t\tif ( !global.keigai ) {\n\t\t\t\tglobal.keigai = {callback: {}};\n\t\t\t}\n\n\t\t\texternal = \"keigai\";\n\t\t}\n\n\t\tif ( args instanceof Object && !args.callback ) {\n\t\t\tcallback = args.callback;\n\t\t}\n\n\t\tdo {\n\t\t\tcbid = utility.genId().slice( 0, 10 );\n\t\t}\n\t\twhile ( global.callback[cbid] );\n\n\t\turi = uri.replace( callback + \"=?\", callback + \"=\" + external + \".callback.\" + cbid );\n\n\t\tglobal.callback[cbid] = function ( arg ) {\n\t\t\tutility.clearTimers( cbid );\n\t\t\tdelete global.callback[cbid];\n\t\t\tdefer.resolve( arg );\n\t\t\telement.destroy( s );\n\t\t};\n\n\t\ts = element.create( \"script\", {src: uri, type: \"text/javascript\"}, utility.dom( \"head\" )[0] );\n\t\t\n\t\tutility.defer( function () {\n\t\t\tdefer.reject( undefined );\n\t\t}, 30000, cbid );\n\n\t\treturn defer;\n\t},\n\n\t/**\n\t * KXMLHttpRequest factory\n\t *\n\t * @method kxhr\n\t * @memberOf client\n\t * @param {Object} xhr XMLHttpRequest\n\t * @return {Object} {@link keigai.KXMLHttpRequest}\n\t * @private\n\t */\n\tkxhr : function ( xhr ) {\n\t\tvar obj = new KXMLHttpRequest( xhr );\n\n\t\t// Wrapping deferred methods on obj\n\t\tarray.each( array.keys( Deferred.prototype ), function ( i ) {\n\t\t\tobj[i] = function () {\n\t\t\t\treturn obj.defer[i].apply( obj.defer, array.cast( arguments ) );\n\t\t\t};\n\t\t} );\n\n\t\t// Hooking observer for standard events\n\t\tarray.each( EVENTS, function ( i ) {\n\t\t\tobj.hook( obj.xhr, i );\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Creates an XmlHttpRequest to a URI ( aliased to multiple methods )\n\t *\n\t * The returned Deferred will have an .xhr\n\t *\n\t * @method request\n\t * @memberOf client\n\t * @param  {String}   uri     URI to query\n\t * @param  {String}   type    [Optional] Type of request ( DELETE/GET/POST/PUT/PATCH/HEAD/OPTIONS ), default is `GET`\n\t * @param  {Mixed}    args    [Optional] Data to send with the request\n\t * @param  {Object}   headers [Optional] Custom request headers ( can be used to set withCredentials )\n\t * @return {Object}   {@link keigai.KXMLHttpRequest}\n\t * @example\n\t * keigai.util.request( \"http://keigai.io\" ).then( function ( arg ) {\n\t *   // `arg` is the coerced response body\n\t * }, function ( err ) {\n\t *   // Handle `err`\n\t * } );\n\t */\n\trequest : function ( uri, type, args, headers ) {\n\t\tvar cors, kxhr, payload, cached, contentType, doc, ab, blob;\n\n\t\ttype = type || \"GET\";\n\n\t\tif ( ( regex.put_post.test( type ) || regex.patch.test( type ) ) && args === undefined ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\turi         = utility.parse( uri ).href;\n\t\ttype        = type.toLowerCase();\n\t\theaders     = headers instanceof Object ? headers : null;\n\t\tcors        = client.cors( uri );\n\t\tkxhr        = client.kxhr( !client.ie || ( !cors || client.version > 9 ) ? new XMLHttpRequest() : new XDomainRequest() );\n\t\tpayload     = ( regex.put_post.test( type ) || regex.patch.test( type ) ) && args ? args : null;\n\t\tcached      = type === \"get\" ? cache.get( uri ) : false;\n\t\tcontentType = null;\n\t\tdoc         = typeof Document != \"undefined\";\n\t\tab          = typeof ArrayBuffer != \"undefined\";\n\t\tblob        = typeof Blob != \"undefined\";\n\n\t\t// Only GET & POST is supported by XDomainRequest (so useless!)\n\t\tif ( cors && client.ie && client.version === 9 && !regex.xdomainrequest.test( type ) ) {\n\t\t\tthrow new Error( label.notAvailable );\n\t\t}\n\n\t\t// Hooking custom events\n\t\tkxhr.on( \"readystatechange\", function ( ev ) {\n\t\t\tswitch ( this.xhr.readyState ) {\n\t\t\t\tcase 1:\n\t\t\t\t\tthis.dispatch( \"beforeXHR\", this.xhr, ev );\n\t\t\t\t\tbreak;\n\t\t\t\tcase 4:\n\t\t\t\t\tthis.dispatch( \"afterXHR\", this.xhr, ev );\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t} );\n\n\t\tif ( !cors && !regex.get_headers.test( type ) && client.allows( uri, type ) === false ) {\n\t\t\tutility.delay( function () {\n\t\t\t\tkxhr.dispatch( \"beforeXHR\", kxhr.xhr, null );\n\t\t\t\tkxhr.dispatch( \"afterXHR\", kxhr.xhr, null );\n\t\t\t} );\n\n\t\t\tkxhr.xhr.status = 405;\n\t\t\tkxhr.reject( null );\n\t\t}\n\n\t\tif ( type === \"get\" && Boolean( cached ) ) {\n\t\t\t// Decorating XHR for proxy behavior\n\t\t\tif ( server ) {\n\t\t\t\tkxhr.xhr.readyState  = 4;\n\t\t\t\tkxhr.xhr.status      = 200;\n\t\t\t\tkxhr.xhr._resheaders = cached.headers;\n\t\t\t}\n\n\t\t\tutility.delay( function () {\n\t\t\t\tkxhr.dispatch( \"beforeXHR\", kxhr.xhr, null );\n\t\t\t\tkxhr.dispatch( \"afterXHR\", kxhr.xhr, null );\n\t\t\t} );\n\n\t\t\tkxhr.resolve( cached.response );\n\t\t}\n\t\telse {\n\t\t\tutility.delay( function () {\n\t\t\t\tkxhr.xhr.open( type.toUpperCase(), uri, true );\n\n\t\t\t\t// Setting content-type value\n\t\t\t\tif ( headers !== null && headers.hasOwnProperty( \"content-type\" ) ) {\n\t\t\t\t\tcontentType = headers[\"content-type\"];\n\t\t\t\t}\n\n\t\t\t\tif ( cors && contentType === null ) {\n\t\t\t\t\tcontentType = \"text/plain\";\n\t\t\t\t}\n\n\t\t\t\t// Transforming payload\n\t\t\t\tif ( payload !== null ) {\n\t\t\t\t\tif ( payload.hasOwnProperty( \"xml\" ) ) {\n\t\t\t\t\t\tpayload = payload.xml;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( doc && payload instanceof Document ) {\n\t\t\t\t\t\tpayload = xml.decode( payload );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( typeof payload == \"string\" && regex.is_xml.test( payload ) ) {\n\t\t\t\t\t\tcontentType = \"application/xml\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( !( ab && payload instanceof ArrayBuffer ) && !( blob && payload instanceof Blob ) && !( payload instanceof Buffer ) && payload instanceof Object ) {\n\t\t\t\t\t\tcontentType = \"application/json\";\n\t\t\t\t\t\tpayload = json.encode( payload );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( contentType === null && ( ( ab && payload instanceof ArrayBuffer ) || ( blob && payload instanceof Blob ) ) ) {\n\t\t\t\t\t\tcontentType = \"application/octet-stream\";\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( contentType === null ) {\n\t\t\t\t\t\tcontentType = \"application/x-www-form-urlencoded; charset=UTF-8\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Setting headers for everything except IE9 CORS requests\n\t\t\t\tif ( !client.ie || ( !cors || client.version > 9 ) ) {\n\t\t\t\t\tif ( headers === null ) {\n\t\t\t\t\t\theaders = {};\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( typeof cached == \"object\" && cached.headers.hasOwnProperty( \"etag\" ) ) {\n\t\t\t\t\t\theaders.etag = cached.headers.etag;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( contentType !== null ) {\n\t\t\t\t\t\theaders[\"content-type\"] = contentType;\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( headers.hasOwnProperty( \"callback\" ) ) {\n\t\t\t\t\t\tdelete headers.callback;\n\t\t\t\t\t}\n\n\t\t\t\t\theaders[\"x-requested-with\"] = \"XMLHttpRequest\";\n\n\t\t\t\t\tutility.iterate( headers, function ( v, k ) {\n\t\t\t\t\t\tif ( v !== null && k !== \"withCredentials\") {\n\t\t\t\t\t\t\tkxhr.xhr.setRequestHeader( k, v );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\t// Cross Origin Resource Sharing ( CORS )\n\t\t\t\t\tif ( typeof kxhr.xhr.withCredentials == \"boolean\" && headers !== null && typeof headers.withCredentials == \"boolean\" ) {\n\t\t\t\t\t\tkxhr.xhr.withCredentials = headers.withCredentials;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tkxhr.on( \"load\", function () {\n\t\t\t\t\tvar self   = this,\n\t\t\t\t\t    xdr    = client.ie && this.xhr.readyState === undefined,\n\t\t\t\t\t    shared = true,\n\t\t\t\t\t    o, r, t, redirect;\n\n\t\t\t\t\tif ( !xdr && this.xhr.readyState === 4 ) {\n\t\t\t\t\t\tswitch ( this.xhr.status ) {\n\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\tcase 201:\n\t\t\t\t\t\t\tcase 202:\n\t\t\t\t\t\t\tcase 203:\n\t\t\t\t\t\t\tcase 204:\n\t\t\t\t\t\t\tcase 205:\n\t\t\t\t\t\t\tcase 206:\n\t\t\t\t\t\t\t\to = client.headers( this.xhr, uri, type );\n\n\t\t\t\t\t\t\t\tif ( type === \"head\" ) {\n\t\t\t\t\t\t\t\t\treturn this.resolve( o.headers );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if ( type === \"options\" ) {\n\t\t\t\t\t\t\t\t\treturn this.resolve( o.headers );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if ( type !== \"delete\" ) {\n\t\t\t\t\t\t\t\t\tif ( server && regex.priv.test( o.headers[\"cache-control\"] ) ) {\n\t\t\t\t\t\t\t\t\t\tshared = false;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( regex.http_body.test( this.xhr.status ) ) {\n\t\t\t\t\t\t\t\t\t\tt = o.headers[\"content-type\"] || \"\";\n\t\t\t\t\t\t\t\t\t\tr = client.parse( this.xhr, t );\n\n\t\t\t\t\t\t\t\t\t\tif ( r === undefined ) {\n\t\t\t\t\t\t\t\t\t\t\tthis.reject( new Error( label.serverError ) );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\tif ( type === \"get\" && shared ) {\n\t\t\t\t\t\t\t\t\t\tcache.set( uri, \"response\", ( o.response = utility.clone( r, true ) ) );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\tcache.expire( uri, true );\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if ( type === \"delete\" ) {\n\t\t\t\t\t\t\t\t\tcache.expire( uri, true );\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tswitch ( this.xhr.status ) {\n\t\t\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\t\tcase 202:\n\t\t\t\t\t\t\t\t\tcase 203:\n\t\t\t\t\t\t\t\t\tcase 206:\n\t\t\t\t\t\t\t\t\t\tthis.resolve( r );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 201:\n\t\t\t\t\t\t\t\t\t\tif ( ( o.headers.location === undefined || string.isEmpty( o.headers.location ) ) && !string.isUrl( r ) ) {\n\t\t\t\t\t\t\t\t\t\t\tthis.resolve( r );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\tredirect = string.trim ( o.headers.Location || r );\n\t\t\t\t\t\t\t\t\t\t\tclient.request( redirect ).then( function ( arg ) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.resolve ( arg );\n\t\t\t\t\t\t\t\t\t\t\t}, function ( e ) {\n\t\t\t\t\t\t\t\t\t\t\t\tself.reject( e );\n\t\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t\tcase 204:\n\t\t\t\t\t\t\t\t\tcase 205:\n\t\t\t\t\t\t\t\t\t\tthis.resolve( null );\n\t\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 304:\n\t\t\t\t\t\t\t\tthis.resolve( r );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 401:\n\t\t\t\t\t\t\t\tthis.reject( new Error( this.xhr.responseText || label.serverUnauthorized ) );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 403:\n\t\t\t\t\t\t\t\tcache.set( uri, \"!permission\", client.bit( [type] ) );\n\t\t\t\t\t\t\t\tthis.reject( new Error( this.xhr.responseText || label.serverForbidden ) );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase 405:\n\t\t\t\t\t\t\t\tcache.set( uri, \"!permission\", client.bit( [type] ) );\n\t\t\t\t\t\t\t\tthis.reject( new Error( this.xhr.responseText || label.serverInvalidMethod ) );\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tthis.reject( new Error( this.xhr.responseText || label.serverError ) );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ( xdr ) {\n\t\t\t\t\t\tr = client.parse( this.xhr, \"text/plain\" );\n\t\t\t\t\t\tcache.set( uri, \"permission\", client.bit( [\"get\"] ) );\n\t\t\t\t\t\tcache.set( uri, \"response\", r );\n\t\t\t\t\t\tthis.resolve( r );\n\t\t\t\t\t}\n\t\t\t\t} );\n\n\t\t\t\tkxhr.on( \"error\", function ( e ) {\n\t\t\t\t\tthis.reject( e );\n\t\t\t\t} );\n\n\t\t\t\t// Sending request\n\t\t\t\tkxhr.xhr.send( payload !== null ? payload : undefined );\n\t\t\t} );\n\t\t}\n\n\t\treturn kxhr;\n\t},\n\n\t/**\n\t * Scrolls to a position in the view using a two point bezier curve\n\t *\n\t * @method scroll\n\t * @memberOf client\n\t * @param  {Array}  dest Coordinates\n\t * @param  {Number} ms   [Optional] Milliseconds to scroll, default is 250, min is 100\n\t * @return {Object} {@link Deferred}\n\t * @private\n\t */\n\tscroll : function ( dest, ms ) {\n\t\tvar defer = deferred(),\n\t\t    start = client.scrollPos(),\n\t\t    t     = 0;\n\n\t\tms = ( !isNaN( ms ) ? ms : 250 ) / 100;\n\n\t\tutility.repeat( function () {\n\t\t\tvar pos = math.bezier( start[0], start[1], dest[0], dest[1], ++t / 100 );\n\n\t\t\twindow.scrollTo( pos[0], pos[1] );\n\n\t\t\tif ( t === 100 ) {\n\t\t\t\tdefer.resolve( true );\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}, ms, \"scrolling\" );\n\n\t\treturn defer;\n\t},\n\n\t/**\n\t * Returns the current scroll position of the View\n\t *\n\t * @method scrollPos\n\t * @memberOf client\n\t * @return {Array} Describes the scroll position\n\t * @private\n\t */\n\tscrollPos : function () {\n\t\treturn [\n\t\t\twindow.scrollX || 0,\n\t\t\twindow.scrollY || 0\n\t\t];\n\t}\n};\n\n/**\n * @namespace csv\n */\nvar csv = {\n\t/**\n\t * Converts CSV to an Array of Objects\n\t *\n\t * @method decode\n\t * @memberOf csv\n\t * @param  {String} arg       CSV string\n\t * @param  {String} delimiter [Optional] Delimiter to split columns on, default is \",\"\n\t * @return {Array}            Array of Objects\n\t */\n\tdecode : function ( arg, delimiter ) {\n\t\tdelimiter  = delimiter || \",\";\n\t\tvar regex  = new RegExp( delimiter + \"(?=(?:[^\\\"]|\\\"(?:[^\\\"])[^\\\"]*\\\")*$)\" ),\n\t\t    rows   = string.trim( arg ).split( \"\\n\" ),\n\t\t    keys   = rows.shift().split( delimiter ),\n\t\t    result = [],\n\t\t    nth    = rows.length,\n\t\t    x      = keys.length,\n\t\t    i      = -1,\n\t\t    n, obj, row;\n\n\t\twhile ( ++i < nth ) {\n\t\t\tobj = {};\n\t\t\trow = rows[i].split( regex );\n\n\t\t\tn = -1;\n\t\t\twhile ( ++n  < x ) {\n\t\t\t\tobj[keys[n]] = utility.coerce( ( row[n] || \"\" ).replace( /^\"|\"$/g, \"\" ) );\n\t\t\t}\n\n\t\t\tresult.push( obj );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Encodes an Array, JSON, or Object as CSV\n\t *\n\t * @method encode\n\t * @memberOf csv\n\t * @param  {Mixed}   arg       JSON, Array or Object\n\t * @param  {String}  delimiter [Optional] Character to separate fields\n\t * @param  {Boolean} header    [Optional] `false` to disable keys names as first row\n\t * @return {String}            CSV string\n\t * @example\n\t * var csv = keigai.util.csv.encode( [{prop:\"value\"}, {prop:\"value2\"}] );\n\t *\n\t * console.log( csv );\n\t * \"prop\n\t *  value\n\t *  value2\"\n\t */\n\tencode : function ( arg, delimiter, header ) {\n\t\tvar obj    = json.decode( arg, true ) || arg,\n\t\t    result = \"\";\n\n\t\tdelimiter  = delimiter || \",\";\n\t\theader     = ( header !== false );\n\n\t\t// Prepares input based on CSV rules\n\t\tfunction prepare ( input ) {\n\t\t\tvar output;\n\n\t\t\tif ( input instanceof Array ) {\n\t\t\t\toutput = \"\\\"\" + input.toString() + \"\\\"\";\n\n\t\t\t\tif ( regex.object_type.test( output ) ) {\n\t\t\t\t\toutput = \"\\\"\" + csv.encode( input, delimiter ) + \"\\\"\";\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if ( input instanceof Object ) {\n\t\t\t\toutput = \"\\\"\" + csv.encode( input, delimiter ) + \"\\\"\";\n\t\t\t}\n\t\t\telse if ( regex.csv_quote.test( input ) ) {\n\t\t\t\toutput = \"\\\"\" + input.replace( /\"/g, \"\\\"\\\"\" ) + \"\\\"\";\n\t\t\t}\n\t\t\telse {\n\t\t\t\toutput = input;\n\t\t\t}\n\n\t\t\treturn output;\n\t\t}\n\n\t\tif ( obj instanceof Array ) {\n\t\t\tif ( obj[0] instanceof Object ) {\n\t\t\t\tif ( header ) {\n\t\t\t\t\tresult = ( array.keys( obj[0] ).join( delimiter ) + \"\\n\" );\n\t\t\t\t}\n\n\t\t\t\tresult += obj.map( function ( i ) {\n\t\t\t\t\treturn csv.encode( i, delimiter, false );\n\t\t\t\t} ).join( \"\\n\" );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresult += ( prepare( obj, delimiter ) + \"\\n\" );\n\t\t\t}\n\n\t\t}\n\t\telse {\n\t\t\tif ( header ) {\n\t\t\t\tresult = ( array.keys( obj ).join( delimiter ) + \"\\n\" );\n\t\t\t}\n\n\t\t\tresult += ( array.cast( obj ).map( prepare ).join( delimiter ) + \"\\n\" );\n\t\t}\n\n\t\treturn result.replace( regex.eol_nl , \"\");\n\t}\n};\n\n/**\n * @namespace filter\n */\nvar filter = {\n\t/**\n\t * DataListFilter factory\n\t *\n\t * @method factory\n\t * @memberOf filter\n\t * @param  {Object} target   Element to receive the filter\n\t * @param  {Object} list     {@link keigai.DataList}\n\t * @param  {String} filters  Comma delimited string of fields to filter by\n\t * @param  {Number} debounce [Optional] Milliseconds to debounce, default is `250`\n\t * @return {Object} {@link keigai.DataListFilter}\n\t * @example\n\t * var store  = keigai.store( [...] ),\n\t *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\n\t *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\n\t */\n\tfactory : function ( target, list, filters, debounce ) {\n\t\tvar ref = [list],\n\t\t    obj;\n\n\t\tdebounce = debounce || 250;\n\n\t\tif ( !( target instanceof Element ) || ( list && !list.store ) || ( typeof filters != \"string\" || string.isEmpty( filters ) ) ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\tobj = new DataListFilter( target, ref[0], debounce ).set( filters );\n\n\t\t// Decorating `target` with the appropriate input `type`\n\t\telement.attr( target, \"type\", \"text\" );\n\n\t\t// Setting up a chain of Events\n\t\tobj.observer.hook( obj.element, \"keyup\" );\n\t\tobj.observer.hook( obj.element, \"input\" );\n\t\tobj.on( \"keyup\", obj.update, \"keyup\" );\n\t\tobj.on( \"input\", obj.update, \"input\" );\n\n\t\treturn obj;\n\t}\n};\n\n/**\n * Creates a new DataListFilter\n *\n * @constructor\n * @memberOf keigai\n * @extends {keigai.Base}\n * @param  {Object} obj      Element to receive the filter\n * @param  {Object} list     {@link keigai.DataList}\n * @param  {Number} debounce [Optional] Milliseconds to debounce\n * @example\n * var store  = keigai.store( [...] ),\n *     list   = keigai.list( document.querySelector( \"#list\" ), store, \"{{field}}\" ),\n *     filter = keigai.filter( document.querySelector( \"input.filter\" ), list, \"field\" );\n */\nfunction DataListFilter ( element, list, debounce ) {\n\tthis.debounce = debounce;\n\tthis.element  = element;\n\tthis.filters  = {};\n\tthis.list     = list;\n\tthis.observer = observable.factory();\n}\n\n/**\n * Extending Base\n *\n * @memberOf keigai.DataListFilter\n * @type {Object} {@link keigai.Base}\n */\nDataListFilter.prototype = base.factory();\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.DataListFilter\n * @type {Function}\n * @private\n */\nDataListFilter.prototype.constructor = DataListFilter;\n\n/**\n * Set the filters\n *\n * Create an object based on comma separated key string\n *\n * @method set\n * @memberOf keigai.DataListFilter\n * @param  {String} fields Comma separated filters\n * @return {Object} {@link keigai.DataListFilter}\n * @example\n * filter.set( \"firstName, lastName, email\" );\n */\nDataListFilter.prototype.set = function ( fields ) {\n\tvar obj = {};\n\n\tarray.each( string.explode( fields ), function ( v ) {\n\t\tobj[v] = \"\";\n\t} );\n\n\tthis.filters = obj;\n\n\treturn this;\n};\n\n/**\n * Removes listeners, and DOM hooks to avoid memory leaks\n *\n * @method teardown\n * @memberOf keigai.DataListFilter\n * @return {Object} {@link keigai.DataListFilter}\n * @example\n * filter.teardown();\n */\nDataListFilter.prototype.teardown = function () {\n\tthis.observer.unhook( this.element, \"keyup\" );\n\tthis.observer.unhook( this.element, \"input\" );\n\n\treturn this;\n};\n\n/**\n * Applies the input value as a filter against the DataList based on specific fields\n *\n * @method update\n * @memberOf keigai.DataListFilter\n * @fires keigai.DataList#beforeFilter Fires before filter\n * @fires keigai.DataList#afterFilter Fires after filter\n * @return {Object} {@link keigai.DataListFilter}\n * @example\n * filter.update(); // Debounced execution\n */\nDataListFilter.prototype.update = function () {\n\tvar self = this;\n\n\tutility.defer( function () {\n\t\tvar val = element.val( self.element ).toString();\n\t\t\n\t\tself.list.dispatch( \"beforeFilter\", self.element, val );\n\n\t\tif ( !string.isEmpty( val ) ) {\n\t\t\tutility.iterate( self.filters, function ( v, k ) {\n\t\t\t\tvar queries = string.explode( val );\n\n\t\t\t\t// Ignoring trailing commas\n\t\t\t\tqueries = queries.filter( function ( i ) {\n\t\t\t\t\treturn !string.isEmpty( i );\n\t\t\t\t} );\n\n\t\t\t\t// Shaping valid pattern\n\t\t\t\tarray.each( queries, function ( i, idx ) {\n\t\t\t\t\tthis[idx] = \"^.*\" + string.escape( i ).replace( /(^\\*|\\*$)/g, \"\" ).replace( /\\*/g, \".*\" ) + \".*\";\n\t\t\t\t} );\n\n\t\t\t\tthis[k] = queries.join( \",\" );\n\t\t\t} );\n\n\t\t\tself.list.filter = self.filters;\n\t\t}\n\t\telse {\n\t\t\tself.list.filter = null;\n\t\t}\n\n\t\tself.list.pageIndex = 1;\n\t\tself.list.refresh();\n\n\t\tself.list.dispatch( \"afterFilter\", self.element );\n\t}, this.debounce, this.element.id + \"Debounce\");\n\n\treturn this;\n};\n\n/**\n * @namespace grid\n */\nvar grid = {\n\t/**\n\t * DataGrid factory\n\t *\n\t * @method factory\n\t * @memberOf grid\n\t * @fires keigai.DataGrid#change Fires when the DOM changes\n\t * @param  {Object}  target      Element to receive DataGrid\n\t * @param  {Object}  store       DataStore\n\t * @param  {Array}   fields      Array of fields to display\n\t * @param  {Array}   sortable    [Optional] Array of sortable columns/fields\n\t * @param  {Object}  options     [Optional] DataList options\n\t * @param  {Boolean} filtered    [Optional] Create an input to filter the data grid\n\t * @param  {Number}  debounce    [Optional] DataListFilter input debounce, default is 250\n\t * @return {Object} {@link keigai.DataGrid}\n\t * @example\n\t * var fields  = [\"name\", \"age\"],\n\t *     options = {pageSize: 5, order: \"age desc, name\"},\n\t *     store   = keigai.store(),\n\t *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\n\t *\n\t * store.setUri( \"data.json\" ).then( null, function ( e ) {\n\t *   ...\n\t * } );\n\t */\n\tfactory : function ( target, store, fields, sortable, options, filtered, debounce ) {\n\t\tvar ref = [store],\n\t\t    obj, template, header, width, css, sort;\n\n\t\tobj       = new DataGrid( target, ref[0], fields, sortable, options, filtered );\n\t\ttemplate  = \"\";\n\t\theader    = element.create( \"li\", {}, element.create( \"ul\", {\"class\": \"header\"}, obj.element ) );\n\t\twidth     = ( 100 / obj.fields.length ) + \"%\";\n\t\tcss       = \"display:inline-block;width:\" + width;\n\t\tsort      = obj.options.order ? string.explode( obj.options.order ) : [];\n\n\t\t// Creating DataList template based on fields\n\t\tarray.each( obj.fields, function ( i ) {\n\t\t\tvar trimmed = i.replace( /.*\\./g, \"\" ),\n\t\t\t    el      = element.create( \"span\", {innerHTML: string.capitalize( string.unCamelCase( string.unhyphenate( trimmed, true ) ).replace( /_|-/g, \" \" ), true ), style: css, \"data-field\": i}, header );\n\n\t\t\t// Adding CSS class if \"column\" is sortable\n\t\t\tif ( array.contains( obj.sortable, i ) ) {\n\t\t\t\telement.klass( el, \"sortable\", true );\n\n\t\t\t\t// Applying default sort, if specified\n\t\t\t\tif ( sort.filter( function ( x ) { return ( x.indexOf( i ) === 0 ); } ).length > 0 ) {\n\t\t\t\t\telement.data( el, \"sort\", array.contains( sort, i + \" desc\" ) ? \"desc\" : \"asc\" );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\ttemplate += \"<span class=\\\"\" + i + \"\\\" data-field=\\\"\" + i + \"\\\" style=\\\"\" + css + \"\\\">{{\" + i + \"}}</span>\";\n\t\t} );\n\n\t\t// Setting click handler on sortable \"columns\"\n\t\tif ( obj.sortable.length > 0 ) {\n\t\t\tobj.observer.hook( header.parentNode, \"click\", obj.sort, \"sort\", obj );\n\t\t}\n\n\t\t// Creating DataList\n\t\tref.push( list.factory( obj.element, ref[0], template, obj.options ) );\n\n\t\t// Setting by-reference DataList on DataGrid\n\t\tobj.list = ref[1];\n\n\t\tif ( obj.filtered === true ) {\n\t\t\t// Creating DataListFilter\n\t\t\tref.push( filter.factory( element.create( \"input\", {\"class\": \"filter\", placeholder: \"Filter\"}, obj.element, \"first\" ), ref[1], obj.fields.join( \",\" ), debounce || 250 ) );\n\t\t\t\n\t\t\t// Setting by-reference DataListFilter on DataGrid\n\t\t\tobj.filter = ref[2];\n\t\t}\n\n\t\t// Setting up a chain of Events\n\t\tobj.on( \"beforeRefresh\", function ( arg ) {\n\t\t\telement.dispatch( arg, \"beforeRefresh\" );\n\t\t}, \"bubble\" );\n\n\t\tobj.on( \"afterRefresh\", function ( arg ) {\n\t\t\telement.dispatch( arg, \"afterRefresh\" );\n\t\t}, \"bubble\" );\n\n\t\tobj.on( \"click\", function ( e ) {\n\t\t\tif ( element.hasClass( e.currentTarget, \"header\" ) ) {\n\t\t\t\tobj.sort( e );\n\t\t\t}\n\t\t}, \"header\" );\n\n\t\tobj.list.on( \"change\", function () {\n\t\t\tobj.dispatch.apply( obj, [\"change\"].concat( array.cast( arguments ) ) );\n\t\t}, \"change\" );\n\n\t\tobj.list.on( \"beforeFilter\", function () {\n\t\t\tobj.dispatch.apply( obj, [\"beforeFilter\"].concat( array.cast( arguments ) ) );\n\t\t}, \"beforeFilter\" );\n\n\t\tobj.list.on( \"afterFilter\", function () {\n\t\t\tobj.dispatch.apply( obj, [\"afterFilter\"].concat( array.cast( arguments ) ) );\n\t\t}, \"afterFilter\" );\n\n\t\treturn obj;\n\t}\n};\n\n/**\n * Creates a new DataGrid\n *\n * @constructor\n * @memberOf keigai\n * @extends {keigai.Base}\n * @param  {Object}  target   Element to receive DataGrid\n * @param  {Object}  store    DataStore\n * @param  {Array}   fields   Array of fields to display\n * @param  {Array}   sortable [Optional] Array of sortable columns/fields\n * @param  {Object}  options  [Optional] DataList options\n * @param  {Boolean} filtered [Optional] Create an input to filter the DataGrid\n * @example\n * var fields  = [\"name\", \"age\"],\n *     options = {pageSize: 5, order: \"age desc, name\"},\n *     store   = keigai.store( [...] ),\n *     grid    = keigai.grid( document.querySelector( \"#grid\" ), store, fields, fields, options, true );\n */\nfunction DataGrid ( target, store, fields, sortable, options, filtered ) {\n\tvar sortOrder;\n\n\tif ( options.order && !string.isEmpty( options.order ) ) {\n\t\tsortOrder = string.explode( options.order ).map( function ( i ) {\n\t\t\treturn i.replace( regex.after_space, \"\" );\n\t\t} );\n\t}\n\n\tthis.element   = element.create( \"section\", {\"class\": \"grid\"}, target );\n\tthis.fields    = fields;\n\tthis.filter    = null;\n\tthis.filtered  = filtered === true;\n\tthis.list      = null;\n\tthis.observer  = observable.factory();\n\tthis.options   = options   || {};\n\tthis.store     = store;\n\tthis.sortable  = sortable  || [];\n\tthis.sortOrder = sortOrder || sortable || [];\n}\n\n/**\n * Extending Base\n *\n * @memberOf keigai.DataGrid\n * @type {Object} {@link keigai.Base}\n */\nDataGrid.prototype = base.factory();\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.DataGrid\n * @type {Function}\n * @private\n */\nDataGrid.prototype.constructor = DataGrid;\n\n/**\n * Adds an item to the DataGrid\n *\n * @method add\n * @memberOf keigai.DataGrid\n * @param {Object} record New DataStore record (shapes should match)\n * @return {Object}       {@link keigai.DataGrid}\n * @example\n * grid.add( {name: \"John Doe\", age: 34} );\n */\nDataGrid.prototype.add = function ( record ) {\n\tvar self = this;\n\n\tthis.store.set( null, record ).then( null, function ( e ) {\n\t\tutility.error( e );\n\t\tself.dispatch( \"error\", e );\n\t} );\n\n\treturn this;\n};\n\n/**\n * Exports data grid records\n *\n * @method dump\n * @memberOf keigai.DataGrid\n * @return {Array} Record set\n * @example\n * var data = grid.dump();\n */\nDataGrid.prototype.dump = function () {\n\treturn this.store.dump( this.list.records, this.fields );\n};\n\n/**\n * Refreshes the DataGrid\n *\n * @method refresh\n * @memberOf keigai.DataGrid\n * @fires keigai.DataGrid#beforeRefresh Fires before refresh\n * @fires keigai.DataGrid#afterRefresh Fires after refresh\n * @return {Object} {@link keigai.DataGrid}\n * @example\n * grid.refresh();\n */\nDataGrid.prototype.refresh = function () {\n\tvar sort = [],\n\t    self = this;\n\n\tthis.dispatch( \"beforeRefresh\", this.element );\n\n\tif ( this.sortOrder.length > 0 ) {\n\t\tarray.each( this.sortOrder, function ( i ) {\n\t\t\tvar obj = element.find( self.element, \".header span[data-field='\" + i + \"']\" )[0];\n\n\t\t\tsort.push( string.trim( i + \" \" + ( element.data( obj, \"sort\" ) || \"\" ) ) );\n\t\t} );\n\n\t\tthis.options.order = this.list.order = sort.join( \", \" );\n\t}\n\n\tthis.list.where = null;\n\tutility.merge( this.list, this.options );\n\tthis.list.refresh();\n\n\tthis.dispatch( \"afterRefresh\", this.element );\n\n\treturn this;\n};\n\n/**\n * Removes an item from the DataGrid\n *\n * @method remove\n * @memberOf keigai.DataGrid\n * @param {Mixed} record Record, key or index\n * @return {Object} {@link keigai.DataGrid}\n * @example\n * grid.remove( \"key\" );\n */\nDataGrid.prototype.remove = function ( record ) {\n\tvar self = this;\n\n\tthis.store.del( record ).then( null, function ( e ) {\n\t\tutility.error( e );\n\t\tself.dispatch( \"error\", e );\n\t} );\n\n\treturn this;\n};\n\n/**\n * Sorts the DataGrid when a column header is clicked\n *\n * @method sort\n * @memberOf keigai.DataGrid\n * @param  {Object} ev Event\n * @return {Object} {@link keigai.DataGrid}\n */\nDataGrid.prototype.sort = function ( ev ) {\n\tvar target = utility.target( ev ),\n\t    field;\n\n\t// Stopping event propogation\n\tutility.stop( ev );\n\n\t// Refreshing list if target is sortable\n\tif ( element.hasClass( target, \"sortable\" ) ) {\n\t\tfield = element.data( target, \"field\" );\n\t\telement.data( target, \"sort\", element.data( target, \"sort\" ) === \"asc\" ? \"desc\" : \"asc\" );\n\t\tarray.remove( this.sortOrder, field );\n\t\tthis.sortOrder.splice( 0, 0, field );\n\t\tthis.refresh();\n\t}\n\n\treturn this;\n};\n\n/**\n * Tears down the DataGrid\n *\n * @method teardown\n * @memberOf keigai.DataGrid\n * @return {Object} {@link keigai.DataGrid}\n * @example\n * grid.teardown();\n */\nDataGrid.prototype.teardown = function () {\n\tif ( this.filter !== null ) {\n\t\tthis.filter.teardown();\n\t\tthis.filter = null;\n\t}\n\n\tthis.list.teardown();\n\tthis.observer.unhook( element.find( this.element, \".header\" )[0], \"click\" );\n\telement.destroy( this.element );\n\tthis.element = null;\n\n\treturn this;\n};\n\n/**\n * Updates an item in the DataGrid\n *\n * @method update\n * @memberOf keigai.DataGrid\n * @param {Mixed}  key  Key or index\n * @param {Object} data New property values\n * @return {Object}     {@link keigai.DataGrid}\n * @example\n * grid.update( \"key\", {name: \"Jim Smith\"} );\n */\nDataGrid.prototype.update = function ( key, data ) {\n\tvar self = this;\n\n\tthis.store.update( key, data ).then( null, function ( e ) {\n\t\tutility.error( e );\n\t\tself.dispatch( \"error\", e );\n\t} );\n\n\treturn this;\n};\n\n/**\n * @namespace list\n */\nvar list = {\n\t/**\n\t * Creates an instance of DataList\n\t *\n\t * @method factory\n\t * @memberOf list\n\t * @fires keigai.DataList#change Fires when the DOM changes\n\t * @param  {Object} target   Element to receive the DataList\n\t * @param  {Object} store    {@link keigai.DataStore}\n\t * @param  {Mixed}  template Record field, template ( $.tpl ), or String, e.g. \"<p>this is a {{field}} sample.</p>\", fields are marked with {{ }}\n\t * @param  {Object} options  Optional parameters to set on the DataList\n\t * @return {Object} {@link keigai.DataList}\n\t * @example\n\t * var store = keigai.store( [...] ),\n\t *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\n\t */\n\tfactory : function ( target, store, template, options ) {\n\t\tvar ref = [store],\n\t\t    obj;\n\n\t\tif ( !( target instanceof Element ) || typeof store != \"object\" || !regex.string_object.test( typeof template ) ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\t// Creating instance\n\t\tobj = new DataList( element.create( \"ul\", {\"class\": \"list\"}, target ), ref[0], template );\n\n\t\tif ( options instanceof Object ) {\n\t\t\tif ( options.listFiltered && options.listFilter ) {\n\t\t\t\tobj.listFilter = filter.factory( element.create( \"input\", {\"id\": obj.element.id + \"-filter\", \"class\": \"filter\", placeholder: \"Filter\"}, target, \"first\" ), obj, options.listFilter, options.debounce || 250 );\n\t\t\t\tdelete options.listFilter;\n\t\t\t\tdelete options.listFiltered;\n\t\t\t}\n\n\t\t\tutility.merge( obj, options );\n\t\t}\n\n\t\tobj.store.lists.push( obj );\n\n\t\t// Setting up a chain of Events\n\t\tobj.on( \"beforeRefresh\", function ( arg ) {\n\t\t\telement.dispatch( arg, \"beforeRefresh\" );\n\t\t}, \"bubble\" );\n\n\t\tobj.on( \"afterRefresh\", function ( arg ) {\n\t\t\telement.dispatch( arg, \"afterRefresh\" );\n\t\t}, \"bubble\" );\n\n\t\tobj.on( \"change\", function ( arg ) {\n\t\t\telement.dispatch( obj.element, \"change\", arg );\n\t\t}, \"change\" );\n\n\t\tobj.on( \"click\", function ( e ) {\n\t\t\tvar target = utility.target( e ),\n\t\t\t    page;\n\n\t\t\tutility.stop( e );\n\n\t\t\tif ( target.nodeName === \"A\" ) {\n\t\t\t\tpage = element.data( target, \"page\" );\n\n\t\t\t\tif ( !isNaN( page ) ) {\n\t\t\t\t\tobj.page( page );\n\t\t\t\t}\n\t\t\t}\n\t\t}, \"pagination\" );\n\n\t\tif ( typeof MutationObserver == \"function\" ) {\n\t\t\tobj.mutation = new MutationObserver( function ( arg ) {\n\t\t\t\tobj.dispatch( \"change\", arg );\n\t\t\t} );\n\n\t\t\tobj.mutation.observe( obj.element, {childList: true, subtree: true} );\n\t\t}\n\n\t\t// Rendering if not tied to an API or data is ready\n\t\tif ( obj.store.uri === null || obj.store.loaded ) {\n\t\t\tobj.refresh();\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Calculates the total pages\n\t *\n\t * @method pages\n\t * @memberOf list\n\t * @return {Number} Total pages\n\t * @private\n\t */\n\tpages : function () {\n\t\tif ( isNaN( this.pageSize ) ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\treturn Math.ceil( ( !this.filter ? this.total : this.filtered.length ) / this.pageSize );\n\t},\n\n\t/**\n\t * Calculates the page size as an Array of start & finish\n\t *\n\t * @method range\n\t * @memberOf list\n\t * @return {Array}  Array of start & end numbers\n\t * @private\n\t */\n\trange : function () {\n\t\tvar start = ( this.pageIndex * this.pageSize ) - this.pageSize,\n\t\t    end   = this.pageSize;\n\n\t\treturn [start, end];\n\t}\n};\n\n/**\n * Creates a new DataList\n *\n * @constructor\n * @memberOf keigai\n * @extends {keigai.Base}\n * @example\n * var store = keigai.store( [...] ),\n *     list  = keigai.list( document.querySelector(\"#list\"), store, \"{{name}}\", {order: \"name\"} );\n */\nfunction DataList ( element, store, template ) {\n\tthis.callback    = null;\n\tthis.current     = [];\n\tthis.element     = element;\n\tthis.emptyMsg    = label.noData;\n\tthis.filter      = null;\n\tthis.filtered    = [];\n\tthis.id          = utility.genId();\n\tthis.items       = [];\n\tthis.listFilter  = null;\n\tthis.mutation    = null;\n\tthis.observer    = observable.factory();\n\tthis.pageIndex   = 1;\n\tthis.pageSize    = null;\n\tthis.pageRange   = 5;\n\tthis.pagination  = \"bottom\"; // \"top\" or \"bottom|top\" are also valid\n\tthis.placeholder = \"\";\n\tthis.order       = \"\";\n\tthis.records     = [];\n\tthis.template    = template;\n\tthis.total       = 0;\n\tthis.store       = store;\n\tthis.where       = null;\n}\n\n/**\n * Extending Base\n *\n * @memberOf keigai.DataList\n * @type {Object} {@link keigai.Base}\n */\nDataList.prototype = base.factory();\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.DataList\n * @type {Function}\n * @private\n */\nDataList.prototype.constructor = DataList;\n\n/**\n * Adds an item to the DataList\n *\n * @method add\n * @memberOf keigai.DataList\n * @param {Object} record New DataStore record (shapes should match)\n * @return {Object}       {@link keigai.DataList}\n * @example\n * list.add( {name: \"John Doe\", age: 34} );\n */\nDataList.prototype.add = function ( record ) {\n\tvar self = this;\n\n\tthis.store.set( null, record ).then( null, function ( e ) {\n\t\tutility.error( e );\n\t\tself.dispatch( \"error\", e );\n\t} );\n\n\treturn this;\n};\n\n/**\n * Exports data list records\n *\n * @method dump\n * @memberOf keigai.DataList\n * @return {Array} Record set\n * @example\n * var data = list.dump();\n */\nDataList.prototype.dump = function () {\n\treturn this.store.dump( this.records );\n};\n\n/**\n * Changes the page index of the DataList\n *\n * @method page\n * @memberOf keigai.DataList\n * @param  {Number} n Page to view\n * @return {Object}   {@link keigai.DataList}\n * @example\n * list.page( 2 );\n */\nDataList.prototype.page = function ( n ) {\n\tthis.pageIndex = n;\n\n\treturn this.refresh();\n};\n\n/**\n * Adds pagination Elements to the View, executed from `DataList.refresh()`\n *\n * @method pages\n * @memberOf keigai.DataList\n * @return {Object} {@link keigai.DataList}\n * @example\n * list.pages();\n */\nDataList.prototype.pages = function () {\n\tvar self  = this,\n\t    obj   = this.element,\n\t    page  = this.pageIndex,\n\t    pos   = this.pagination,\n\t    range = this.pageRange,\n\t    mid   = Math.floor( range / 2 ),\n\t    start = page - mid,\n\t    end   = page + mid,\n\t    total = list.pages.call( this ),\n\t    diff;\n\n\tif ( !regex.top_bottom.test( pos ) ) {\n\t\tthrow new Error( label.invalidArguments );\n\t}\n\n\t// Removing the existing controls\n\tarray.each( utility.dom( \"#\" + obj.id + \"-pages-top, #\" + obj.id + \"-pages-bottom\" ), function ( i ) {\n\t\tif ( i ) {\n\t\t\tself.observer.unhook( i, \"click\" );\n\t\t\telement.destroy( i );\n\t\t}\n\t} );\n\t\n\t// Halting because there's 1 page, or nothing\n\tif ( ( this.filter && this.filtered.length === 0 ) || this.total === 0 || total === 1 ) {\n\t\treturn this;\n\t}\n\n\t// Getting the range to display\n\tif ( start < 1 ) {\n\t\tdiff  = number.diff( start, 1 );\n\t\tstart = start + diff;\n\t\tend   = end   + diff;\n\t}\n\n\tif ( end > total ) {\n\t\tend   = total;\n\t\tstart = ( end - range ) + 1;\n\n\t\tif ( start < 1 ) {\n\t\t\tstart = 1;\n\t\t}\n\t}\n\n\tif ( number.diff( start, end ) >= range ) {\n\t\t--end;\n\t}\n\n\tarray.each( string.explode( pos ), function ( i ) {\n\t\tvar current = false,\n\t\t    more    = page > 1,\n\t\t    next    = ( page + 1 ) <= total,\n\t\t    last    = ( page >= total ),\n\t\t    el, n;\n\n\t\t// Setting up the list\n\t\tel = element.create( \"ul\", {\"class\": \"list pages hidden \" + i, id: obj.id + \"-pages-\" + i}, obj, i === \"bottom\" ? \"after\" : \"before\" );\n\n\t\t// First page\n\t\telement.create( more ? \"a\" : \"span\", {\"class\": \"first page\", \"data-page\": 1, innerHTML: \"&lt;&lt;\"}, element.create( \"li\", {}, el ) );\n\n\t\t// Previous page\n\t\telement.create( more ? \"a\" : \"span\", {\"class\": \"prev page\", \"data-page\": ( page - 1 ), innerHTML: \"&lt;\"}, element.create( \"li\", {}, el ) );\n\n\t\t// Rendering the page range\n\t\tfor ( n = start; n <= end; n++ ) {\n\t\t\tcurrent = ( n === page );\n\t\t\telement.create( current ? \"span\" : \"a\", {\"class\": current ? \"current page\" : \"page\", \"data-page\": n, innerHTML: n}, element.create( \"li\", {}, el ) );\n\t\t}\n\n\t\t// Next page\n\t\telement.create( next ? \"a\" : \"span\", {\"class\": \"next page\", \"data-page\": next ? ( page + 1 ) : null, innerHTML: \"&gt;\"}, element.create( \"li\", {}, el ) );\n\n\t\t// Last page\n\t\telement.create( last ? \"span\" : \"a\", {\"class\": \"last page\", \"data-page\": last ? null : total, innerHTML: \"&gt;&gt;\"}, element.create( \"li\", {}, el ) );\n\n\t\t// Adding to DOM\n\t\telement.klass( el, \"hidden\", false );\n\n\t\t// Pagination listener\n\t\tself.observer.hook( el, \"click\" );\n\t} );\n\n\treturn this;\n};\n\n/**\n * Refreshes element\n *\n * @method refresh\n * @memberOf keigai.DataList\n * @extends {keigai.Base}\n * @fires keigai.DataList#beforeRefresh Fires before refresh\n * @fires keigai.DataList#afterRefresh Fires after refresh\n * @fires keigai.DataList#error Fires on error\n * @param  {Boolean} create [Optional] Recreates cached View of data\n * @return {Object} {@link keigai.DataList}\n * @example\n * list.refresh();\n */\nDataList.prototype.refresh = function ( create ) {\n\tvar self     = this,\n\t    el       = this.element,\n\t    template = ( typeof this.template == \"object\" ),\n\t    filter   = this.filter !== null,\n\t    items    = [],\n\t    callback = ( typeof this.callback == \"function\" ),\n\t    reg      = new RegExp(),\n\t    registry = [], // keeps track of records in the list ( for filtering )\n\t    range    = [],\n\t    fn, ceiling, next;\n\n\tcreate = create === true;\n\n\tthis.dispatch( \"beforeRefresh\", el );\n\n\t// Function to create templates for the html rep\n\tif ( !template ) {\n\t\tfn = function ( i ) {\n\t\t\tvar html  = self.template,\n\t\t\t    items = array.unique( html.match( /\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g ) );\n\n\t\t\t// Replacing record key\n\t\t\thtml = html.replace( \"{{\" + self.store.key + \"}}\", i.key );\n\t\t\t\n\t\t\t// Replacing dot notation properties\n\t\t\tarray.each( items, function ( attr ) {\n\t\t\t\tvar key   = attr.replace( /\\{\\{|\\}\\}/g, \"\" ),\n\t\t\t\t    value = utility.walk( i.data, key );\n\n\t\t\t\tif ( value === undefined ) {\n\t\t\t\t\tvalue = \"\";\n\t\t\t\t}\n\n\t\t\t\treg.compile( string.escape( attr ), \"g\" );\n\t\t\t\thtml = html.replace( reg, value );\n\t\t\t} );\n\n\t\t\t// Filling in placeholder value\n\t\t\thtml = html.replace( /\\{\\{.*\\}\\}/g, self.placeholder );\n\n\t\t\treturn \"<li data-key=\\\"\" + i.key + \"\\\">\" + html + \"</li>\";\n\t\t};\n\t}\n\telse {\n\t\tfn = function ( i ) {\n\t\t\tvar obj   = json.encode( self.template ),\n\t\t\t    items = array.unique( obj.match( /\\{\\{[\\w\\.\\-\\[\\]]+\\}\\}/g ) );\n\n\t\t\t// Replacing record key\n\t\t\tobj = obj.replace( \"{{\" + self.store.key + \"}}\", i.key );\n\t\t\t\n\t\t\t// Replacing dot notation properties\n\t\t\tarray.each( items, function ( attr ) {\n\t\t\t\tvar key   = attr.replace( /\\{\\{|\\}\\}/g, \"\" ),\n\t\t\t\t    value = utility.walk( i.data, key ) || \"\";\n\n\t\t\t\treg.compile( string.escape( attr ), \"g\" );\n\n\t\t\t\t// Stripping first and last \" to concat to valid JSON\n\t\t\t\tobj = obj.replace( reg, json.encode( value ).replace( /(^\")|(\"$)/g, \"\" ) );\n\t\t\t} );\n\n\t\t\t// Filling in placeholder value\n\t\t\tobj = json.decode( obj.replace( /\\{\\{.*\\}\\}/g, self.placeholder ) );\n\n\t\t\treturn {li: obj};\n\t\t};\n\t}\n\n\t// Next phase\n\tnext = function ( args ) {\n\t\t// Creating view of DataStore\n\t\tself.records  = args;\n\t\tself.total    = self.records.length;\n\t\tself.filtered = [];\n\n\t\t// Resetting 'view' specific arrays\n\t\tself.current  = [];\n\n\t\t// Filtering records (if applicable)\n\t\tif ( filter ) {\n\t\t\tarray.each( self.records, function ( i ) {\n\t\t\t\tutility.iterate( self.filter, function ( v, k ) {\n\t\t\t\t\tvar reg, key;\n\n\t\t\t\t\tif ( array.contains( registry, i.key ) ) {\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\tv   = string.explode( v );\n\t\t\t\t\treg = new RegExp(),\n\t\t\t\t\tkey = ( k === self.store.key );\n\n\t\t\t\t\tarray.each( v, function ( query ) {\n\t\t\t\t\t\tvar value = !key ? utility.walk( i.data, k ) : \"\";\n\n\t\t\t\t\t\tutility.compile( reg, query, \"i\" );\n\n\t\t\t\t\t\tif ( ( key && reg.test( i.key ) ) || reg.test( value ) ) {\n\t\t\t\t\t\t\tregistry.push( i.key );\n\t\t\t\t\t\t\tself.filtered.push( i );\n\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\n\t\t// Pagination\n\t\tif ( self.pageSize !== null && !isNaN( self.pageIndex ) && !isNaN( self.pageSize ) ) {\n\t\t\tceiling = list.pages.call( self );\n\n\t\t\t// Passed the end, so putting you on the end\n\t\t\tif ( ceiling > 0 && self.pageIndex > ceiling ) {\n\t\t\t\treturn self.page( ceiling );\n\t\t\t}\n\n\t\t\t// Paginating the items\n\t\t\telse if ( self.total > 0 ) {\n\t\t\t\trange        = list.range.call( self );\n\t\t\t\tself.current = array.limit( !filter ? self.records : self.filtered, range[0], range[1] );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tself.current = !filter ? self.records : self.filtered;\n\t\t}\n\n\t\t// Processing records & generating templates\n\t\tarray.each( self.current, function ( i ) {\n\t\t\tvar html = fn( i ),\n\t\t\t    hash = btoa( html );\n\n\t\t\titems.push( {key: i.key, template: html, hash: hash} );\n\t\t} );\n\n\t\t// Updating element\n\t\tutility.render( function () {\n\t\t\tvar destroy   = [],\n\t\t\t    callbacks = [],\n\t\t\t    i, nth;\n\n\t\t\tif ( items.length === 0 ) {\n\t\t\t\telement.html( el, \"<li class=\\\"empty\\\">\" + self.emptyMsg + \"</li>\" );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif ( self.items.length === 0 ) {\n\t\t\t\t\telement.html( el, items.map( function ( i ) {\n\t\t\t\t\t\treturn i.template;\n\t\t\t\t\t} ).join( \"\" ) );\n\n\t\t\t\t\tif ( callback ) {\n\t\t\t\t\t\tarray.each( array.cast( el.childNodes ), function ( i ) {\n\t\t\t\t\t\t\tself.callback( i );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tarray.each( items, function ( i, idx ) {\n\t\t\t\t\t\tif ( self.items[idx] !== undefined && self.items[idx].hash !== i.hash ) {\n\t\t\t\t\t\t\telement.data( element.html( el.childNodes[idx], i.template.replace( /<li data-key=\\\"\\d+\\\">|<\\/li>/g, \"\" ) ), \"key\", i.key );\n\t\t\t\t\t\t\tcallbacks.push( idx );\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ( self.items[idx] === undefined ) {\n\t\t\t\t\t\t\telement.create( i.template, null, el );\n\t\t\t\t\t\t\tcallbacks.push( idx );\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( items.length < self.items.length ) {\n\t\t\t\t\t\ti   = items.length - 1;\n\t\t\t\t\t\tnth = self.items.length;\n\n\t\t\t\t\t\twhile ( ++i < nth ) {\n\t\t\t\t\t\t\tdestroy.push( i );\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tarray.each( destroy.reverse(), function ( i ) {\n\t\t\t\t\t\t\telement.destroy( el.childNodes[ i ] );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( callback ) {\n\t\t\t\t\t\tarray.each( callbacks, function ( i ) {\n\t\t\t\t\t\t\tself.callback( el.childNodes[i] );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Updating reference for next change\n\t\t\tself.items = items;\n\n\t\t\t// Rendering pagination elements\n\t\t\tif ( self.pageSize !== null && regex.top_bottom.test( self.pagination ) && !isNaN( self.pageIndex ) && !isNaN( self.pageSize ) ) {\n\t\t\t\tself.pages();\n\t\t\t}\n\t\t\telse {\n\t\t\t\tarray.each( utility.$( \"#\" + el.id + \"-pages-top, #\" + el.id + \"-pages-bottom\" ), function ( i ) {\n\t\t\t\t\telement.destroy( i );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tself.dispatch( \"afterRefresh\", el );\n\t\t} );\n\t};\n\n\t// Consuming records based on sort\n\tif ( this.where === null ) {\n\t\tstring.isEmpty( this.order ) ? next( this.store.get() ) : this.store.sort( this.order, create ).then( next, function ( e ) {\n\t\t\tutility.error( e );\n\t\t\tself.dispatch( \"error\", e );\n\t\t} );\n\t}\n\telse if ( string.isEmpty( this.order ) ) {\n\t\tthis.store.select( this.where ).then( next, function ( e ) {\n\t\t\tutility.error( e );\n\t\t\tself.dispatch( \"error\", e );\n\t\t} );\n\t}\n\telse {\n\t\tthis.store.sort( this.order, create, this.where ).then( next, function ( e ) {\n\t\t\tutility.error( e );\n\t\t\tself.dispatch( \"error\", e );\n\t\t} );\n\t}\n\n\treturn this;\n};\n\n/**\n * Removes an item from the DataList\n *\n * @method remove\n * @memberOf keigai.DataList\n * @param {Mixed} record Record, key or index\n * @return {Object} {@link keigai.DataList}\n * @example\n * // Adding a click handler to 'trash' Elements\n * keigai.util.array.cast( document.querySelectorAll( \".list .trash\" ) ).forEach( function ( i ) {\n *   i.addEventListener( \"click\", function ( ev ) {\n *     var key = keigai.util.element.data( keigai.util.target( ev ).parentNode, \"key\" );\n *\n *     list.remove( key );\n *   }, false );\n * } );\n */\nDataList.prototype.remove = function ( record ) {\n\tvar self = this;\n\n\tthis.store.del( record ).then( null, function ( e ) {\n\t\tutility.error( e );\n\t\tself.dispatch( \"error\", e );\n\t} );\n\n\treturn this;\n};\n\n/**\n * Sorts data list & refreshes element\n *\n * @method sort\n * @memberOf keigai.DataList\n * @param  {String} order SQL \"ORDER BY\" clause\n * @return {Object} {@link keigai.DataList}\n * @example\n * list.sort( \"age, name\" );\n */\nDataList.prototype.sort = function ( order ) {\n\tthis.order = order;\n\n\treturn this.refresh();\n};\n\n/**\n * Tears down references to the DataList\n *\n * @method teardown\n * @memberOf keigai.DataList\n * @param  {Boolean} destroy [Optional] `true` will remove the DataList from the DOM\n * @return {Object} {@link keigai.DataList}\n * @example\n * list.teardown();\n */\nDataList.prototype.teardown = function ( destroy ) {\n\tdestroy  = ( destroy === true );\n\tvar self = this,\n\t    id   = this.element.id;\n\n\tarray.each( this.store.lists, function ( i, idx ) {\n\t\tif ( i.id === self.id ) {\n\t\t\tarray.remove( this, idx );\n\n\t\t\treturn false;\n\t\t}\n\t} );\n\n\tdelete this.observer.hooks[id];\n\n\tif ( this.listFilter ) {\n\t\tthis.listFilter.teardown();\n\t}\n\n\tif ( destroy ) {\n\t\telement.destroy( this.element );\n\n\t\tarray.each( utility.$( \"#\" + id + \"-filter, #\" + id + \"-pages-top, #\" + id + \"-pages-bottom\"), function ( i ) {\n\t\t\telement.destroy( i );\n\t\t} );\n\n\t\tthis.element = null;\n\t}\n\n\treturn this;\n};\n\n/**\n * Updates an item in the DataList\n *\n * @method update\n * @memberOf keigai.DataList\n * @param {Mixed}  key  Key or index\n * @param {Object} data New property values\n * @return {Object}     {@link keigai.DataList}\n * @example\n * list.update( \"key\", {name: \"Jim Smith\"} );\n */\nDataList.prototype.update = function ( key, data ) {\n\tvar self = this;\n\n\tthis.store.update( key, data ).then( null, function ( e ) {\n\t\tutility.error( e );\n\t\tself.dispatch( \"error\", e );\n\t} );\n\n\treturn this;\n};\n\n/**\n * @namespace deferred\n */\nvar deferred = {\n\t/**\n\t * Deferred factory\n\t *\n\t * @method factory\n\t * @memberOf deferred\n\t * @return {Object} {@link keigai.Deferred}\n\t * @example\n\t * var deferred = keigai.util.defer();\n\t *\n\t * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\n\t * deferred.always( function ( ... ) { ... } );\n\t *\n\t * ...\n\t *\n\t * deferred.resolve( true );\n\t */\n\t factory : function () {\n\t\treturn new Deferred();\n\t}\n};\n\n/**\n * Creates a new Deferred\n *\n * @constructor\n * @memberOf keigai\n */\nfunction Deferred () {\n\tvar self      = this;\n\n\tthis.promise  = promise.factory();\n\tthis.onDone   = [];\n\tthis.onAlways = [];\n\tthis.onFail   = [];\n\n\t// Setting handlers to execute Arrays of Functions\n\tthis.promise.then( function ( arg ) {\n\t\tarray.each( self.onDone, function ( i ) {\n\t\t\ti( arg );\n\t\t} );\n\n\t\tarray.each( self.onAlways, function ( i ) {\n\t\t\ti( arg );\n\t\t} );\n\n\t\tself.onAlways = [];\n\t\tself.onDone   = [];\n\t\tself.onFail   = [];\n\t}, function ( arg ) {\n\t\tarray.each( self.onFail, function ( i ) {\n\t\t\ti( arg );\n\t\t} );\n\n\t\tarray.each( self.onAlways, function ( i ) {\n\t\t\ti( arg );\n\t\t} );\n\n\t\tself.onAlways = [];\n\t\tself.onDone   = [];\n\t\tself.onFail   = [];\n\t} );\n}\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.Deferred\n * @type {Function}\n * @private\n */\nDeferred.prototype.constructor = Deferred;\n\n/**\n * Registers a function to execute after Promise is reconciled\n *\n * @method always\n * @memberOf keigai.Deferred\n * @param  {Function} arg Function to execute\n * @return {Object} {@link keigai.Deferred}\n * @example\n * var deferred = keigai.util.defer();\n *\n * deferred.always( function () {\n *     ...\n * } ).then( function () {\n *     ...\n * } );\n *\n * ...\n *\n * deferred.resolve( true );\n */\nDeferred.prototype.always = function ( arg ) {\n\tthis.onAlways.push( arg );\n\n\treturn this;\n};\n\n/**\n * Registers a function to execute after Promise is resolved\n *\n * @method done\n * @memberOf keigai.Deferred\n * @param  {Function} arg Function to execute\n * @return {Object} {@link keigai.Deferred}\n * @example\n * var deferred = keigai.util.defer();\n *\n * deferred.done( function ( ... ) {\n *   ...\n * } );\n */\nDeferred.prototype.done = function ( arg ) {\n\tthis.onDone.push( arg );\n\n\treturn this;\n};\n\n/**\n * Registers a function to execute after Promise is rejected\n *\n * @method fail\n * @memberOf keigai.Deferred\n * @param  {Function} arg Function to execute\n * @return {Object} {@link keigai.Deferred}\n * @example\n * var deferred = keigai.util.defer();\n *\n * deferred.fail( function ( ... ) {\n *   ...\n * } );\n */\nDeferred.prototype.fail = function ( arg ) {\n\tthis.onFail.push( arg );\n\n\treturn this;\n};\n\n/**\n * Rejects the Promise\n *\n * @method reject\n * @memberOf keigai.Deferred\n * @param  {Mixed} arg Rejection outcome\n * @return {Object} {@link keigai.Deferred}\n * @example\n * var deferred = keigai.util.defer();\n *\n * deferred.reject( new Error( \"Something went wrong\" ) );\n */\nDeferred.prototype.reject = function ( arg ) {\n\tthis.promise.reject.call( this.promise, arg );\n\n\treturn this;\n};\n\n/**\n * Resolves the Promise\n *\n * @method resolve\n * @memberOf keigai.Deferred\n * @param  {Mixed} arg Resolution outcome\n * @return {Object} {@link keigai.Deferred}\n * @example\n * var deferred = keigai.util.defer();\n *\n * deferred.resolve( true );\n */\nDeferred.prototype.resolve = function ( arg ) {\n\tthis.promise.resolve.call( this.promise, arg );\n\n\treturn this;\n};\n\n/**\n * Registers handler(s) for the Promise\n *\n * @method then\n * @memberOf keigai.Deferred\n * @param  {Function} success Executed when/if promise is resolved\n * @param  {Function} failure [Optional] Executed when/if promise is broken\n * @return {Object} {@link Promise}\n * @example\n * var deferred = keigai.util.defer();\n *\n * deferred.then( function ( ... ) { ... }, function ( err ) { ... } )\n *         .then( function ( ... ) { ... }, function ( err ) { ... } );\n *\n * ...\n *\n * deferred.resolve( true );\n */\nDeferred.prototype.then = function ( success, failure ) {\n\treturn this.promise.then( success, failure );\n};\n\n/**\n * @namespace element\n */\nvar element = {\n\t/**\n\t * Appends an Element to an Element\n\t *\n\t * @memberOf appendTo\n\t * @memberOf element\n\t * @param  {Object} obj   Element\n\t * @param  {Object} child Child Element\n\t * @return {Object}       Element\n\t * @example\n\t * keigai.util.element.appendTo( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\n\t */\n\tappendTo : function ( obj, child ) {\n\t\tobj.appendChild( child );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Gets or sets an Element attribute\n\t *\n\t * @method attr\n\t * @memberOf element\n\t * @param  {Object} obj   Element\n\t * @param  {String} name  Attribute name\n\t * @param  {Mixed}  value Attribute value\n\t * @return {Object}       Element\n\t * @example\n\t * keigai.util.element.attr( document.querySelector( \"select\" ), \"selected\", \"option 1\" );\n\t */\n\tattr : function ( obj, key, value ) {\n\t\tvar target, result;\n\n\t\tif ( regex.svg.test( obj.namespaceURI ) ) {\n\t\t\tif ( value === undefined ) {\n\t\t\t\tresult = obj.getAttributeNS( obj.namespaceURI, key );\n\n\t\t\t\tif ( result === null || string.isEmpty( result ) ) {\n\t\t\t\t\tresult = undefined;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tresult = utility.coerce( result );\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj.setAttributeNS( obj.namespaceURI, key, value );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif ( typeof value == \"string\" ) {\n\t\t\t\tvalue = string.trim( value );\n\t\t\t}\n\n\t\t\tif ( regex.checked_disabled.test( key ) && value === undefined ) {\n\t\t\t\treturn utility.coerce( obj[key] );\n\t\t\t}\n\t\t\telse if ( regex.checked_disabled.test( key ) && value !== undefined ) {\n\t\t\t\tobj[key] = value;\n\t\t\t}\n\t\t\telse if ( obj.nodeName === \"SELECT\" && key === \"selected\" && value === undefined ) {\n\t\t\t\treturn utility.dom( \"#\" + obj.id + \" option[selected=\\\"selected\\\"]\" )[0] || utility.dom( \"#\" + obj.id + \" option\" )[0];\n\t\t\t}\n\t\t\telse if ( obj.nodeName === \"SELECT\" && key === \"selected\" && value !== undefined ) {\n\t\t\t\ttarget = utility.dom( \"#\" + obj.id + \" option[selected=\\\"selected\\\"]\" )[0];\n\n\t\t\t\tif ( target !== undefined ) {\n\t\t\t\t\ttarget.selected = false;\n\t\t\t\t\ttarget.removeAttribute( \"selected\" );\n\t\t\t\t}\n\n\t\t\t\ttarget = utility.dom( \"#\" + obj.id + \" option[value=\\\"\" + value + \"\\\"]\" )[0];\n\t\t\t\ttarget.selected = true;\n\t\t\t\ttarget.setAttribute( \"selected\", \"selected\" );\n\t\t\t}\n\t\t\telse if ( value === undefined ) {\n\t\t\t\tresult = obj.getAttribute( key );\n\n\t\t\t\tif ( result === null || string.isEmpty( result ) ) {\n\t\t\t\t\tresult = undefined;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tresult = utility.coerce( result );\n\t\t\t\t}\n\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj.setAttribute( key, value );\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Clears an object's innerHTML, or resets it's state\n\t *\n\t * @method clear\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Object}     Element\n\t * @example\n\t * keigai.util.element.clear( document.querySelector( \"#something\" ) );\n\t */\n\tclear : function ( obj ) {\n\t\tif ( typeof obj.reset == \"function\" ) {\n\t\t\tobj.reset();\n\t\t}\n\t\telse if ( obj.value !== undefined ) {\n\t\t\telement.update( obj, {innerHTML: \"\", value: \"\"} );\n\t\t}\n\t\telse {\n\t\t\telement.update( obj, {innerHTML: \"\"} );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Creates an Element in document.body or a target Element.\n\t * An id is generated if not specified with args.\n\t *\n\t * @method create\n\t * @memberOf element\n\t * @param  {String} type Type of Element to create, or HTML String\n\t * @param  {Object} args [Optional] Properties to set\n\t * @param  {Object} obj  [Optional] Target Element\n\t * @param  {Mixed}  pos  [Optional] \"first\", \"last\" or Object describing how to add the new Element, e.g. {before: referenceElement}, default is \"last\"\n\t * @return {Mixed}       Element that was created, or an Array if `type` is a String of multiple Elements (frag)\n\t * @example\n\t * keigai.util.element.create( \"div\", {innerHTML: \"Hello World!\"}, document.querySelector( \"#something\" ) );\n\t * keigai.util.element.create( \"&lt;div&gt;Hello World!&lt;/div&gt;\" );\n\t */\n\tcreate : function ( type, args, obj, pos ) {\n\t\tvar svg  = false,\n\t\t    frag = false,\n\t\t    fragment, uid, result;\n\n\t\t// Removing potential HTML template formatting\n\t\ttype = type.replace( /\\t|\\n|\\r/g, \"\" );\n\n\t\tif ( obj ) {\n\t\t\tsvg = obj.namespaceURI && regex.svg.test( obj.namespaceURI );\n\t\t}\n\t\telse {\n\t\t\tobj = document.body;\n\t\t}\n\t\t\n\t\tif ( args instanceof Object && args.id && !utility.dom( \"#\" + args.id ) ) {\n\t\t\tuid = args.id;\n\t\t\tdelete args.id;\n\t\t}\n\t\telse if ( !svg ) {\n\t\t\tuid = utility.genId( undefined, true );\n\t\t}\n\n\t\t// String injection, create a frag and apply it\n\t\tif ( regex.html.test( type ) ) {\n\t\t\tfrag     = true;\n\t\t\tfragment = element.frag( type );\n\t\t\tresult   = fragment.childNodes.length === 1 ? fragment.childNodes[0] : array.cast( fragment.childNodes );\n\t\t}\n\t\t// Original syntax\n\t\telse {\n\t\t\tif ( !svg && !regex.svg.test( type ) ) {\n\t\t\t\tfragment = document.createElement( type );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfragment = document.createElementNS( \"http://www.w3.org/2000/svg\", type );\n\t\t\t}\n\n\t\t\tif ( uid ) {\n\t\t\t\tfragment.id = uid;\n\t\t\t}\n\n\t\t\tif ( args instanceof Object ) {\n\t\t\t\telement.update( fragment, args );\n\t\t\t}\n\t\t}\n\n\t\tif ( !pos || pos === \"last\" ) {\n\t\t\tobj.appendChild( fragment );\n\t\t}\n\t\telse if ( pos === \"first\" ) {\n\t\t\telement.prependChild( obj, fragment );\n\t\t}\n\t\telse if ( pos === \"after\" ) {\n\t\t\tpos = {after: obj};\n\t\t\tobj = obj.parentNode;\n\t\t\tobj.insertBefore( fragment, pos.after.nextSibling );\n\t\t}\n\t\telse if ( pos.after ) {\n\t\t\tobj.insertBefore( fragment, pos.after.nextSibling );\n\t\t}\n\t\telse if ( pos === \"before\" ) {\n\t\t\tpos = {before: obj};\n\t\t\tobj = obj.parentNode;\n\t\t\tobj.insertBefore( fragment, pos.before );\n\t\t}\n\t\telse if ( pos.before ) {\n\t\t\tobj.insertBefore( fragment, pos.before );\n\t\t}\n\t\telse {\n\t\t\tobj.appendChild( fragment );\n\t\t}\n\n\t\treturn !frag ? fragment : result;\n\t},\n\n\t/**\n\t * Gets or sets a CSS style attribute on an Element\n\t *\n\t * @method css\n\t * @memberOf element\n\t * @param  {Object} obj   Element\n\t * @param  {String} key   CSS to put in a style tag\n\t * @param  {String} value [Optional] Value to set\n\t * @return {Object}       Element\n\t * @example\n\t * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\", \"bold\" );\n\t * keigai.util.element.css( document.querySelector( \"#something\" ), \"font-weight\" ); // \"bold\"\n\t */\n\tcss : function ( obj, key, value ) {\n\t\tif ( !regex.caps.test( key ) ) {\n\t\t\tkey = string.toCamelCase( key );\n\t\t}\n\n\t\tif ( value !== undefined ) {\n\t\t\tobj.style[key] = value;\n\t\t\treturn obj;\n\t\t}\n\t\telse {\n\t\t\treturn obj.style[key];\n\t\t}\n\t},\n\n\t/**\n\t * Data attribute facade acting as a getter (with coercion) & setter\n\t *\n\t * @method data\n\t * @memberOf element\n\t * @param  {Object} obj   Element\n\t * @param  {String} key   Data key\n\t * @param  {Mixed}  value Boolean, Number or String to set\n\t * @return {Mixed}        undefined, Element or value\n\t * @example\n\t * // Setting\n\t * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"abc-1234\" );\n\t *\n\t * // Getting\n\t * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\" ); // \"abc-1234\"\n\t *\n\t * // Unsetting\n\t * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", null );\n\t *\n\t * // Setting a `null` value can be done by using a String\n\t * keigai.util.element.data( document.querySelector( \"#something\" ), \"id\", \"null\" );\n\t */\n\tdata : function ( obj, key, value ) {\n\t\tif ( value !== undefined ) {\n\t\t\tobj.setAttribute( \"data-\" + key, regex.json_wrap.test( value ) ? json.encode( value ) : value );\n\n\t\t\treturn obj;\n\t\t}\n\t\telse {\n\t\t\treturn utility.coerce( obj.getAttribute( \"data-\" + key ) );\n\t\t}\n\t},\n\n\t/**\n\t * Destroys an Element\n\t *\n\t * @method destroy\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Undefined} undefined\n\t * @example\n\t * keigai.util.element.destroy( document.querySelector( \"#something\" ) );\n\t */\n\tdestroy : function ( obj ) {\n\t\tif ( obj.parentNode !== null ) {\n\t\t\tobj.parentNode.removeChild( obj );\n\t\t}\n\n\t\treturn undefined;\n\t},\n\n\t/**\n\t * Disables an Element\n\t *\n\t * @method disable\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Object}     Element\n\t * @example\n\t * keigai.util.element.disable( document.querySelector( \"#something\" ) );\n\t */\n\tdisable : function ( obj ) {\n\t\tif ( typeof obj.disabled == \"boolean\" && !obj.disabled ) {\n\t\t\tobj.disabled = true;\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Dispatches a DOM Event from an Element\n\t *\n\t * `data` will appear as `Event.detail`\n\t *\n\t * @method dispatch\n\t * @memberOf element\n\t * @param  {Object}  obj        Element which dispatches the Event\n\t * @param  {String}  type       Type of Event to dispatch\n\t * @param  {Object}  data       [Optional] Data to include with the Event\n\t * @param  {Boolean} bubbles    [Optional] Determines if the Event bubbles, defaults to `true`\n\t * @param  {Boolean} cancelable [Optional] Determines if the Event can be canceled, defaults to `true`\n\t * @return {Object}             Element which dispatches the Event\n\t * @example\n\t * keigai.util.element.dispatch( document.querySelector( \"#something\" ), \"click\" );\n\t */\n\tdispatch : function ( obj, type, data, bubbles, cancelable ) {\n\t\tvar ev;\n\n\t\tif ( !obj ) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tev = new CustomEvent( type );\n\t\t}\n\t\tcatch ( e ) {\n\t\t\tev = document.createEvent( \"CustomEvent\" );\n\t\t}\n\n\t\tbubbles    = ( bubbles    !== false );\n\t\tcancelable = ( cancelable !== false );\n\n\t\tev.initCustomEvent( type, bubbles, cancelable, data || {} );\n\t\tobj.dispatchEvent( ev );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Enables an Element\n\t *\n\t * @method enable\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Object}     Element\n\t * @example\n\t * keigai.util.element.enable( document.querySelector( \"#something\" ) );\n\t */\n\tenable : function ( obj ) {\n\t\tif ( typeof obj.disabled == \"boolean\" && obj.disabled ) {\n\t\t\tobj.disabled = false;\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Finds descendant childNodes of Element matched by arg\n\t *\n\t * @method find\n\t * @memberOf element\n\t * @param  {Object} obj Element to search\n\t * @param  {String} arg Comma delimited string of descendant selectors\n\t * @return {Mixed}      Array of Elements or undefined\n\t * @example\n\t * keigai.util.element.find( document.querySelector( \"#something\" ), \"p\" );\n\t */\n\tfind : function ( obj, arg ) {\n\t\tvar result = [];\n\n\t\tutility.genId( obj, true );\n\n\t\tarray.each( string.explode( arg ), function ( i ) {\n\t\t\tresult = result.concat( utility.dom( \"#\" + obj.id + \" \" + i ) );\n\t\t} );\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Creates a document fragment\n\t *\n\t * @method frag\n\t * @memberOf element\n\t * @param  {String} arg [Optional] innerHTML\n\t * @return {Object}     Document fragment\n\t * @example\n\t * var frag = keigai.util.element.frag( \"Hello World!\" );\n\t */\n\tfrag : function ( arg ) {\n\t\tvar obj = document.createDocumentFragment();\n\n\t\tif ( arg ) {\n\t\t\tarray.each( array.cast( element.create( \"div\", {innerHTML: arg}, obj ).childNodes ), function ( i ) {\n\t\t\t\tobj.appendChild( i );\n\t\t\t} );\n\n\t\t\tobj.removeChild( obj.childNodes[0] );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Determines if Element has descendants matching arg\n\t *\n\t * @method has\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} arg Type of Element to find\n\t * @return {Boolean}    `true` if 1 or more Elements are found\n\t * @example\n\t * if ( keigai.util.element.has( document.querySelector( \"#something\" ), \"p\" ) ) {\n\t *   ...\n\t * }\n\t */\n\thas : function ( obj, arg ) {\n\t\tvar result = element.find( obj, arg );\n\n\t\treturn ( !isNaN( result.length ) && result.length > 0 );\n\t},\n\n\t/**\n\t * Determines if obj has a specific CSS class\n\t *\n\t * @method hasClass\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} arg CSS class to test for\n\t * @return {Boolean}    `true` if Element has `arg`\n\t * @example\n\t * if ( keigai.util.element.hasClass( document.querySelector( \"#something\" ), \"someClass\" ) ) {\n\t *   ...\n\t * }\n\t */\n\thasClass : function ( obj, arg ) {\n\t\treturn obj.classList.contains( arg );\n\t},\n\n\t/**\n\t * Returns a Boolean indidcating if the Object is hidden\n\t *\n\t * @method hidden\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Boolean}   `true` if hidden\n\t * @example\n\t * if ( keigai.util.element.hidden( document.querySelector( \"#something\" ) ) ) {\n\t *   ...\n\t * }\n\t */\n\thidden : function ( obj ) {\n\t\treturn obj.style.display === \"none\" || ( typeof obj.hidden == \"boolean\" && obj.hidden );\n\t},\n\n\t/**\n\t * Gets or sets an Elements innerHTML\n\t *\n\t * @method html\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} arg [Optional] innerHTML value\n\t * @return {Object}     Element\n\t * @example\n\t * keigai.util.element.html( document.querySelector( \"#something\" ), \"Hello World!\" );\n\t * keigai.util.element.html( document.querySelector( \"#something\" ) ); // \"Hello World!\"\n\t */\n\thtml : function ( obj, arg ) {\n\t\tif ( arg === undefined ) {\n\t\t\treturn obj.innerHTML;\n\t\t}\n\t\telse {\n\t\t\t obj.innerHTML = arg;\n\t\t\t return obj;\n\t\t}\n\t},\n\n\t/**\n\t * Determines if Element is equal to `arg`, supports nodeNames & CSS2+ selectors\n\t *\n\t * @method is\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} arg Property to query\n\t * @return {Boolean}    `true` if a match\n\t * @example\n\t * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \"div\" ) ) {\n\t *   ...\n\t * }\n\t *\n\t * if ( keigai.util.element.is( document.querySelector( \"#something\" ), \":first-child\" ) ) {\n\t *   ...\n\t * }\n\t */\n\tis : function ( obj, arg ) {\n\t\tif ( regex.selector_is.test( arg ) ) {\n\t\t\treturn ( element.find( obj.parentNode, obj.nodeName.toLowerCase() + arg ).filter( function ( i ) {\n\t\t\t\treturn i.id === obj.id;\n\t\t\t} ).length === 1 );\n\t\t}\n\t\telse {\n\t\t\treturn new RegExp( arg, \"i\" ).test( obj.nodeName );\n\t\t}\n\t},\n\n\t/**\n\t * Adds or removes a CSS class\n\t *\n\t * @method klass\n\t * @memberOf element\n\t * @param  {Object}  obj Element\n\t * @param  {String}  arg Class to add or remove ( can be a wildcard )\n\t * @param  {Boolean} add Boolean to add or remove, defaults to true\n\t * @return {Object}      Element\n\t * @example\n\t * // Adding a class\n\t * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\" );\n\t *\n\t * // Removing a class\n\t * keigai.util.element.klass( document.querySelector( \"#something\" ), \"newClass\", false );\n\t */\n\tklass : function ( obj, arg, add ) {\n\t\tadd = ( add !== false );\n\t\targ = string.explode( arg, \" \" );\n\n\t\tif ( add ) {\n\t\t\tarray.each( arg, function ( i ) {\n\t\t\t\tobj.classList.add( i );\n\t\t\t} );\n\t\t}\n\t\telse {\n\t\t\tarray.each( arg, function ( i ) {\n\t\t\t\tif ( i !== \"*\" ) {\n\t\t\t\t\tobj.classList.remove( i );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tarray.each( obj.classList, function ( x ) {\n\t\t\t\t\t\tthis.remove( x );\n\t\t\t\t\t} );\n\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Finds the position of an Element\n\t *\n\t * @method position\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Array}      Coordinates [left, top, right, bottom]\n\t * @example\n\t * var pos = keigai.util.element.position( document.querySelector( \"#something\" ) );\n\t */\n\tposition : function ( obj ) {\n\t\tobj = obj || document.body;\n\t\tvar left, top, right, bottom, height, width;\n\n\t\tleft   = top = 0;\n\t\twidth  = obj.offsetWidth;\n\t\theight = obj.offsetHeight;\n\n\t\tif ( obj.offsetParent ) {\n\t\t\ttop    = obj.offsetTop;\n\t\t\tleft   = obj.offsetLeft;\n\n\t\t\twhile ( obj = obj.offsetParent ) {\n\t\t\t\tleft += obj.offsetLeft;\n\t\t\t\ttop  += obj.offsetTop;\n\t\t\t}\n\n\t\t\tright  = document.body.offsetWidth  - ( left + width );\n\t\t\tbottom = document.body.offsetHeight - ( top  + height );\n\t\t}\n\t\telse {\n\t\t\tright  = width;\n\t\t\tbottom = height;\n\t\t}\n\n\t\treturn [left, top, right, bottom];\n\t},\n\n\t/**\n\t * Prepends an Element to an Element\n\t *\n\t * @method prependChild\n\t * @memberOf element\n\t * @param  {Object} obj   Element\n\t * @param  {Object} child Child Element\n\t * @return {Object}       Element\n\t * @example\n\t * keigai.util.element.prependChild( document.querySelector( \"#target\" ), document.querySelector( \"#something\" ) );\n\t */\n\tprependChild : function ( obj, child ) {\n\t\treturn obj.childNodes.length === 0 ? obj.appendChild( child ) : obj.insertBefore( child, obj.childNodes[0] );\n\t},\n\n\t/**\n\t * Removes an Element attribute\n\t *\n\t * @method removeAttr\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} key Attribute name\n\t * @return {Object}     Element\n\t * @example\n\t * keigai.util.element.removeAttr( document.querySelector( \"a\" ), \"href\" );\n\t */\n\tremoveAttr : function ( obj, key ) {\n\t\tvar target;\n\n\t\tif ( regex.svg.test( obj.namespaceURI ) ) {\n\t\t\tobj.removeAttributeNS( obj.namespaceURI, key );\n\t\t}\n\t\telse {\n\t\t\tif ( obj.nodeName === \"SELECT\" && key === \"selected\") {\n\t\t\t\ttarget = utility.dom( \"#\" + obj.id + \" option[selected=\\\"selected\\\"]\" )[0];\n\n\t\t\t\tif ( target ) {\n\t\t\t\t\ttarget.selected = false;\n\t\t\t\t\ttarget.removeAttribute( \"selected\" );\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj.removeAttribute( key );\n\t\t\t}\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Scrolls to the position of an Element\n\t *\n\t * @method scrollTo\n\t * @memberOf element\n\t * @param  {Object} obj        Element to scroll to\n\t * @param  {Number} ms         [Optional] Milliseconds to scroll, default is 250, min is 100\n\t * @param  {Number} offsetTop  [Optional] Offset from top of Element\n\t * @param  {Number} offsetLeft [Optional] Offset from left of Element\n\t * @return {Object} {@link Deferred}\n\t * @example\n\t * keigai.util.element.scrollTo( document.querySelector( \"#something\" ) ).then( function () {\n\t *   ...\n\t * } );\n\t */\n\tscrollTo : function ( obj, ms, offsetTop, offsetLeft ) {\n\t\tvar pos = array.remove( element.position( obj ), 2, 3 );\n\n\t\tif ( !isNaN( offsetTop ) ) {\n\t\t\tpos[0] += offsetTop;\n\t\t}\n\n\t\tif ( !isNaN( offsetLeft ) ) {\n\t\t\tpos[1] += offsetLeft;\n\t\t}\n\n\t\treturn client.scroll( pos, ms );\n\t},\n\n\t/**\n\t * Serializes the elements of an Element\n\t *\n\t * @method serialize\n\t * @memberOf element\n\t * @param  {Object}  obj    Element\n\t * @param  {Boolean} string [Optional] true if you want a query string, default is false ( JSON )\n\t * @param  {Boolean} encode [Optional] true if you want to URI encode the value, default is true\n\t * @return {Mixed}          String or Object\n\t * @example\n\t * var userInput = keigai.util.element.serialize( document.querySelector( \"form\" ) );\n\t */\n\tserialize : function ( obj, string, encode ) {\n\t\tstring       = ( string === true );\n\t\tencode       = ( encode !== false );\n\t\tvar registry = {},\n\t\t    children, result;\n\n\t\tchildren = obj.nodeName === \"FORM\" ? ( obj.elements ? array.cast( obj.elements ) : obj.find( \"button, input, select, textarea\" ) ) : [obj];\n\n\t\tarray.each( children, function ( i ) {\n\t\t\tvar id = i.id || i.name || i.type;\n\n\t\t\tif ( i.nodeName === \"FORM\" ) {\n\t\t\t\tutility.merge( registry, json.decode( element.serialize( i ) ) );\n\t\t\t}\n\t\t\telse if ( !registry[id] ) {\n\t\t\t\tregistry[id] = element.val( i );\n\t\t\t}\n\t\t} );\n\n\t\tif ( !string ) {\n\t\t\tresult = registry;\n\t\t}\n\t\telse {\n\t\t\tresult = \"\";\n\n\t\t\tutility.iterate( registry, function ( v, k ) {\n\t\t\t\tencode ? result += \"&\" + encodeURIComponent( k ) + \"=\" + encodeURIComponent( v ) : result += \"&\" + k + \"=\" + v;\n\t\t\t} );\n\n\t\t\tresult = result.replace( regex.and, \"?\" );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Returns the size of the Element\n\t *\n\t * @method size\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @return {Array}      [width, height]\n\t * @example\n\t * var size = keigai.util.element.size( document.querySelector( \"#something\" ) );\n\t */\n\tsize : function ( obj ) {\n\t\treturn [\n\t\t\tobj.offsetWidth  + number.parse( obj.style.paddingLeft || 0 ) + number.parse( obj.style.paddingRight  || 0 ) + number.parse( obj.style.borderLeft || 0 ) + number.parse( obj.style.borderRight  || 0 ),\n\t\t\tobj.offsetHeight + number.parse( obj.style.paddingTop  || 0 ) + number.parse( obj.style.paddingBottom || 0 ) + number.parse( obj.style.borderTop  || 0 ) + number.parse( obj.style.borderBottom || 0 )\n\t\t];\n\t},\n\n\t/**\n\t * Getter / setter for an Element's text\n\t *\n\t * @method text\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} arg [Optional] Value to set\n\t * @return {Object}     Element\n\t * @example\n\t * var obj  = document.querySelector( \"#something\" ),\n\t *     text = keigai.util.element.text( obj );\n\t *\n\t * keigai.util.element.text( obj, text + \", and some more text\" );\n\t */\n\ttext : function ( obj, arg ) {\n\t\tvar key     = obj.textContent ? \"textContent\" : \"innerText\",\n\t\t    payload = {},\n\t\t    set     = false;\n\n\t\tif ( typeof arg != \"undefined\" ) {\n\t\t\tset          = true;\n\t\t\tpayload[key] = arg;\n\t\t}\n\n\t\treturn set ? element.update( obj, payload ) : obj[key];\n\t},\n\n\t/**\n\t * Toggles a CSS class\n\t *\n\t * @method toggleClass\n\t * @memberOf element\n\t * @param  {Object} obj Element\n\t * @param  {String} arg CSS class to toggle\n\t * @return {Object}     Element\n\t * @example\n\t * var obj = document.querySelector( \"#something\" );\n\t *\n\t * obj.addEventListener( \"click\", function ( ev ) {\n\t *   keigai.util.element.toggleClass( obj, \"active\" );\n\t * }, false );\n\t */\n\ttoggleClass : function ( obj, arg ) {\n\t\tobj.classList.toggle( arg );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Updates an Element\n\t *\n\t * @method update\n\t * @memberOf element\n\t * @param  {Object}  obj  Element\n\t * @param  {Object} args Properties to set\n\t * @return {Object}      Element\n\t * @example\n\t * keigai.util.element.update( document.querySelector( \"#something\" ), {innerHTML: \"Hello World!\", \"class\": \"new\"} );\n\t */\n\tupdate : function ( obj, args ) {\n\t\tutility.iterate( args, function ( v, k ) {\n\t\t\tif ( regex.element_update.test( k ) ) {\n\t\t\t\tobj[k] = v;\n\t\t\t}\n\t\t\telse if ( k === \"class\" ) {\n\t\t\t\t!string.isEmpty( v ) ? element.klass( obj, v ) : element.klass( obj, \"*\", false );\n\t\t\t}\n\t\t\telse if ( k.indexOf( \"data-\" ) === 0 ) {\n\t\t\t\telement.data( obj, k.replace( \"data-\", \"\" ), v );\n\t\t\t}\n\t\t\telse {\n\t\t\t\telement.attr ( obj, k, v );\n\t\t\t}\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Gets or sets the value of Element\n\t *\n\t * @method val\n\t * @memberOf element\n\t * @param  {Object} obj   Element\n\t * @param  {Mixed}  value [Optional] Value to set\n\t * @return {Object}       Element\n\t * @example\n\t * keigai.util.element.val( document.querySelector( \"input[type='text']\" ), \"new value\" );\n\t */\n\tval : function ( obj, value ) {\n\t\tvar ev = \"input\",\n\t\t    output;\n\n\t\tif ( value === undefined ) {\n\t\t\tif ( regex.radio_checkbox.test( obj.type ) ) {\n\t\t\t\tif ( string.isEmpty( obj.name ) ) {\n\t\t\t\t\tthrow new Error( label.expectedProperty );\n\t\t\t\t}\n\n\t\t\t\tarray.each( utility.dom( \"input[name='\" + obj.name + \"']\" ), function ( i ) {\n\t\t\t\t\tif ( i.checked ) {\n\t\t\t\t\t\toutput = i.value;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse if ( regex.select.test( obj.type ) ) {\n\t\t\t\toutput = obj.options[obj.selectedIndex].value;\n\t\t\t}\n\t\t\telse if ( obj.value ) {\n\t\t\t\toutput = obj.value;\n\t\t\t}\n\t\t\telse {\n\t\t\t\toutput = element.text( obj );\n\t\t\t}\n\n\t\t\tif ( output !== undefined ) {\n\t\t\t\toutput = utility.coerce( output );\n\n\t\t\t\tif ( typeof output == \"string\" ) {\n\t\t\t\t\toutput = string.trim( output );\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\toutput = \"\";\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tvalue = value.toString();\n\n\t\t\tif ( regex.radio_checkbox.test( obj.type ) ) {\n\t\t\t\tev = \"click\";\n\n\t\t\t\tarray.each( utility.dom( \"input[name='\" + obj.name + \"']\" ), function ( i ) {\n\t\t\t\t\tif ( i.value === value ) {\n\t\t\t\t\t\ti.checked = true;\n\t\t\t\t\t\toutput = i;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse if ( regex.select.test( obj.type ) ) {\n\t\t\t\tev = \"change\";\n\n\t\t\t\tarray.each( element.find( obj, \"> *\" ), function ( i ) {\n\t\t\t\t\tif ( i.value === value ) {\n\t\t\t\t\t\ti.selected = true;\n\t\t\t\t\t\toutput = i;\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj.value !== undefined ? obj.value = value : element.text( obj, value );\n\t\t\t}\n\n\t\t\telement.dispatch( obj, ev );\n\n\t\t\toutput = obj;\n\t\t}\n\n\t\treturn output;\n\t}\n};\n\n/**\n * @namespace json\n */\nvar json = {\n\t/**\n\t * Decodes the argument\n\t *\n\t * @method decode\n\t * @memberOf json\n\t * @param  {String}  arg    String to parse\n\t * @param  {Boolean} silent [Optional] Silently fail\n\t * @return {Mixed}          Entity resulting from parsing JSON, or undefined\n\t * @example\n\t * var x = keigai.util.json.decode( ..., true );\n\t *\n\t * if ( x ) {\n\t *   ...\n\t * }\n\t * else {\n\t *   ... // invalid JSON, with `Error` suppressed by `silent`\n\t * }\n\t */\n\tdecode : function ( arg, silent ) {\n\t\ttry {\n\t\t\treturn JSON.parse( arg );\n\t\t}\n\t\tcatch ( e ) {\n\t\t\tif ( silent !== true ) {\n\t\t\t\tutility.error( e, arguments, this );\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t},\n\n\t/**\n\t * Encodes `arg` as JSON\n\t *\n\t * @method encode\n\t * @memberOf json\n\t * @param  {Mixed}   arg    Primative\n\t * @param  {Boolean} silent [Optional] Silently fail\n\t * @return {String}         JSON, or undefined\n\t * @example\n\t * var x = keigai.util.json.encode( ..., true );\n\t *\n\t * if ( x ) {\n\t *   ...\n\t * }\n\t * else {\n\t *   ... // invalid JSON, with `Error` suppressed by `silent`\n\t * }\n\t */\n\tencode : function ( arg, silent ) {\n\t\ttry {\n\t\t\treturn JSON.stringify( arg );\n\t\t}\n\t\tcatch ( e ) {\n\t\t\tif ( silent !== true ) {\n\t\t\t\tutility.error( e, arguments, this );\n\t\t\t}\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n};\n\n/**\n * @namespace label\n * @private\n */\nvar label = {\n\t/**\n\t * Expected a Number\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\texpectedNumber : \"Expected a Number\",\n\n\t/**\n\t * Expected a property, and it was not set\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\texpectedProperty : \"Expected a property, and it was not set\",\n\n\t/**\n\t * Expected an Object\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\texpectedObject : \"Expected an Object\",\n\n\t/**\n\t * One or more arguments is invalid\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tinvalidArguments : \"One or more arguments is invalid\",\n\n\t/**\n\t * INVALID_STATE_ERR: Headers have not been received\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tinvalidStateNoHeaders : \"INVALID_STATE_ERR: Headers have not been received\",\n\n\t/**\n\t * Synchronous XMLHttpRequest requests are not supported\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tinvalidStateNoSync : \"Synchronous XMLHttpRequest requests are not supported\",\n\n\t/**\n\t * INVALID_STATE_ERR: Object is not open\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tinvalidStateNotOpen : \"INVALID_STATE_ERR: Object is not open\",\n\n\t/**\n\t * INVALID_STATE_ERR: Object is sending\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tinvalidStateNotSending : \"INVALID_STATE_ERR: Object is sending\",\n\n\t/**\n\t * INVALID_STATE_ERR: Object is not usable\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tinvalidStateNotUsable : \"INVALID_STATE_ERR: Object is not usable\",\n\n\t/**\n\t * Defauly `emptyMsg` of DataLists\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tnoData : \"Nothing to display\",\n\n\t/**\n\t * Requested method is not available\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tnotAvailable : \"Requested method is not available\",\n\n\t/**\n\t * No previous version of a record\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tdatastoreNoPrevVersion : \"No previous version found\",\n\n\t/**\n\t * Server error has occurred\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tserverError : \"Server error has occurred\",\n\n\t/**\n\t * Forbidden to access URI\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tserverForbidden : \"Forbidden to access URI\",\n\n\t/**\n\t * Method not allowed\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tserverInvalidMethod : \"Method not allowed\",\n\n\t/**\n\t * Authorization required to access URI\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tserverUnauthorized : \"Authorization required to access URI\",\n\n\t/**\n\t * Your browser is too old to use keigai, please upgrade\n\t *\n\t * @type {String}\n\t * @memberOf label\n\t */\n\tupgrade : \"Your browser is too old to use keigai, please upgrade\"\n};\n\n/**\n * @namespace math\n */\nvar math = {\n\t/**\n\t * Generates bezier curve coordinates for up to 4 points, last parameter is `t`\n\t *\n\t * Two point example: (0, 10, 0, 0, 1) means move straight up\n\t *\n\t * @method bezier\n\t * @memberOf math\n\t * @return {Array} Coordinates\n\t * @example\n\t * // Moving straight down\n\t * var p1 = keigai.util.math.bezier( 0, 10, 2000, 10, 0 ),\n\t *     p2 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.5 ),\n\t *     p3 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.75 ),\n\t *     p4 = keigai.util.math.bezier( 0, 10, 2000, 10, 0.9 ),\n\t *     p5 = keigai.util.math.bezier( 0, 10, 2000, 10, 1 );\n\t */\n\tbezier : function () {\n\t\tvar a = array.cast( arguments ),\n\t\t    t = a.pop(),\n\t\t    P = array.chunk( a, 2 ),\n\t\t    n = P.length,\n\t\t    c, S0, Q0, Q1, Q2, C0, C1, C2, C3;\n\n\t\tif ( n < 2 || n > 4 ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\t// Setting variables\n\t\tc  = [];\n\t\tS0 = 1 - t;\n\t\tQ0 = math.sqr( S0 );\n\t\tQ1 = 2 * S0 * t;\n\t\tQ2 = math.sqr( t );\n\t\tC0 = Math.pow( S0, 3 );\n\t\tC1 = 3 * Q0 * t;\n\t\tC2 = 3 * S0 * Q2;\n\t\tC3 = Math.pow( t, 3 );\n\n\t\t// Straight\n\t\tif ( n === 2 ) {\n\t\t\tc.push( ( S0 * P[0][0] ) + ( t * P[1][0] ) );\n\t\t\tc.push( ( S0 * P[0][1] ) + ( t * P[1][1] ) );\n\t\t}\n\t\t// Quadratic\n\t\telse if ( n === 3 ) {\n\t\t\tc.push( ( Q0 * P[0][0] ) + ( Q1 * P[1][0] ) + ( Q2 + P[2][0] ) );\n\t\t\tc.push( ( Q0 * P[0][1] ) + ( Q1 * P[1][1] ) + ( Q2 + P[2][1] ) );\n\t\t}\n\t\t// Cubic\n\t\telse if ( n === 4 ) {\n\t\t\tc.push( ( C0 * P[0][0] ) + ( C1 * P[1][0] ) + ( C2 * P[2][0] ) + ( C3 * P[3][0] ) );\n\t\t\tc.push( ( C0 * P[0][1] ) + ( C1 * P[1][1] ) + ( C2 * P[2][1] ) + ( C3 * P[3][1] ) );\n\t\t}\n\n\t\treturn c;\n\t},\n\n\t/**\n\t * Finds the distance between 2 Arrays of coordinates\n\t *\n\t * @method dist\n\t * @memberOf math\n\t * @param  {Array} a Coordinates [x, y]\n\t * @param  {Array} b Coordinates [x, y]\n\t * @return {Number}  Distance between `a` & `b`\n\t * @example\n\t * var dist = keigai.util.math.dist( [4, 40], [-10, 12] );\n\t */\n\tdist : function ( a, b ) {\n\t\treturn Math.sqrt( math.sqr( b[0] - a[0] ) + math.sqr( b[1] - a[1] ) );\n\t},\n\n\t/**\n\t * Squares a Number\n\t *\n\t * @method sqr\n\t * @memberOf math\n\t * @param  {Number} n Number to square\n\t * @return {Number}   Squared value\n\t * @example\n\t * var sqr = keigai.util.math.sqr( 23 );\n\t */\n\tsqr : function ( n ) {\n\t\treturn Math.pow( n, 2 );\n\t}\n};\n\n/**\n * @namespace number\n */\nvar number = {\n\t/**\n\t * Returns the difference of arg\n\t *\n\t * @method diff\n\t * @memberOf number\n\t * @param {Number} arg Number to compare\n\t * @return {Number}    The absolute difference\n\t * @example\n\t * keigai.util.number.diff( -3, 8 ); // 11\n\t */\n\tdiff : function ( num1, num2 ) {\n\t\tif ( isNaN( num1 ) || isNaN( num2 ) ) {\n\t\t\tthrow new Error( label.expectedNumber );\n\t\t}\n\n\t\treturn Math.abs( num1 - num2 );\n\t},\n\n\t/**\n\t * Tests if an number is even\n\t *\n\t * @method even\n\t * @memberOf number\n\t * @param {Number} arg Number to test\n\t * @return {Boolean}   True if even, or undefined\n\t * @example\n\t * var n = keigai.util.number.random( 10 );\n\t *\n\t * if ( keigai.util.number.even( n ) ) {\n\t *   ...\n\t * }\n\t */\n\teven : function ( arg ) {\n\t\treturn arg % 2 === 0;\n\t},\n\n\t/**\n\t * Formats a Number to a delimited String\n\t *\n\t * @method format\n\t * @memberOf number\n\t * @param  {Number} arg       Number to format\n\t * @param  {String} delimiter [Optional] String to delimit the Number with\n\t * @param  {String} every     [Optional] Position to insert the delimiter, default is 3\n\t * @return {String}           Number represented as a comma delimited String\n\t * @example\n\t * keigai.util.number.format( 1000 ); // \"1,000\"\n\t */\n\tformat : function ( arg, delimiter, every ) {\n\t\tif ( isNaN( arg ) ) {\n\t\t\tthrow new Error( label.expectedNumber );\n\t\t}\n\n\t\targ       = arg.toString();\n\t\tdelimiter = delimiter || \",\";\n\t\tevery     = every     || 3;\n\n\t\tvar d = arg.indexOf( \".\" ) > -1 ? \".\" + arg.replace( regex.number_format_1, \"\" ) : \"\",\n\t\t    a = arg.replace( regex.number_format_2, \"\" ).split( \"\" ).reverse(),\n\t\t    p = Math.floor( a.length / every ),\n\t\t    i = 1, n, b;\n\n\t\tfor ( b = 0; b < p; b++ ) {\n\t\t\tn = i === 1 ? every : ( every * i ) + ( i === 2 ? 1 : ( i - 1 ) );\n\t\t\ta.splice( n, 0, delimiter );\n\t\t\ti++;\n\t\t}\n\n\t\ta = a.reverse().join( \"\" );\n\n\t\tif ( a.charAt( 0 ) === delimiter ) {\n\t\t\ta = a.substring( 1 );\n\t\t}\n\n\t\treturn a + d;\n\t},\n\n\t/**\n\t * Returns half of a, or true if a is half of b\n\t *\n\t * @method half\n\t * @memberOf number\n\t * @param  {Number} a Number to divide\n\t * @param  {Number} b [Optional] Number to test a against\n\t * @return {Mixed}    Boolean if b is passed, Number if b is undefined\n\t * @example\n\t * if ( keigai.util.number.half( 2, 4 ) ) {\n\t *   ...\n\t * } );\n\t */\n\thalf : function ( a, b ) {\n\t\treturn b ? ( ( a / b ) === 0.5 ) : ( a / 2 );\n\t},\n\n\t/**\n\t * Tests if a number is odd\n\t *\n\t * @method odd\n\t * @memberOf number\n\t * @param  {Number} arg Number to test\n\t * @return {Boolean}    True if odd, or undefined\n\t * @example\n\t * var n = keigai.util.number.random( 10 );\n\t *\n\t * if ( keigai.util.number.odd( n ) ) {\n\t *   ...\n\t * }\n\t */\n\todd : function ( arg ) {\n\t\treturn !number.even( arg );\n\t},\n\n\t/**\n\t * Parses the number\n\t *\n\t * @method parse\n\t * @memberOf number\n\t * @param  {Mixed}  arg  Number to parse\n\t * @param  {Number} base Integer representing the base or radix\n\t * @return {Number}      Integer or float\n\t * @example\n\t * // Unsure if `n` is an int or a float\n\t * keigai.util.number.parse( n );\n\t */\n\tparse : function ( arg, base ) {\n\t\treturn ( base === undefined ) ? parseFloat( arg ) : parseInt( arg, base );\n\t},\n\n\t/**\n\t * Generates a random number between 0 and `arg`\n\t *\n\t * @method random\n\t * @memberOf number\n\t * @param  {Number} arg Ceiling for random number, default is 100\n\t * @return {Number}     Random number\n\t * @example\n\t * var n = keigai.util.math.random( 10 );\n\t */\n\trandom : function ( arg ) {\n\t\targ = arg || 100;\n\n\t\treturn Math.floor( Math.random() * ( arg + 1 ) );\n\t},\n\n\t/**\n\t * Rounds a number up or down\n\t *\n\t * @method round\n\t * @memberOf number\n\t * @param  {Number} arg       Number to round\n\t * @param  {String} direction [Optional] \"up\" or \"down\"\n\t * @return {Number}           Rounded interger\n\t * @example\n\t * keigai.util.math.round( n, \"down\" );\n\t */\n\tround : function ( arg, direction ) {\n\t\targ = number.parse( arg );\n\n\t\tif ( direction === undefined || string.isEmpty( direction ) ) {\n\t\t\treturn number.parse( arg.toFixed( 0 ) );\n\t\t}\n\t\telse if ( regex.down.test( direction ) ) {\n\t\t\treturn ~~( arg );\n\t\t}\n\t\telse {\n\t\t\treturn Math.ceil( arg );\n\t\t}\n\t}\n};\n\n/**\n * @namespace promise\n */\nvar promise = {\n\t/**\n\t * \"Unboxed\" Promise factory\n\t *\n\t * @method factory\n\t * @memberOf promise\n\t * @return {Object} {@link Promise}\n\t */\n\tfactory : function () {\n\t\tvar promise, pCatch, pResolve, pReject, pThen;\n\t\t\n\t\tpromise = new Promise( function ( resolve, reject ) {\n\t\t\tpResolve = resolve;\n\t\t\tpReject  = reject;\n\t\t} );\n\n\t\tpCatch = function () {\n\t\t\treturn promise[\"catch\"].apply( promise, arguments );\n\t\t};\n\n\t\tpThen = function () {\n\t\t\treturn promise.then.apply( promise, arguments );\n\t\t};\n\n\t\treturn {\"catch\": pCatch, resolve: pResolve, reject: pReject, then: pThen};\n\t}\n};\n\n/**\n * @namespace store\n */\nvar store = {\n\t/**\n\t * Decorates a DataStore on an Object\n\t *\n\t * @method factory\n\t * @memberOf store\n\t * @param  {Mixed}  recs [Optional] Data to set with this.batch\n\t * @param  {Object} args [Optional] Arguments to set on the store\n\t * @return {Object} {@link keigai.DataStore}\n\t * @example\n\t * var store = keigai.store(null, {key: \"guid\"});\n\t *\n\t * store.setUri( \"http://...\" ).then( function ( records ) {\n\t *   // Do something with the records\n\t * }, function ( e ) {\n\t *   // Handle `e`\n\t * } );\n\t */\n\tfactory : function ( recs, args ) {\n\t\tvar obj = new DataStore();\n\n\t\tif ( args instanceof Object ) {\n\t\t\tutility.merge( obj, args );\n\t\t}\n\n\t\tif ( recs !== null && typeof recs == \"object\" ) {\n\t\t\tobj.batch( \"set\", recs );\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * DataStore worker handler\n\t *\n\t * @method worker\n\t * @memberOf store\n\t * @param  {Object} ev Event\n\t * @return {Undefined} undefined\n\t * @private\n\t */\n\tworker : function ( ev ) {\n\t\tvar cmd     = ev.data.cmd,\n\t\t    records = ev.data.records,\n\t\t    clauses, cond, functions, indexes, index, result, sorted, where, values;\n\n\t\tif ( cmd === \"select\" ) {\n\t\t\twhere     = JSON.parse( ev.data.where );\n\t\t\tfunctions = ev.data.functions;\n\t\t\tclauses   = array.fromObject( where );\n\t\t\tsorted    = array.flat( clauses ).filter( function ( i, idx ) { return idx % 2 === 0; } ).sort( array.sort );\n\t\t\tindex     = sorted.join( \"|\" );\n\t\t\tvalues    = sorted.map( function ( i ) { return where[i]; } ).join( \"|\" );\n\t\t\tindexes   = ev.data.indexes;\n\t\t\tcond      = \"return ( \";\n\n\t\t\tif ( functions.length === 0 && indexes[index] ) {\n\t\t\t\tresult = ( indexes[index][values] || [] ).map( function ( i ) {\n\t\t\t\t\treturn records[i];\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif ( clauses.length > 1 ) {\n\t\t\t\t\tarray.each( clauses, function ( i, idx ) {\n\t\t\t\t\t\tvar b1 = \"( \";\n\n\t\t\t\t\t\tif ( idx > 0 ) {\n\t\t\t\t\t\t\tb1 = \" && ( \";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( array.contains( functions, i[0] ) ) {\n\t\t\t\t\t\t\tcond += b1 + i[1] + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if (!isNaN(i[1])) {\n\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif ( array.contains( functions, clauses[0][0] ) ) {\n\t\t\t\t\t\tcond += clauses[0][1] + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n\t\t\t\t\t}\n\t\t\t\t\telse if ( !isNaN( clauses[0][1] ) ) {\n\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcond += \" );\";\n\n\t\t\t\tresult = records.filter( new Function(\"rec\", cond ) );\n\t\t\t}\n\t\t}\n\t\telse if ( cmd === \"sort\" ) {\n\t\t\tresult = array.keySort( records, ev.data.query, \"data\" );\n\t\t}\n\n\t\tpostMessage( result );\n\t}\n};\n\n/**\n * Creates a new DataStore\n *\n * @constructor\n * @memberOf keigai\n * @extends {keigai.Base}\n * @example\n * var store = keigai.store();\n */\nfunction DataStore () {\n\tthis.autosave    = false;\n\tthis.callback    = null;\n\tthis.credentials = null;\n\tthis.lists       = [];\n\tthis.events      = true;\n\tthis.expires     = null;\n\tthis.headers     = {Accept: \"application/json\"};\n\tthis.ignore      = [];\n\tthis.index       = [];\n\tthis.indexes     = {key: {}};\n\tthis.key         = null;\n\tthis.loaded      = false;\n\tthis.mongodb     = \"\";\n\tthis.observer    = observable.factory();\n\tthis.records     = [];\n\tthis.source      = null;\n\tthis.total       = 0;\n\tthis.versions    = {};\n\tthis.versioning  = true;\n\tthis.views       = {};\n\tthis.uri         = null;\n}\n\n/**\n * Extending Base\n *\n * @memberOf keigai.DataGrid\n * @type {Object} {@link keigai.Base}\n */\nDataStore.prototype = base.factory();\n\n/**\n * Setting constructor loop\n *\n * @method constructor\n * @memberOf keigai.DataStore\n * @type {Function}\n * @private\n */\nDataStore.prototype.constructor = DataStore;\n\n/**\n * Batch sets or deletes data in the store\n *\n * @method batch\n * @memberOf keigai.DataStore\n * @param  {String}  type Type of action to perform ( set/del/delete )\n * @param  {Array}   data Array of keys or indices to delete, or Object containing multiple records to set\n * @param  {Boolean} sync [Optional] Syncs store with data, if true everything is erased\n * @return {Object} {@link keigai.Deferred}\n * @fires keigai.DataStore#beforeBatch Fires before the batch is queued\n * @fires keigai.DataStore#afterBatch Fires after the batch is queued\n * @fires keigai.DataStore#failedBatch Fires when an exception occurs\n * @example\n * store.batch( \"set\", [...] ).then( function ( records ) {\n *   ...\n * }, function ( err ) {\n *   ...\n * } );\n */\nDataStore.prototype.batch = function ( type, data, sync ) {\n\tsync          = ( sync === true );\n\tvar self      = this,\n\t    events    = this.events,\n\t    defer     = deferred.factory(),\n\t    deferreds = [];\n\n\tif ( !regex.set_del.test( type ) || ( sync && regex.del.test( type ) ) || typeof data != \"object\" ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\tif ( events ) {\n\t\t\tthis.dispatch( \"beforeBatch\", data );\n\t\t}\n\n\t\tif ( sync ) {\n\t\t\tthis.clear( sync );\n\t\t}\n\n\t\tif ( data.length === 0 ) {\n\t\t\tthis.loaded = true;\n\n\t\t\tif ( events ) {\n\t\t\t\tthis.dispatch( \"afterBatch\", this.records );\n\t\t\t}\n\n\t\t\tdefer.resolve( this.records );\n\t\t}\n\t\telse {\n\t\t\t// Batch deletion will create a sparse array, which will be compacted before re-indexing\n\t\t\tif ( type === \"del\" ) {\n\t\t\t\tarray.each( data, function ( i ) {\n\t\t\t\t\tdeferreds.push( self.del( i, false, true ) );\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tarray.each( data, function ( i ) {\n\t\t\t\t\tdeferreds.push( self.set( null, i, true ) );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tthis.loaded = false;\n\n\t\t\tutility.when( deferreds ).then( function ( args ) {\n\t\t\t\tself.loaded = true;\n\n\t\t\t\tif ( events ) {\n\t\t\t\t\tself.dispatch( \"afterBatch\", args );\n\t\t\t\t}\n\n\t\t\t\t// Forcing a clear of views to deal with async nature of workers & staggered loading\n\t\t\t\tarray.each( self.lists, function ( i ) {\n\t\t\t\t\ti.refresh( true );\n\t\t\t\t} );\n\n\t\t\t\tif ( type === \"del\" ) {\n\t\t\t\t\tself.records = array.compact( self.records );\n\t\t\t\t\tself.reindex();\n\t\t\t\t}\n\n\t\t\t\tif ( self.autosave ) {\n\t\t\t\t\tself.save();\n\t\t\t\t}\n\n\t\t\t\tdefer.resolve( args );\n\t\t\t}, function ( e ) {\n\t\t\t\tif ( events ) {\n\t\t\t\t\tself.dispatch( \"failedBatch\", e );\n\t\t\t\t}\n\n\t\t\t\tdefer.reject( e );\n\t\t\t} );\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Builds a URI\n *\n * @method buildUri\n * @memberOf keigai.DataStore\n * @param  {String} key Record key\n * @return {String}     URI\n * @example\n * var uri = store.buildUri( \"key\" );\n */\nDataStore.prototype.buildUri = function ( key ) {\n\tvar parsed = utility.parse( this.uri );\n\n\treturn parsed.protocol + \"//\" + parsed.host + parsed.pathname + ( regex.endslash.test( parsed.pathname ) ? \"\" : \"/\" ) + key;\n};\n\n/**\n * Clears the data object, unsets the uri property\n *\n * @method clear\n * @memberOf keigai.DataStore\n * @param  {Boolean} sync [Optional] Boolean to limit clearing of properties\n * @return {Object} {@link keigai.DataStore}\n * @fires keigai.DataStore#beforeClear Fires before the data is cleared\n * @fires keigai.DataStore#afterClear Fires after the data is cleared\n * @example\n * // Resyncing the records, if wired to an API\n * store.clear( true );\n *\n * // Resetting the store\n * store.clear();\n */\nDataStore.prototype.clear = function ( sync ) {\n\tsync       = ( sync === true );\n\tvar events = ( this.events === true ),\n\t    resave = ( this.autosave === true );\n\n\tif ( !sync ) {\n\t\tif ( events ) {\n\t\t\tthis.dispatch( \"beforeClear\" );\n\t\t}\n\n\t\tarray.each( this.lists, function ( i ) {\n\t\t\tif ( i ) {\n\t\t\t\ti.teardown( true );\n\t\t\t}\n\t\t} );\n\n\t\tthis.autosave    = false;\n\t\tthis.callback    = null;\n\t\tthis.credentials = null;\n\t\tthis.lists       = [];\n\t\tthis.events      = true;\n\t\tthis.expires     = null;\n\t\tthis.headers     = {Accept: \"application/json\"};\n\t\tthis.ignore      = [];\n\t\tthis.index       = [];\n\t\tthis.indexes     = {key: {}};\n\t\tthis.key         = null;\n\t\tthis.loaded      = false;\n\t\tthis.records     = [];\n\t\tthis.source      = null;\n\t\tthis.total       = 0;\n\t\tthis.versions    = {};\n\t\tthis.versioning  = true;\n\t\tthis.views       = {};\n\t\tthis.uri         = null;\n\n\t\tif ( events ) {\n\t\t\tthis.dispatch( \"afterClear\" );\n\t\t}\n\t}\n\telse {\n\t\tthis.indexes     = {key: {}};\n\t\tthis.loaded      = false;\n\t\tthis.records     = [];\n\t\tthis.total       = 0;\n\t\tthis.views       = {};\n\n\t\tarray.each( this.lists, function ( i ) {\n\t\t\tif ( i ) {\n\t\t\t\ti.refresh();\n\t\t\t}\n\t\t} );\n\t}\n\n\tif ( resave ) {\n\t\tthis.save();\n\t}\n\n\treturn this;\n};\n\n/**\n * Deletes a record based on key or index\n *\n * @method del\n * @memberOf keigai.DataStore\n * @param  {Mixed}   record  Record, key or index\n * @param  {Boolean} reindex [Optional] `true` if DataStore should be reindexed\n * @param  {Boolean} batch   [Optional] `true` if part of a batch operation\n * @return {Object} {@link keigai.Deferred}\n * @fires keigai.DataStore#beforeDelete Fires before the record is deleted\n * @fires keigai.DataStore#afterDelete Fires after the record is deleted\n * @fires keigai.DataStore#failedDelete Fires if the store is RESTful and the action is denied\n * @example\n * store.del( \"key\" ).then( function () {\n *   console.log( \"Successfully deleted \" + key );\n * }, function ( err ) {\n *   console.warn( \"Failed to delete \" + key + \": \" + err.message );\n * } );\n */\nDataStore.prototype.del = function ( record, reindex, batch ) {\n\trecord    = record.key ? record : this.get ( record );\n\treindex   = ( reindex !== false );\n\tbatch     = ( batch === true );\n\tvar self  = this,\n\t    defer = deferred.factory();\n\n\tif ( record === undefined ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\tif ( this.events ) {\n\t\t\tself.dispatch( \"beforeDelete\", record );\n\t\t}\n\n\t\tif ( this.uri === null || this.callback !== null ) {\n\t\t\tthis.delComplete( record, reindex, batch, defer );\n\t\t}\n\t\telse {\n\t\t\tclient.request( this.buildUri( record.key ), \"DELETE\", null, utility.merge( {withCredentials: this.credentials}, this.headers ) ).then( function () {\n\t\t\t\tself.delComplete( record, reindex, batch, defer );\n\t\t\t}, function ( e ) {\n\t\t\t\tself.dispatch( \"failedDelete\", e );\n\t\t\t\tdefer.reject( e );\n\t\t\t} );\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Delete completion\n *\n * @method delComplete\n * @memberOf keigai.DataStore\n * @param  {Object}  record  DataStore record\n * @param  {Boolean} reindex `true` if DataStore should be reindexed\n * @param  {Boolean} batch   `true` if part of a batch operation\n * @param  {Object}  defer   Deferred instance\n * @return {Object} {@link keigai.DataStore}\n * @private\n */\nDataStore.prototype.delComplete = function ( record, reindex, batch, defer ) {\n\tvar self = this;\n\n\tdelete this.indexes.key[record.key];\n\tdelete this.versions[record.key];\n\n\tthis.total--;\n\tthis.views = {};\n\n\tif ( !batch ) {\n\t\tarray.remove( this.records, record.index );\n\n\t\tif ( reindex ) {\n\t\t\tthis.reindex();\n\t\t}\n\t\telse {\n\t\t\tarray.each( record.indexes, function ( i ) {\n\t\t\t\tarray.remove( self.indexes[i[0]][i[1]], record.index );\n\n\t\t\t\tif ( self.indexes[i[0]][i[1]].length === 0 ) {\n\t\t\t\t\tdelete self.indexes[i[0]][i[1]];\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tif ( this.autosave ) {\n\t\t\tthis.purge( record.key );\n\t\t}\n\n\t\tif ( this.events ) {\n\t\t\tthis.dispatch( \"afterDelete\", record );\n\t\t}\n\n\t\tarray.each( this.lists, function ( i ) {\n\t\t\ti.refresh();\n\t\t} );\n\t}\n\telse {\n\t\tthis.records[record.index] = null;\n\t}\n\n\treturn defer.resolve( record.key );\n};\n\n/**\n * Exports a subset or complete record set of DataStore\n *\n * @method dump\n * @memberOf keigai.DataStore\n * @param  {Array} args   [Optional] Sub-data set of DataStore\n * @param  {Array} fields [Optional] Fields to export, defaults to all\n * @return {Array}        Records\n * @example\n * var data = store.dump();\n */\nDataStore.prototype.dump = function ( args, fields ) {\n\targs       = args || this.records;\n\tvar self   = this,\n\t    custom = ( fields instanceof Array && fields.length > 0 ),\n\t    key    = this.key !== null,\n\t    fn;\n\n\tif ( custom ) {\n\t\tfn = function ( i ) {\n\t\t\tvar record = {};\n\n\t\t\tarray.each( fields, function ( f ) {\n\t\t\t\trecord[f] = f === self.key ? ( isNaN( i.key ) ? i.key : Number( i.key ) ) : utility.clone( i.data[f], true );\n\t\t\t} );\n\n\t\t\treturn record;\n\t\t};\n\t}\n\telse {\n\t\tfn = function ( i ) {\n\t\t\tvar record = {};\n\n\t\t\tif ( key ) {\n\t\t\t\trecord[self.key] = isNaN( i.key ) ? i.key : Number( i.key );\n\t\t\t}\n\n\t\t\tutility.iterate( i.data, function ( v, k ) {\n\t\t\t\trecord[k] = utility.clone( v, true );\n\t\t\t} );\n\n\t\t\treturn record;\n\t\t};\n\t}\n\n\treturn args.map( fn );\n};\n\n/**\n * Retrieves the current version of a record(s) based on key or index\n *\n * If the key is an integer, cast to a string before sending as an argument!\n *\n * @method get\n * @memberOf keigai.DataStore\n * @param  {Mixed}  record Key, index or Array of pagination start & end; or comma delimited String of keys or indices\n * @param  {Number} offset [Optional] Offset from `record` for pagination\n * @return {Mixed}         Individual record, or Array of records\n * @example\n * var record = store.get( \"key\" );\n */\nDataStore.prototype.get = function ( record, offset ) {\n\tvar type = typeof record,\n\t    self = this,\n\t    result;\n\n\tif ( type === \"undefined\" ) {\n\t\tresult = this.records;\n\t}\n\telse if ( type === \"string\" ) {\n\t\tif ( record.indexOf( \",\" ) === -1 ) {\n\t\t\tresult = this.records[this.indexes.key[record]];\n\t\t}\n\t\telse {\n\t\t\tresult = string.explode( record ).map( function ( i ) {\n\t\t\t\tif ( !isNaN( i ) ) {\n\t\t\t\t\treturn self.records[parseInt( i, 10 )];\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\treturn self.records[self.indexes.key[i]];\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\telse if ( type === \"number\" ) {\n\t\tif ( isNaN( offset ) ) {\n\t\t\tresult = this.records[parseInt( record, 10 )];\n\t\t}\n\t\telse {\n\t\t\tresult = array.limit( this.records, parseInt( record, 10 ), parseInt( offset, 10 ) );\n\t\t}\n\t}\n\n\treturn utility.clone( result, true );\n},\n\n/**\n * Performs an (INNER/LEFT/RIGHT) JOIN on two DataStores\n *\n * @method join\n * @memberOf keigai.DataStore\n * @param  {String} arg   DataStore to join\n * @param  {String} field Field in both DataStores\n * @param  {String} join  Type of JOIN to perform, defaults to `inner`\n * @return {Object} {@link keigai.Deferred}\n * var data = store.join( otherStore, \"commonField\" );\n */\nDataStore.prototype.join = function ( arg, field, join ) {\n\tjoin          = join || \"inner\";\n\tvar self      = this,\n\t    defer     = deferred.factory(),\n\t    results   = [],\n\t    deferreds = [],\n\t    key       = field === this.key,\n\t    keys      = array.merge( array.keys( this.records[0].data ), array.keys( arg.records[0].data ) ),\n\t    fn;\n\n\tif ( join === \"inner\" ) {\n\t\tfn = function ( i ) {\n\t\t\tvar where  = {},\n\t\t\t    record = i.data,\n\t\t\t    defer  = deferred.factory();\n\n\t\t\twhere[field] = key ? i.key : record[field];\n\t\t\t\n\t\t\targ.select( where ).then( function ( match ) {\n\t\t\t\tif ( match.length > 2 ) {\n\t\t\t\t\tdefer.reject( new Error( label.databaseMoreThanOne ) );\n\t\t\t\t}\n\t\t\t\telse if ( match.length === 1 ) {\n\t\t\t\t\tresults.push( utility.merge( record, match[0].data ) );\n\t\t\t\t\tdefer.resolve( true );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdefer.resolve( false );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tdeferreds.push( defer );\n\t\t};\n\t}\n\telse if ( join === \"left\" ) {\n\t\tfn = function ( i ) {\n\t\t\tvar where  = {},\n\t\t\t\trecord = i.data,\n\t\t\t    defer  = deferred.factory();\n\n\t\t\twhere[field] = key ? i.key : record[field];\n\n\t\t\targ.select( where ).then( function ( match ) {\n\t\t\t\tif ( match.length > 2 ) {\n\t\t\t\t\tdefer.reject( new Error( label.databaseMoreThanOne ) );\n\t\t\t\t}\n\t\t\t\telse if ( match.length === 1 ) {\n\t\t\t\t\tresults.push( utility.merge( record, match[0].data ) );\n\t\t\t\t\tdefer.resolve( true );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tarray.each( keys, function ( i ) {\n\t\t\t\t\t\tif ( record[i] === undefined ) {\n\t\t\t\t\t\t\trecord[i] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tresults.push( record );\n\t\t\t\t\tdefer.resolve( true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tdeferreds.push( defer );\n\t\t};\n\t}\n\telse if ( join === \"right\" ) {\n\t\tfn = function ( i ) {\n\t\t\tvar where  = {},\n\t\t\t    record = i.data,\n\t\t\t    defer  = deferred.factory();\n\n\t\t\twhere[field] = key ? i.key : record[field];\n\t\t\t\n\t\t\tself.select( where ).then( function ( match ) {\n\t\t\t\tif ( match.length > 2 ) {\n\t\t\t\t\tdefer.reject( new Error( label.databaseMoreThanOne ) );\n\t\t\t\t}\n\t\t\t\telse if ( match.length === 1 ) {\n\t\t\t\t\tresults.push( utility.merge( record, match[0].data ) );\n\t\t\t\t\tdefer.resolve( true );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tarray.each( keys, function ( i ) {\n\t\t\t\t\t\tif ( record[i] === undefined ) {\n\t\t\t\t\t\t\trecord[i] = null;\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\n\t\t\t\t\tresults.push( record );\n\t\t\t\t\tdefer.resolve( true );\n\t\t\t\t}\n\t\t\t} );\n\n\t\t\tdeferreds.push( defer );\n\t\t};\n\t}\n\n\tarray.each( utility.clone( join === \"right\" ? arg.records : this.records, true ), fn );\n\n\tutility.when( deferreds ).then( function () {\n\t\tdefer.resolve( results );\n\t}, function ( e ) {\n\t\tdefer.reject( e );\n\t} );\n\t\n\treturn defer;\n};\n\n/**\n * Retrieves only 1 field/property\n *\n * @method only\n * @memberOf keigai.DataStore\n * @param  {String} arg Field/property to retrieve\n * @return {Array}      Array of values\n * @example\n * var ages = store.only( \"age\" );\n */\nDataStore.prototype.only = function ( arg ) {\n\tif ( arg === this.key ) {\n\t\treturn this.records.map( function ( i ) {\n\t\t\treturn i.key;\n\t\t} );\n\t}\n\telse {\n\t\treturn this.records.map( function ( i ) {\n\t\t\treturn i.data[arg];\n\t\t} );\n\t}\n};\n\n/**\n * Purges DataStore or record from persistant storage\n *\n * @method purge\n * @memberOf keigai.DataStore\n * @param  {Mixed} arg  [Optional] String or Number for record\n * @return {Object}     Record or store\n * @example\n * store.purge();\n */\nDataStore.prototype.purge = function ( arg ) {\n\treturn this.storage( arg || this, \"remove\" );\n};\n\n/**\n * Reindexes the DataStore\n *\n * @method reindex\n * @memberOf keigai.DataStore\n * @return {Object} {@link keigai.DataStore}\n * @example\n * store.reindex();\n */\nDataStore.prototype.reindex = function () {\n\tvar self = this,\n\t    i    = -1,\n\t    tmp  = [];\n\n\tthis.views   = {};\n\tthis.indexes = {key: {}};\n\n\tif ( this.total > 0 ) {\n\t\tarray.each( this.records, function ( record ) {\n\t\t\tif ( record !== undefined ) {\n\t\t\t\ttmp[++i]     = record;\n\t\t\t\trecord.index = i;\n\t\t\t\tself.indexes.key[record.key] = i;\n\t\t\t\tself.setIndexes( record );\n\t\t\t}\n\t\t} );\n\t}\n\n\tthis.records = tmp;\n\n\treturn this;\n};\n\n/**\n * Restores DataStore or record persistant storage\n *\n * @method restore\n * @memberOf keigai.DataStore\n * @param  {Mixed} arg  [Optional] String or Number for record\n * @return {Object}     Record or store\n * @example\n * store.restore();\n */\nDataStore.prototype.restore = function ( arg ) {\n\treturn this.storage( arg || this, \"get\" );\n};\n\n/**\n * Saves DataStore or record to persistant storage, or sessionStorage\n *\n * @method save\n * @memberOf keigai.DataStore\n * @param  {Mixed} arg  [Optional] String or Number for record\n * @return {Object} {@link keigai.Deferred}\n * @example\n * store.save();\n */\nDataStore.prototype.save = function ( arg ) {\n\treturn this.storage( arg || this, \"set\" );\n};\n\n/**\n * Selects records (not by reference) based on an explicit description\n *\n * @method select\n * @memberOf keigai.DataStore\n * @param  {Object} where Object describing the WHERE clause\n * @return {Object} {@link keigai.Deferred}\n * @example\n * var adults;\n *\n * store.select( {age: function ( i ) { return i >= 21; } } ).then( function ( records ) {\n *   adults = records;\n * }, function ( err ) {\n *   ...\n * } );\n */\nDataStore.prototype.select = function ( where ) {\n\tvar self      = this,\n\t    defer     = deferred.factory(),\n\t    functions = [],\n\t    clauses, cond, index, result, sorted, values, worker;\n\n\tif ( !( where instanceof Object ) ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\tutility.iterate( where, function ( v, k ) {\n\t\t\tif ( typeof v == \"function\" ) {\n\t\t\t\tthis[k] = v.toString();\n\t\t\t\tfunctions.push( k );\n\t\t\t}\n\t\t} );\n\n\t\tif ( webWorker ) {\n\t\t\ttry {\n\t\t\t\tworker = utility.worker( defer );\n\t\t\t\tworker.postMessage( {cmd: \"select\", indexes: this.indexes, records: this.records, where: json.encode( where ), functions: functions} );\n\t\t\t}\n\t\t\tcatch ( e ) {\n\t\t\t\t// Probably IE10, which doesn't have the correct security flag for local loading\n\t\t\t\twebWorker = false;\n\n\t\t\t\tthis.select( where ).then( function ( arg ) {\n\t\t\t\t\tdefer.resolve( arg );\n\t\t\t\t}, function ( e ) {\n\t\t\t\t\tdefer.reject( e );\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tclauses = array.fromObject( where );\n\t\t\tsorted  = array.flat( clauses ).filter( function ( i, idx ) { return idx % 2 === 0; } ).sort( array.sort );\n\t\t\tindex   = sorted.join( \"|\" );\n\t\t\tvalues  = sorted.map( function ( i ) { return where[i]; } ).join( \"|\" );\n\t\t\tcond    = \"return ( \";\n\n\t\t\tif ( functions.length === 0 && this.indexes[index] ) {\n\t\t\t\tresult = ( this.indexes[index][values] || [] ).map( function ( i ) {\n\t\t\t\t\treturn self.records[i];\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tif ( clauses.length > 1 ) {\n\t\t\t\t\tarray.each( clauses, function ( i, idx ) {\n\t\t\t\t\t\tvar b1 = \"( \";\n\n\t\t\t\t\t\tif ( idx > 0 ) {\n\t\t\t\t\t\t\tb1 = \" && ( \";\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif ( i[1] instanceof Function ) {\n\t\t\t\t\t\t\tcond += b1 + i[1].toString() + \"( rec.data[\\\"\" + i[0] + \"\\\"] ) )\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse if ( !isNaN( i[1] ) ) {\n\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \" + i[1] + \" )\";\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcond += b1 + \"rec.data[\\\"\" + i[0] + \"\\\"] === \\\"\" + i[1] + \"\\\" )\";\n\t\t\t\t\t\t}\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tif ( clauses[0][1] instanceof Function ) {\n\t\t\t\t\t\tcond += clauses[0][1].toString() + \"( rec.data[\\\"\" + clauses[0][0] + \"\\\"] )\";\n\t\t\t\t\t}\n\t\t\t\t\telse if ( !isNaN( clauses[0][1] ) ) {\n\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \" + clauses[0][1];\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tcond += \"rec.data[\\\"\" + clauses[0][0] + \"\\\"] === \\\"\" + clauses[0][1] + \"\\\"\";\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tcond += \" );\";\n\n\t\t\t\tresult = utility.clone( this.records, true ).filter( new Function( \"rec\", cond ) );\n\t\t\t}\n\n\t\t\tdefer.resolve( result );\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Creates or updates an existing record\n *\n * @method set\n * @memberOf keigai.DataStore\n * @param  {Mixed}   key       [Optional] Integer or String to use as a Primary Key\n * @param  {Object}  data      Key:Value pairs to set as field values\n * @param  {Boolean} batch     [Optional] True if called by data.batch\n * @param  {Boolean} overwrite [Optional] Overwrites the existing record, if found\n * @return {Object} {@link keigai.Deferred}\n * @fires keigai.DataStore#beforeSet Fires before the record is set\n * @fires keigai.DataStore#afterSet Fires after the record is set, the record is the argument for listeners\n * @fires keigai.DataStore#failedSet Fires if the store is RESTful and the action is denied\n * @example\n * // Creating a new record\n * store.set( null, {...} );\n *\n * // Updating a record\n * store.set( \"key\", {...} );\n */\nDataStore.prototype.set = function ( key, data, batch, overwrite ) {\n\tdata       = utility.clone( data, true );\n\tbatch      = ( batch === true );\n\toverwrite  = ( overwrite === true );\n\tvar self   = this,\n\t    events = this.events,\n\t    defer  = deferred.factory(),\n\t    record = key !== null ? this.get( key ) || null : data[this.key] ? this.get( data[this.key] ) || null : null,\n\t    method = \"POST\",\n\t    parsed = utility.parse( self.uri || \"\" ),\n\t    uri, odata, rdefer;\n\n\tfunction patch ( overwrite, data, ogdata ) {\n\t\tvar ndata = [];\n\n\t\tif ( overwrite ) {\n\t\t\tarray.each( array.keys( ogdata ), function ( k ) {\n\t\t\t\tif ( k !== self.key && data[k] === undefined ) {\n\t\t\t\t\tndata.push( { op: \"remove\", path: \"/\" + k } );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tutility.iterate( data, function ( v, k ) {\n\t\t\tif ( k !== self.key && ogdata[k] === undefined ) {\n\t\t\t\tndata.push( { op: \"add\", path: \"/\" + k, value: v } );\n\t\t\t}\n\t\t\telse if ( json.encode( ogdata[k] ) !== json.encode( v ) ) {\n\t\t\t\tndata.push( { op: \"replace\", path: \"/\" + k, value: v } );\n\t\t\t}\n\t\t} );\n\n\t\treturn ndata;\n\t}\n\n\tif ( typeof data == \"string\" ) {\n\t\tif ( data.indexOf( \"//\" ) === -1 ) {\n\t\t\t// Relative path to store, i.e. a child\n\t\t\tif ( data.charAt( 0 ) !== \"/\" ) {\n\t\t\t\turi = this.buildUri( data );\n\t\t\t}\n\t\t\t// Root path, relative to store, i.e. a domain\n\t\t\telse if ( self.uri !== null && regex.root.test( data ) ) {\n\t\t\t\turi = parsed.protocol + \"//\" + parsed.host + data;\n\t\t\t}\n\t\t\telse {\n\t\t\t\turi = data;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\turi = data;\n\t\t}\n\n\t\tkey = uri.replace( regex.not_endpoint, \"\" );\n\n\t\tif ( string.isEmpty( key ) ) {\n\t\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t\t}\n\t\telse {\n\t\t\tif ( !batch && events ) {\n\t\t\t\tself.dispatch( \"beforeSet\", {key: key, data: data} );\n\t\t\t}\n\n\t\t\tclient.request( uri, \"GET\", null, utility.merge( {withCredentials: self.credentials}, self.headers ) ).then( function ( arg ) {\n\t\t\t\tself.setComplete( record, key, self.source ? utility.walk( arg, self.source ) : arg, batch, overwrite, defer );\n\t\t\t}, function ( e ) {\n\t\t\t\tself.dispatch( \"failedSet\", e );\n\t\t\t\tdefer.reject( e );\n\t\t\t} );\n\t\t}\n\t}\n\telse {\n\t\tif ( !batch && events ) {\n\t\t\tself.dispatch( \"beforeSet\", {key: key, data: data} );\n\t\t}\n\n\t\tif ( batch || this.uri === null ) {\n\t\t\tthis.setComplete( record, key, data, batch, overwrite, defer );\n\t\t}\n\t\telse {\n\t\t\tif ( key !== null ) {\n\t\t\t\turi    = this.buildUri( key );\n\t\t\t\tmethod = \"PATCH\";\n\t\t\t\todata  = utility.clone( data, true );\n\t\t\t\tdata   = patch( overwrite, data, this.dump( [ record ] )[ 0 ] );\n\t\t\t}\n\t\t\telse {\n\t\t\t\t// Dropping query string\n\t\t\t\turi = parsed.protocol + \"//\" + parsed.host + parsed.pathname;\n\t\t\t}\n\n\t\t\trdefer = client.request( uri, method, data, utility.merge( {withCredentials: this.credentials}, this.headers ) );\n\t\t\trdefer.then( function ( arg ) {\n\t\t\t\tvar change;\n\n\t\t\t\tif ( rdefer.xhr.status !== 204 && rdefer.xhr.status < 300 ) {\n\t\t\t\t\tchange = key === null ? ( self.source ? utility.walk( arg, self.source ) : arg ) : odata;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tchange = odata;\n\t\t\t\t}\n\n\t\t\t\tself.setComplete( record, key, change, batch, overwrite, defer );\n\t\t\t}, function ( e ) {\n\t\t\t\tif ( method == \"PATCH\" ) {\n\t\t\t\t\tmethod = \"PUT\";\n\t\t\t\t\tdata   = utility.clone( odata, true );\n\n\t\t\t\t\tutility.iterate( record.data, function ( v, k ) {\n\t\t\t\t\t\tdata[k] = v;\n\t\t\t\t\t} );\n\n\t\t\t\t\tclient.request( uri, method, data, utility.merge( {withCredentials: self.credentials}, self.headers ) ).then( function () {\n\t\t\t\t\t\tself.setComplete( record, key, odata, batch, overwrite, defer );\n\t\t\t\t\t}, function ( e ) {\n\t\t\t\t\t\tself.dispatch( \"failedSet\", e );\n\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tself.dispatch( \"failedSet\", e );\n\t\t\t\t\tdefer.reject( e );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Set completion\n *\n * @method setComplete\n * @memberOf keigai.DataStore\n * @param  {Mixed}   record    DataStore record, or `null` if new\n * @param  {String}  key       Record key\n * @param  {Object}  data      Record data\n * @param  {Boolean} batch     `true` if part of a batch operation\n * @param  {Boolean} overwrite Overwrites the existing record, if found\n * @param  {Object}  defer     Deferred instance\n * @return {Object} {@link keigai.DataStore}\n * @private\n */\nDataStore.prototype.setComplete = function ( record, key, data, batch, overwrite, defer ) {\n\t// Clearing views\n\tthis.views = {};\n\n\t// Setting key\n\tif ( key === null ) {\n\t\tif ( this.key !== null && data[this.key] !== undefined && data[this.key] !== null ) {\n\t\t\tkey = data[this.key].toString();\n\t\t}\n\t\telse {\n\t\t\tkey = utility.uuid();\n\t\t}\n\t}\n\n\t// Removing primary key from data\n\tif ( this.key ) {\n\t\tdelete data[this.key];\n\t}\n\n\t// Create\n\tif ( record === null ) {\n\t\trecord = {\n\t\t\tindex   : this.total++,\n\t\t\tkey     : key,\n\t\t\tdata    : data,\n\t\t\tindexes : []\n\t\t};\n\n\t\tthis.indexes.key[key]         = record.index;\n\t\tthis.records[record.index]    = record;\n\n\t\tif ( this.versioning ) {\n\t\t\tthis.versions[record.key] = lru.factory( VERSIONS );\n\t\t\tthis.versions[record.key].nth = 0;\n\t\t}\n\t}\n\t// Update\n\telse {\n\t\tif ( this.versioning ) {\n\t\t\tif ( this.versions[record.key] === undefined ) {\n\t\t\t\tthis.versions[record.key]     = lru.factory( VERSIONS );\n\t\t\t\tthis.versions[record.key].nth = 0;\n\t\t\t}\n\n\t\t\tthis.versions[record.key].set( \"v\" + ( ++this.versions[record.key].nth ), this.dump( [record] )[0] );\n\t\t}\n\n\t\t// By reference\n\t\trecord = this.records[record.index];\n\n\t\tif ( overwrite ) {\n\t\t\trecord.data = {};\n\t\t}\n\n\t\tutility.iterate( data, function ( v, k ) {\n\t\t\trecord.data[k] = v;\n\t\t} );\n\n\t\t// Snapshot that's safe to hand out\n\t\trecord = utility.clone( record, true );\n\t}\n\n\tthis.setIndexes( record );\n\n\tif ( !batch ) {\n\t\tif ( this.autosave ) {\n\t\t\tthis.save();\n\t\t}\n\n\t\tif ( this.events ) {\n\t\t\tthis.dispatch( \"afterSet\", record );\n\t\t}\n\n\t\tarray.each( this.lists, function ( i ) {\n\t\t\ti.refresh();\n\t\t} );\n\t}\n\n\tdefer.resolve( record );\n\n\treturn this;\n};\n\n/**\n * Gets or sets an explicit expiration of data\n *\n * @method setExpires\n * @memberOf keigai.DataStore\n * @param  {Number} arg Milliseconds until data is stale\n * @return {Object} {@link keigai.DataStore}\n * @example\n * store.setExpires( 5 * 60 * 1000 ); // Resyncs every 5 minutes\n */\nDataStore.prototype.setExpires = function ( arg ) {\n\tvar id      = this.id + \"Expire\",\n\t    expires = arg,\n\t    self    = this;\n\n\t// Expiry cannot be less than a second, and must be a valid scenario for consumption; null will disable repetitive expiration\n\tif ( ( arg !== null && this.uri === null ) || ( arg !== null && ( isNaN( arg ) || arg < 1000 ) ) ) {\n\t\tthrow new Error( label.invalidArguments );\n\t}\n\n\tif ( this.expires === arg ) {\n\t\treturn;\n\t}\n\n\tthis.expires = arg;\n\n\tutility.clearTimers( id );\n\n\tif ( arg === null ) {\n\t\treturn;\n\t}\n\n\tutility.repeat( function () {\n\t\tif ( self.uri === null ) {\n\t\t\tself.setExpires( null );\n\n\t\t\treturn false;\n\t\t}\n\n\t\tself.dispatch( \"beforeExpire\");\n\t\tcache.expire( self.uri );\n\t\tself.dispatch( \"expire\");\n\t\tself.dispatch( \"afterExpire\");\n\t}, expires, id, false );\n};\n\n/**\n * Sets indexes for a record using `store.indexes`\n *\n * Composite indexes are supported, but require keys be in alphabetical order, e.g. \"age|name\"\n *\n * @method setIndexes\n * @memberOf keigai.DataStore\n * @param  {Object} arg DataStore Record\n * @return {Object} {@link keigai.DataStore}\n * @example\n * store.setIndexes( record );\n */\nDataStore.prototype.setIndexes = function ( arg ) {\n\tvar self     = this,\n\t    delimter = \"|\";\n\n\targ.indexes = [];\n\n\tarray.each( this.index, function ( i ) {\n\t\tvar keys   = i.split( delimter ),\n\t\t    values = \"\";\n\n\t\tif ( self.indexes[i] === undefined ) {\n\t\t\tself.indexes[i] = {};\n\t\t}\n\n\t\tarray.each( keys, function ( k, kdx ) {\n\t\t\tvalues += ( kdx > 0 ? delimter : \"\" ) + arg.data[k];\n\t\t} );\n\n\t\tif ( self.indexes[i][values] === undefined ) {\n\t\t\tself.indexes[i][values] = [];\n\t\t}\n\n\t\tif ( !array.contains( self.indexes[i][values], arg.index ) ) {\n\t\t\tself.indexes[i][values].push( arg.index );\n\t\t\targ.indexes.push( [i, values] );\n\t\t}\n\t} );\n\n\treturn this;\n};\n\n/**\n * Sets the RESTful API end point\n *\n * @method setUri\n * @memberOf keigai.DataStore\n * @param  {String} arg API collection end point\n * @return {Object}     Deferred\n * @example\n * store.setUri( \"...\" ).then( function ( records ) {\n *   ...\n * }, function ( err ) {\n *   ...\n * } );\n */\nDataStore.prototype.setUri = function ( arg ) {\n\tvar defer = deferred.factory(),\n\t    parsed;\n\n\tif ( arg !== null && string.isEmpty( arg ) ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\n\tif ( arg === null ) {\n\t\tthis.uri = arg;\n\t}\n\telse {\n\t\tparsed   = utility.parse( arg );\n\t\tthis.uri = parsed.protocol + \"//\" + parsed.host + parsed.path;\n\n\t\tif ( !string.isEmpty( parsed.auth ) && !this.headers.authorization && !this.headers.Authorization ) {\n\t\t\tthis.headers.Authorization = \"Basic \" + btoa( decodeURIComponent( parsed.auth ) );\n\t\t}\n\n\t\tthis.on( \"expire\", function () {\n\t\t\tthis.sync();\n\t\t}, \"resync\", this );\n\n\t\tcache.expire( this.uri );\n\n\t\tthis.sync().then( function (arg ) {\n\t\t\tdefer.resolve( arg );\n\t\t}, function ( e ) {\n\t\t\tdefer.reject( e );\n\t\t} );\n\t}\n\n\treturn defer;\n};\n\n/**\n * Creates, or returns a cached view of the records (not by reference)\n *\n * @method sort\n * @memberOf keigai.DataStore\n * @param  {String} query  SQL ( style ) order by\n * @param  {String} create [Optional, default behavior is true, value is false] Boolean determines whether to recreate a view if it exists\n * @param  {Object} where  [Optional] Object describing the WHERE clause\n * @return {Object} {@link keigai.Deferred}\n * @example\n * store.sort( \"age desc, name\" ).then( function ( records ) {\n *   ...\n * }, function ( err ) {\n *   ...\n * } );\n */\nDataStore.prototype.sort = function ( query, create, where ) {\n\tcreate      = ( create === true || ( where instanceof Object ) );\n\tvar self    = this,\n\t    view    = string.toCamelCase( string.explode( query ).join( \" \" ) ),\n\t    defer   = deferred.factory(),\n\t    next, worker;\n\n\t// Next phase\n\tnext = function ( records ) {\n\t\tif ( self.total === 0 ) {\n\t\t\tdefer.resolve( [] );\n\t\t}\n\t\telse if ( !create && self.views[view] ) {\n\t\t\tdefer.resolve( self.views[view] );\n\t\t}\n\t\telse if ( webWorker ) {\n\t\t\tdefer.then( function ( arg ) {\n\t\t\t\tself.views[view] = arg;\n\n\t\t\t\treturn self.views[view];\n\t\t\t}, function ( e ) {\n\t\t\t\tutility.error( e );\n\t\t\t} );\n\n\t\t\ttry {\n\t\t\t\tworker = utility.worker( defer );\n\t\t\t\tworker.postMessage( {cmd: \"sort\", indexes: self.indexes, records: records, query: query} );\n\t\t\t}\n\t\t\tcatch ( e ) {\n\t\t\t\t// Probably IE10, which doesn't have the correct security flag for local loading\n\t\t\t\twebWorker = false;\n\n\t\t\t\tself.views[view] = array.keySort( records, query, \"data\" );\n\t\t\t\tdefer.resolve( self.views[view] );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tself.views[view] = array.keySort( records, query, \"data\" );\n\t\t\tdefer.resolve( self.views[view] );\n\t\t}\n\t};\n\n\tif ( !where ) {\n\t\tnext( utility.clone( this.records, true ) );\n\t}\n\telse {\n\t\tthis.select( where ).then( next, function ( e ) {\n\t\t\tdefer.reject( e );\n\t\t} );\n\t}\n\n\treturn defer;\n};\n\n/**\n * Storage interface\n *\n * SQL/NoSQL backends will be used if configured in lieu of localStorage (node.js only)\n *\n * @method storage\n * @memberOf keigai.DataStore\n * @param  {Mixed}  obj  Record ( Object, key or index ) or store\n * @param  {Object} op   Operation to perform ( get, remove or set )\n * @param  {String} type [Optional] Type of Storage to use ( local, session [local] )\n * @return {Object} {@link keigai.Deferred}\n * @example\n * store.storage( store, \"set\" );\n */\nDataStore.prototype.storage = function ( obj, op, type ) {\n\tvar self    = this,\n\t    record  = false,\n\t    mongo   = !string.isEmpty( this.mongodb ),\n\t    session = ( type === \"session\" && typeof sessionStorage != \"undefined\" ),\n\t    defer   = deferred.factory(),\n\t    data, key, result;\n\n\tif ( !regex.number_string_object.test( typeof obj ) || !regex.get_remove_set.test( op ) ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\trecord = ( regex.number_string.test( typeof obj ) || obj.hasOwnProperty( \"data\" ) );\n\n\t\tif ( op !== \"remove\" ) {\n\t\t\tif ( record && !( obj instanceof Object ) ) {\n\t\t\t\tobj = this.get( obj );\n\t\t\t}\n\n\t\t\tkey = record ? obj.key : obj.id;\n\t\t}\n\t\telse if ( op === \"remove\" && record ) {\n\t\t\tkey = obj.key || obj;\n\t\t}\n\n\t\tif ( mongo ) {\n\t\t\tmongodb.connect( this.mongodb, function ( e, db ) {\n\t\t\t\tif ( e ) {\n\t\t\t\t\tif ( db ) {\n\t\t\t\t\t\tdb.close();\n\t\t\t\t\t}\n\n\t\t\t\t\treturn defer.reject( e );\n\t\t\t\t}\n\n\t\t\t\tdb.collection( self.id, function ( e, collection ) {\n\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\treturn defer.reject( e );\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( op === \"get\" ) {\n\t\t\t\t\t\tif ( record ) {\n\t\t\t\t\t\t\tcollection.find( {_id: obj.key} ).limit( 1 ).toArray( function ( e, recs ) {\n\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse if ( recs.length === 0 ) {\n\t\t\t\t\t\t\t\t\tdefer.resolve( null );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdelete recs[0]._id;\n\n\t\t\t\t\t\t\t\t\tself.set( key, recs[0], true ).then( function ( rec ) {\n\t\t\t\t\t\t\t\t\t\tdefer.resolve( rec );\n\t\t\t\t\t\t\t\t\t}, function ( e ) {\n\t\t\t\t\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tcollection.find( {} ).toArray( function ( e, recs ) {\n\t\t\t\t\t\t\t\tvar i, nth;\n\n\t\t\t\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\treturn defer.reject( e );\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\ti   = -1;\n\t\t\t\t\t\t\t\tnth = recs.length;\n\n\t\t\t\t\t\t\t\tif ( nth > 0 ) {\n\t\t\t\t\t\t\t\t\tself.records = recs.map( function ( r ) {\n\t\t\t\t\t\t\t\t\t\tvar rec = {key: r._id, index: ++i, data: {}};\n\n\t\t\t\t\t\t\t\t\t\tself.indexes.key[rec.key] = rec.index;\n\t\t\t\t\t\t\t\t\t\trec.data = r;\n\t\t\t\t\t\t\t\t\t\tdelete rec.data._id;\n\t\t\t\t\t\t\t\t\t\tself.setIndexes( rec );\n\n\t\t\t\t\t\t\t\t\t\treturn rec;\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tself.total = nth;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\tdefer.resolve( self.records );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if ( op === \"remove\" ) {\n\t\t\t\t\t\tcollection.remove( record ? {_id: key} : {}, {safe: true}, function ( e, arg ) {\n\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\tdefer.resolve( arg );\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\telse if ( op === \"set\" ) {\n\t\t\t\t\t\tif ( record ) {\n\t\t\t\t\t\t\tcollection.update( {_id: obj.key}, obj.data, {w: 1, safe: true, upsert: true}, function ( e, arg ) {\n\t\t\t\t\t\t\t\tdb.close();\n\n\t\t\t\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdefer.resolve( arg );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t// Removing all documents & re-inserting\n\t\t\t\t\t\t\tcollection.remove( {}, {w: 1, safe: true}, function ( e ) {\n\t\t\t\t\t\t\t\tvar deferreds;\n\n\t\t\t\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\treturn defer.reject( e );\n\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\tdeferreds = [];\n\n\t\t\t\t\t\t\t\t\tarray.each( self.records, function ( i ) {\n\t\t\t\t\t\t\t\t\t\tvar data   = {},\n\t\t\t\t\t\t\t\t\t\t\tdefer2 = deferred.factory();\n\n\t\t\t\t\t\t\t\t\t\tdeferreds.push( defer2 );\n\n\t\t\t\t\t\t\t\t\t\tutility.iterate( i.data, function ( v, k ) {\n\t\t\t\t\t\t\t\t\t\t\tdata[k] = v;\n\t\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\t\tcollection.update( {_id: i.key}, data, {w:1, safe:true, upsert:true}, function ( e, arg ) {\n\t\t\t\t\t\t\t\t\t\t\tif ( e ) {\n\t\t\t\t\t\t\t\t\t\t\t\tdefer2.reject( e );\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\telse {\n\t\t\t\t\t\t\t\t\t\t\t\tdefer2.resolve( arg );\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t\t} );\n\n\t\t\t\t\t\t\t\t\tutility.when( deferreds ).then( function ( result ) {\n\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\tdefer.resolve( result );\n\t\t\t\t\t\t\t\t\t}, function ( e ) {\n\t\t\t\t\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tdb.close();\n\t\t\t\t\t\tdefer.reject( null );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t} );\n\t\t}\n\t\telse {\n\t\t\tif ( op === \"get\" ) {\n\t\t\t\tresult = session ? sessionStorage.getItem( key ) : localStorage.getItem( key );\n\n\t\t\t\tif ( result !== null ) {\n\t\t\t\t\tresult = json.decode( result );\n\n\t\t\t\t\tif ( record ) {\n\t\t\t\t\t\tself.set( key, result, true ).then( function ( rec ) {\n\t\t\t\t\t\t\tdefer.resolve( rec );\n\t\t\t\t\t\t}, function ( e ) {\n\t\t\t\t\t\t\tdefer.reject( e );\n\t\t\t\t\t\t} );\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\tutility.merge( self, result );\n\t\t\t\t\t\tdefer.resolve( self );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdefer.resolve( self );\n\t\t\t\t}\n\n\t\t\t\t// Decorating loaded state for various code paths\n\t\t\t\tdefer.then( function () {\n\t\t\t\t\tself.loaded = true;\n\t\t\t\t}, function ( e ) {\n\t\t\t\t\tthrow e;\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse if ( op === \"remove\" ) {\n\t\t\t\tsession ? sessionStorage.removeItem( key ) : localStorage.removeItem( key );\n\t\t\t\tdefer.resolve( this );\n\t\t\t}\n\t\t\telse if ( op === \"set\" ) {\n\t\t\t\tdata = json.encode( record ? obj.data : {total: this.total, index: this.index, indexes: this.indexes, records: this.records} );\n\t\t\t\tsession ? sessionStorage.setItem( key, data ) : localStorage.setItem( key, data );\n\t\t\t\tdefer.resolve( this );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tdefer.reject( null );\n\t\t\t}\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Syncs the DataStore with a URI representation\n *\n * @method sync\n * @memberOf keigai.DataStore\n * @return {Object} {@link keigai.Deferred}\n * @fires keigai.DataStore#beforeSync Fires before syncing the DataStore\n * @fires keigai.DataStore#afterSync Fires after syncing the DataStore\n * @fires keigai.DataStore#failedSync Fires when an exception occurs\n * @example\n * store.sync().then( function ( records ) {\n *   ...\n * }, function ( err ) {\n *   ...\n * } );\n */\nDataStore.prototype.sync = function () {\n\tvar self   = this,\n\t    events = ( this.events === true ),\n\t    defer  = deferred.factory(),\n\t    success, failure;\n\n\t/**\n\t * Resolves public deferred\n\t *\n\t * @method success\n\t * @memberOf keigai.DataStore.sync\n\t * @private\n\t * @param  {Object} arg API response\n\t * @return {Undefined}  undefined\n\t */\n\tsuccess = function ( arg ) {\n\t\tvar data;\n\n\t\tif ( typeof arg != \"object\" ) {\n\t\t\treturn failure( new Error( label.expectedObject ) );\n\t\t}\n\n\t\tif ( self.source !== null ) {\n\t\t\targ = utility.walk( arg, self.source );\n\t\t}\n\n\t\tif ( arg instanceof Array ) {\n\t\t\tdata = arg;\n\t\t}\n\t\telse {\n\t\t\tdata = [arg];\n\t\t}\n\n\t\tself.batch( \"set\", data, true ).then( function ( arg ) {\n\t\t\tif ( events ) {\n\t\t\t\tself.dispatch( \"afterSync\", arg );\n\t\t\t}\n\n\t\t\tdefer.resolve( arg );\n\t\t}, failure );\n\t};\n\n\t/**\n\t * Rejects public deferred\n\t *\n\t * @method failure\n\t * @memberOf keigai.DataStore.sync\n\t * @private\n\t * @param  {Object} e Error instance\n\t * @return {Undefined} undefined\n\t */\n\tfailure = function ( e ) {\n\t\tif ( events ) {\n\t\t\tself.dispatch( \"failedSync\", e );\n\t\t}\n\n\t\tdefer.reject( e );\n\t};\n\n\tif ( this.uri === null || string.isEmpty( this.uri ) ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\tif ( events ) {\n\t\t\tthis.dispatch( \"beforeSync\", this.uri );\n\t\t}\n\n\t\tif ( this.callback !== null ) {\n\t\t\tclient.jsonp( this.uri, {callback: this.callback} ).then( success, failure );\n\t\t}\n\t\telse {\n\t\t\tclient.request( this.uri, \"GET\", null, utility.merge( {withCredentials: this.credentials}, this.headers ) ).then( success, failure );\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Tears down a store & expires all records associated to an API\n *\n * @method teardown\n * @memberOf keigai.DataStore\n * @return {Object} {@link keigai.DataStore}\n * @example\n * store.teardown();\n */\nDataStore.prototype.teardown = function () {\n\tvar uri = this.uri,\n\t    id;\n\n\tif ( uri !== null ) {\n\t\tcache.expire( uri, true );\n\n\t\tid = this.id + \"DataExpire\";\n\t\tutility.clearTimers( id );\n\n\t\tarray.each( this.records, function ( i ) {\n\t\t\tvar recordUri = uri + \"/\" + i.key;\n\n\t\t\tcache.expire( recordUri, true );\n\t\t} );\n\t}\n\n\tarray.each( this.lists, function ( i ) {\n\t\ti.teardown( true );\n\t} );\n\n\tthis.clear( true );\n\tthis.dispatch( \"afterTeardown\" );\n\n\treturn this;\n};\n\n/**\n * Undoes the last modification to a record, if it exists\n *\n * @method undo\n * @memberOf keigai.DataStore\n * @param  {Mixed}  key     Key or index\n * @param  {String} version [Optional] Version to restore\n * @return {Object}         Deferred\n * @example\n * // Didn't like the new version, so undo the change\n * store.undo( \"key\", \"v1\" );\n */\nDataStore.prototype.undo = function ( key, version ) {\n\tvar record   = this.get( key ),\n\t    defer    = deferred.factory(),\n\t    versions = this.versions[record.key],\n\t    previous;\n\n\tif ( record === undefined ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\tif ( versions ) {\n\t\t\tprevious = versions.get( version || versions.first );\n\n\t\t\tif ( previous === undefined ) {\n\t\t\t\tdefer.reject( label.datastoreNoPrevVersion );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthis.set( key, previous ).then( function ( arg ) {\n\t\t\t\t\tdefer.resolve( arg );\n\t\t\t\t}, function ( e ) {\n\t\t\t\t\tdefer.reject( e );\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdefer.reject( label.datastoreNoPrevVersion );\n\t\t}\n\t}\n\n\treturn defer;\n};\n\n/**\n * Returns Array of unique values of `key`\n *\n * @method unique\n * @memberOf keigai.DataStore\n * @param  {String} key Field to compare\n * @return {Array}      Array of values\n * @example\n * var ages = store.unique( \"age\" );\n */\nDataStore.prototype.unique = function ( key ) {\n\treturn array.unique( this.records.map( function ( i ) {\n\t\treturn i.data[key];\n\t} ) );\n};\n\n/**\n * Applies a difference to a record\n *\n * Use `data.set()` if `data` is the complete field set\n *\n * @method update\n * @memberOf keigai.DataStore\n * @param  {Mixed}  key  Key or index\n * @param  {Object} data Key:Value pairs to set as field values\n * @return {Object} {@link keigai.Deferred}\n * @example\n * store.update( \"key\", {age: 34} );\n */\nDataStore.prototype.update = function ( key, data ) {\n\tvar record = this.get( key ),\n\t    defer  = deferred.factory();\n\n\tif ( record === undefined ) {\n\t\tdefer.reject( new Error( label.invalidArguments ) );\n\t}\n\telse {\n\t\tthis.set( key, utility.merge( record.data, data ) ).then( function ( arg ) {\n\t\t\tdefer.resolve( arg );\n\t\t}, function ( e ) {\n\t\t\tdefer.reject( e );\n\t\t} );\n\t}\n\n\treturn defer;\n};\n\n/**\n * @namespace string\n */\nvar string = {\n\t/**\n\t * Capitalizes the String\n\t *\n\t * @method capitalize\n\t * @memberOf string\n\t * @param  {String}  obj String to capitalize\n\t * @param  {Boolean} all [Optional] Capitalize each word\n\t * @return {String}      Capitalized String\n\t * @example\n\t * keigai.util.string.capitalize( \"hello\" ); // \"Hello\"\n\t */\n\tcapitalize : function ( obj, all ) {\n\t\tall = ( all === true );\n\n\t\tvar result;\n\n\t\tif ( all ) {\n\t\t\tresult = string.explode( obj, \" \" ).map( function ( i ) {\n\t\t\t\treturn i.charAt( 0 ).toUpperCase() + i.slice( 1 );\n\t\t\t} ).join(\" \");\n\t\t}\n\t\telse {\n\t\t\tresult = obj.charAt( 0 ).toUpperCase() + obj.slice( 1 );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Escapes meta characters within a string\n\t *\n\t * @method escape\n\t * @memberOf string\n\t * @param  {String} obj String to escape\n\t * @return {String}     Escaped string\n\t * @example\n\t * keigai.util.string.escape( \"{hello}\" ); // \"\\{hello\\}\"\n\t */\n\tescape : function ( obj ) {\n\t\treturn obj.replace( /[\\-\\[\\]{}()*+?.,\\\\\\/\\^\\$|#\\s]/g, \"\\\\$&\" );\n\t},\n\n\t/**\n\t * Splits a string on comma, or a parameter, and trims each value in the resulting Array\n\t *\n\t * @method explode\n\t * @memberOf string\n\t * @param  {String} obj String to capitalize\n\t * @param  {String} arg String to split on\n\t * @return {Array}      Array of the exploded String\n\t * @example\n\t * keigai.util.array.each( keigai.util.string.explode( \"abc, def\" ), function ( i ) {\n\t *   ...\n\t * } );\n\t */\n\texplode : function ( obj, arg ) {\n\t\targ = arg || \",\";\n\n\t\treturn string.trim( obj ).split( new RegExp( \"\\\\s*\" + arg + \"\\\\s*\" ) );\n\t},\n\n\t/**\n\t * Creates a String representation of an Object, preserving Functions\n\t *\n\t * Nested Objects are not supported\n\t *\n\t * @method fromObject\n\t * @memberOf string\n\t * @param  {Object} obj  Object to convert\n\t * @param  {String} name [Optional] Name of Object\n\t * @return {String}      String representation\n\t * @example\n\t * keigai.util.string.fromObject( {a: true, b: false}, \"stats\" ); // \"stats = {'a': true,'b':false}\"\n\t */\n\tfromObject : function ( obj, name ) {\n\t\tvar result = ( name ? name + \" = {\" : \"{\" ) + \"\\n\";\n\n\t\tutility.iterate( obj, function ( v, k ) {\n\t\t\tresult += \"\\\"\" + k + \"\\\":\" + v.toString() + \",\\n\";\n\t\t} );\n\n\t\tresult = result.replace( /\\[object Object\\]/g, \"{}\" ).replace( /,\\n$/, \"\\n\" ) + \"}\";\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Replaces all spaces in a string with dashes\n\t *\n\t * @method hyphenate\n\t * @memberOf string\n\t * @param  {String} obj   String to hyphenate\n\t * @param {Boolean} camel [Optional] Hyphenate camelCase\n\t * @return {String}       String with dashes instead of spaces\n\t * @example\n\t * keigai.util.string.hyphenate( \"hello world\" ); // \"hello-world\"\n\t */\n\thyphenate : function ( obj, camel ) {\n\t\tvar result = string.trim( obj ).replace( /\\s+/g, \"-\" );\n\n\t\tif ( camel === true ) {\n\t\t\tresult = result.replace( /([A-Z])/g, \"-$1\" ).toLowerCase();\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Tests if a string is a boolean\n\t *\n\t * @method isBoolean\n\t * @memberOf string\n\t * @param  {String}  obj String to test\n\t * @return {Boolean}     Result of test\n\t * @example\n\t * if ( keigai.util.string.isBoolean( ... ) {\n\t *   ...\n\t * } );\n\t */\n\tisBoolean : function ( obj ) {\n\t\treturn regex.bool.test( obj );\n\t},\n\n\t/**\n\t * Tests if a string is empty\n\t *\n\t * @method isEmpty\n\t * @memberOf string\n\t * @param  {String}  obj String to test\n\t * @return {Boolean}     Result of test\n\t * @example\n\t * if ( !keigai.util.string.isEmpty( ... ) {\n\t *   ...\n\t * } );\n\t */\n\tisEmpty : function ( obj ) {\n\t\treturn string.trim( obj ) === \"\";\n\t},\n\n\t/**\n\t * Tests if a string is a number\n\t *\n\t * @method isNumber\n\t * @memberOf string\n\t * @param  {String}  obj String to test\n\t * @return {Boolean}     Result of test\n\t * @example\n\t * if ( keigai.util.string.isNumber( ... ) {\n\t *   ...\n\t * } );\n\t */\n\tisNumber : function ( obj ) {\n\t\treturn regex.number.test( obj );\n\t},\n\n\t/**\n\t * Tests if a string is a URL\n\t *\n\t * @method isUrl\n\t * @memberOf string\n\t * @param  {String}  obj String to test\n\t * @return {Boolean}     Result of test\n\t * @example\n\t * if ( keigai.util.string.isUrl( ... ) {\n\t *   ...\n\t * } );\n\t */\n\tisUrl : function ( obj ) {\n\t\treturn regex.url.test( obj );\n\t},\n\n\t/**\n\t * Transforms the case of a String into CamelCase\n\t *\n\t * @method toCamelCase\n\t * @memberOf string\n\t * @param  {String} obj String to capitalize\n\t * @return {String}     Camel case String\n\t * @example\n\t * keigai.util.string.toCamelCase( \"hello world\" ); // \"helloWorld\"\n\t */\n\ttoCamelCase : function ( obj ) {\n\t\tvar s = string.trim( obj ).replace( /\\.|_|-|\\@|\\[|\\]|\\(|\\)|\\#|\\$|\\%|\\^|\\&|\\*|\\s+/g, \" \" ).toLowerCase().split( regex.space_hyphen ),\n\t\t    r = [];\n\n\t\tarray.each( s, function ( i, idx ) {\n\t\t\tr.push( idx === 0 ? i : string.capitalize( i ) );\n\t\t});\n\n\t\treturn r.join( \"\" );\n\t},\n\n\t/**\n\t * Returns singular form of the string\n\t *\n\t * @method singular\n\t * @memberOf string\n\t * @param  {String} obj String to transform\n\t * @return {String}     Transformed string\n\t * @example\n\t * keigai.util.string.singular( \"cans\" ); // \"can\"\n\t */\n\tsingular : function ( obj ) {\n\t\treturn obj.replace( /oe?s$/, \"o\" ).replace( /ies$/, \"y\" ).replace( /ses$/, \"se\" ).replace( /s$/, \"\" );\n\t},\n\n\t/**\n\t * Casts a String to a Function\n\t *\n\t * @method toFunction\n\t * @memberOf string\n\t * @param  {String} obj String to cast\n\t * @return {Function}   Function\n\t * @example\n\t * var fn = someFunction.toString();\n\t *\n\t * ...\n\t *\n\t * var func = keigai.util.string.toFunction( fn );\n\t */\n\ttoFunction : function ( obj ) {\n\t\tvar args = string.trim( obj.replace( /^.*\\(/, \"\" ).replace( /[\\t|\\r|\\n|\\\"|\\']+/g, \"\" ).replace( /\\).*/, \"\" ) ),\n\t\t    body = string.trim( obj.replace( /^.*\\{/, \"\" ).replace( /\\}$/, \"\" ) );\n\n\t\treturn Function.apply( Function, string.explode( args ).concat( [body] ) );\n\t},\n\n\t/**\n\t * Trims the whitespace around a String\n\t *\n\t * @method trim\n\t * @memberOf string\n\t * @param  {String} obj String to capitalize\n\t * @return {String}     Trimmed String\n\t * @example\n\t * keigai.util.string.trim( \"  hello world \" ); // \"hello world\"\n\t */\n\ttrim : function ( obj ) {\n\t\treturn obj.replace( /^(\\s+|\\t+|\\n+)|(\\s+|\\t+|\\n+)$/g, \"\" );\n\t},\n\n\t/**\n\t * Uncamelcases the String\n\t *\n\t * @method unCamelCase\n\t * @memberOf string\n\t * @param  {String} obj String to uncamelcase\n\t * @return {String}     Uncamelcased String\n\t */\n\tunCamelCase : function ( obj ) {\n\t\treturn string.trim( obj.replace( /([A-Z])/g, \" $1\" ).toLowerCase() );\n\t},\n\n\t/**\n\t * Uncapitalizes the String\n\t *\n\t * @method uncapitalize\n\t * @memberOf string\n\t * @param  {String} obj String to uncapitalize\n\t * @return {String}     Uncapitalized String\n\t * @example\n\t * keigai.util.string.uncapitalize( \"Hello\" ); // \"hello\"\n\t */\n\tuncapitalize : function ( obj ) {\n\t\tobj = string.trim( obj );\n\n\t\treturn obj.charAt( 0 ).toLowerCase() + obj.slice( 1 );\n\t},\n\n\t/**\n\t * Replaces all hyphens with spaces\n\t *\n\t * @method unhyphenate\n\t * @memberOf string\n\t * @param  {String}  obj  String to unhypenate\n\t * @param  {Boolean} caps [Optional] True to capitalize each word\n\t * @return {String}       Unhyphenated String\n\t * @example\n\t * keigai.util.string.unhyphenate( \"hello-world\" );       // \"hello world\"\n\t * keigai.util.string.unhyphenate( \"hello-world\", true ); // \"Hello World\"\n\t */\n\tunhyphenate : function ( obj, caps ) {\n\t\tif ( caps !== true ) {\n\t\t\treturn string.explode( obj, \"-\" ).join( \" \" );\n\t\t}\n\t\telse {\n\t\t\treturn string.explode( obj, \"-\" ).map( function ( i ) {\n\t\t\t\treturn string.capitalize( i );\n\t\t\t} ).join( \" \" );\n\t\t}\n\t}\n};\n\n/**\n * @namespace utility\n */\nvar utility = {\n\t/**\n\t * Collection of timers\n\t *\n\t * @memberOf utility\n\t * @type {Object}\n\t * @private\n\t */\n\ttimer : {},\n\n\t/**\n\t * Collection of repeating functions\n\t *\n\t * @memberOf utility\n\t * @type {Object}\n\t * @private\n\t */\n\trepeating: {},\n\n\t/**\n\t * Creates Elements or Queries the DOM using CSS selectors\n\t *\n\t * @method $\n\t * @memberOf utility\n\t * @param  {Mixed} arg HTML, or Comma delimited string of CSS selectors\n\t * @return {Array}     Array of matching Elements\n\t * @example\n\t * var $ = keigai.util.$;\n\t *\n\t * // Looking for Elements\n\t * $( \".someClass\" ).forEach( function ( i ) {\n\t *   ...\n\t * } );\n\t *\n\t * // Creating an H1 Element\n\t * $( \"&lt;h1&gt;\" ).forEach( function ( i ) {\n\t *   ...\n\t * } );\n\t */\n\t$ : function ( arg ) {\n\t\tvar result;\n\n\t\t// Nothing\n\t\tif ( !arg ) {\n\t\t}\n\t\t// HTML\n\t\telse if ( regex.html.test( arg ) ) {\n\t\t\tresult = [element.create( arg )];\n\t\t}\n\t\t// CSS selector(s)\n\t\telse {\n\t\t\targ = string.trim( arg );\n\n\t\t\tif ( arg.indexOf( \",\" ) === -1 ) {\n\t\t\t\tresult = utility.dom( arg );\n\n\t\t\t\tif ( result ) {\n\t\t\t\t\tif ( isNaN( result.length ) ) {\n\t\t\t\t\t\tresult = [result];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tresult = [];\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresult = [];\n\n\t\t\t\tarray.each( string.explode( arg ), function ( query ) {\n\t\t\t\t\tvar obj = utility.dom( query );\n\n\t\t\t\t\tif ( obj instanceof Array ) {\n\t\t\t\t\t\tresult = result.concat( obj );\n\t\t\t\t\t}\n\t\t\t\t\telse if ( obj ) {\n\t\t\t\t\t\tresult.push( obj );\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Creates an instance of Base\n\t *\n\t * @method base\n\t * @memberOf utility\n\t * @param  {Object} arg [Optional] Decorative Object\n\t * @return {Object}     Instance of Base\n\t */\n\tbase : function ( arg ) {\n\t\tvar obj = new Base();\n\n\t\tif ( arg instanceof Object ) {\n\t\t\tutility.merge( obj, arg );\n\t\t}\n\n\t\tobj.observer = observable.factory();\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Blob factory\n\t *\n\t * @method blob\n\t * @memberOf utility\n\t * @param  {String} arg String to convert to a Blob\n\t * @return {Object}     Blob\n\t * @private\n\t */\n\tblob : function ( arg ) {\n\t\tvar obj;\n\n\t\ttry {\n\t\t\tobj = new Blob( [arg], {type: \"application/javascript\"} );\n\t\t}\n\t\tcatch ( e ) {\n\t\t\tif ( !global.BlobBuilder ) {\n\t\t\t\tglobal.BlobBuilder = global.MSBlobBuilder || global.WebKitBlobBuilder || global.MozBlobBuilder;\n\t\t\t}\n\n\t\t\tobj = new global.BlobBuilder().append( arg ).getBlob();\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Clears deferred & repeating functions\n\t *\n\t * @method clearTimers\n\t * @memberOf utility\n\t * @param  {String} id ID of timer( s )\n\t * @return {Undefined} undefined\n\t * @private\n\t */\n\tclearTimers : function ( id ) {\n\t\tif ( id === undefined || string.isEmpty( id ) ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\t// deferred\n\t\tif ( utility.timer[id] ) {\n\t\t\tclearTimeout( utility.timer[id] );\n\t\t\tdelete utility.timer[id];\n\t\t}\n\n\t\t// repeating\n\t\tif ( utility.repeating[id] ) {\n\t\t\tclearTimeout( utility.repeating[id] );\n\t\t\tdelete utility.repeating[id];\n\t\t}\n\t},\n\n\t/**\n\t * Clones an Object\n\t *\n\t * @method clone\n\t * @memberOf utility\n\t * @param  {Object}  obj     Object to clone\n\t * @param  {Boolean} shallow [Optional] Create a shallow clone, which doesn't maintain prototypes, default is `false`\n\t * @return {Object}          Clone of obj\n\t * @example\n\t * var x = {a: true, b: false},\n\t *     y = keigai.util.clone( x, true );\n\t *\n\t * y.a; // true\n\t */\n\tclone : function ( obj, shallow ) {\n\t\tvar clone, result;\n\n\t\tif ( shallow === true ) {\n\t\t\treturn obj !== undefined && obj !== null ? json.decode( json.encode( obj ) ) : obj;\n\t\t}\n\t\telse if ( !obj || regex.primitive.test( typeof obj ) || ( obj instanceof RegExp ) ) {\n\t\t\treturn obj;\n\t\t}\n\t\telse if ( obj instanceof Array ) {\n\t\t\tresult = [];\n\n\t\t\tarray.each( obj, function ( i, idx ) {\n\t\t\t\tresult[ idx ] = utility.clone( i );\n\t\t\t} );\n\n\t\t\treturn result;\n\t\t}\n\t\telse if ( !server && !client.ie && obj instanceof Document ) {\n\t\t\treturn xml.decode( xml.encode( obj ) );\n\t\t}\n\t\telse if ( typeof obj.__proto__ != \"undefined\" ) {\n\t\t\treturn utility.extend( obj.__proto__, obj );\n\t\t}\n\t\telse if ( obj instanceof Object ) {\n\t\t\t// If JSON encoding fails due to recursion, the original Object is returned because it's assumed this is for decoration\n\t\t\tclone = json.encode( obj, true );\n\n\t\t\tif ( clone !== undefined ) {\n\t\t\t\tclone = json.decode( clone );\n\n\t\t\t\t// Decorating Functions that would be lost with JSON encoding/decoding\n\t\t\t\tutility.iterate( obj, function ( v, k ) {\n\t\t\t\t\tif ( typeof v == \"function\" ) {\n\t\t\t\t\t\tclone[k] = v;\n\t\t\t\t\t}\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tclone = obj;\n\t\t\t}\n\n\t\t\treturn clone;\n\t\t}\n\t\telse {\n\t\t\treturn obj;\n\t\t}\n\t},\n\n\t/**\n\t * Coerces a String to a Type\n\t *\n\t * @method coerce\n\t * @memberOf utility\n\t * @param  {String} value String to coerce\n\t * @return {Mixed}        Primitive version of the String\n\t * @example\n\t * keigai.util.coerce( \"1\" ); // 1\n\t */\n\tcoerce : function ( value ) {\n\t\tvar tmp;\n\n\t\tif ( value === null || value === undefined ) {\n\t\t\treturn undefined;\n\t\t}\n\t\telse if ( value === \"true\" ) {\n\t\t\treturn true;\n\t\t}\n\t\telse if ( value === \"false\" ) {\n\t\t\treturn false;\n\t\t}\n\t\telse if ( value === \"null\" ) {\n\t\t\treturn null;\n\t\t}\n\t\telse if ( value === \"undefined\" ) {\n\t\t\treturn undefined;\n\t\t}\n\t\telse if ( value === \"\" ) {\n\t\t\treturn value;\n\t\t}\n\t\telse if ( !isNaN( tmp = Number( value ) ) ) {\n\t\t\treturn tmp;\n\t\t}\n\t\telse if ( regex.json_wrap.test( value ) ) {\n\t\t\treturn json.decode( value, true ) || value;\n\t\t}\n\t\telse {\n\t\t\treturn value;\n\t\t}\n\t},\n\n\t/**\n\t * Recompiles a RegExp by reference\n\t *\n\t * This is ideal when you need to recompile a regex for use within a conditional statement\n\t *\n\t * @method compile\n\t * @memberOf utility\n\t * @param  {Object} regex     RegExp\n\t * @param  {String} pattern   Regular expression pattern\n\t * @param  {String} modifiers Modifiers to apply to the pattern\n\t * @return {Boolean}          true\n\t * @private\n\t */\n\tcompile : function ( reg, pattern, modifiers ) {\n\t\treg.compile( pattern, modifiers );\n\n\t\treturn true;\n\t},\n\n\t/**\n\t * Curries a Function\n\t *\n\t * Note: Function to curry must return a Function\n\t *\n\t * @method curry\n\t * @memberOf utility\n\t * @return {Function} Curried Function\n\t * @example\n\t * function f ( a, b ) {\n\t *   return function ( n ) {\n\t *     return ( a + b ) * n;\n\t *   };\n\t * }\n\t *\n\t * var g = keigai.util.curry( f, 2, 8 );\n\t *\n\t * g( 5 ); // 50\n\t */\n\tcurry : function () {\n\t\tvar args = array.cast( arguments ),\n\t\t    fn   = args.shift(),\n\t\t    cfn  = fn.apply( fn, args );\n\n\t\treturn function () {\n\t\t\treturn cfn.apply( cfn, arguments );\n\t\t};\n\t},\n\n\t/**\n\t * Defers the execution of Function by at least the supplied milliseconds.\n\t * Timing may vary under \"heavy load\" relative to the CPU & client JavaScript engine.\n\t *\n\t * @method defer\n\t * @memberOf utility\n\t * @param  {Function} fn     Function to defer execution of\n\t * @param  {Number}   ms     Milliseconds to defer execution\n\t * @param  {Number}   id     [Optional] ID of the deferred function\n\t * @param  {Boolean}  repeat [Optional] Describes the execution, default is `false`\n\t * @return {String}          ID of the timer\n\t * @private\n\t */\n\tdefer : function ( fn, ms, id, repeat ) {\n\t\tvar op;\n\n\t\tms     = ms || 0;\n\t\trepeat = ( repeat === true );\n\n\t\tif ( id !== undefined ) {\n\t\t\tutility.clearTimers( id );\n\t\t}\n\t\telse {\n\t\t\tid = utility.uuid( true );\n\t\t}\n\n\t\top = function () {\n\t\t\tutility.clearTimers( id );\n\t\t\tfn();\n\t\t};\n\n\t\tutility[repeat ? \"repeating\" : \"timer\"][id] = setTimeout( op, ms );\n\n\t\treturn id;\n\t},\n\n\t/**\n\t * Async delay strategy\n\t *\n\t * @method delay\n\t * @memberOf promise\n\t * @return {Function} Delay method\n\t * @private\n\t */\n\tdelay : function () {\n\t\tif ( typeof setImmediate != \"undefined\" ) {\n\t\t\treturn function ( arg ) {\n\t\t\t\tsetImmediate( arg );\n\t\t\t};\n\t\t}\n\t\telse if ( typeof process != \"undefined\" ) {\n\t\t\treturn process.nextTick;\n\t\t}\n\t\telse {\n\t\t\treturn function ( arg ) {\n\t\t\t\tsetTimeout( arg, 0 );\n\t\t\t};\n\t\t}\n\t}(),\n\n\t/**\n\t * Queries DOM with fastest method\n\t *\n\t * @method dom\n\t * @memberOf utility\n\t * @param  {String} arg DOM query\n\t * @return {Mixed}      undefined, Element, or Array of Elements\n\t * @private\n\t */\n\tdom : function ( arg ) {\n\t\tvar result;\n\n\t\tif ( !regex.selector_complex.test( arg ) ) {\n\t\t\tif ( regex.hash.test( arg ) ) {\n\t\t\t\tresult = document.getElementById( arg.replace( regex.hash, \"\" ) ) || undefined;\n\t\t\t}\n\t\t\telse if ( regex.klass.test( arg ) ) {\n\t\t\t\tresult = array.cast( document.getElementsByClassName( arg.replace( regex.klass, \"\" ) ) );\n\t\t\t}\n\t\t\telse if ( regex.word.test( arg ) ) {\n\t\t\t\tresult = array.cast( document.getElementsByTagName( arg ) );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tresult = array.cast( document.querySelectorAll( arg ) );\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tresult = array.cast( document.querySelectorAll( arg ) );\n\t\t}\n\n\t\treturn result;\n\t},\n\n\t/**\n\t * Encodes a UUID to a DOM friendly ID\n\t *\n\t * @method domId\n\t * @memberOf utility\n\t * @param  {String} UUID\n\t * @return {String} DOM friendly ID\n\t * @private\n\t */\n\tdomId : function ( arg ) {\n\t\treturn \"a\" + arg.replace( /-/g, \"\" ).slice( 1 );\n\t},\n\n\t/**\n\t * Error handling, with history in `error.log`\n\t *\n\t * @method error\n\t * @memberOf utility\n\t * @param  {Mixed}   e       Error object or message to display\n\t * @param  {Array}   args    Array of arguments from the callstack\n\t * @param  {Mixed}   scope   Entity that was \"this\"\n\t * @param  {Boolean} warning [Optional] Will display as console warning if true\n\t * @return {Undefined}       undefined\n\t * @private\n\t */\n\terror : function ( e, args, scope, warning ) {\n\t\tvar o = {\n\t\t\t\"arguments\" : args ? array.cast( args ) : [],\n\t\t\tmessage     : e.message || e,\n\t\t\tnumber      : e.number ? ( e.number & 0xFFFF ) : undefined,\n\t\t\tscope       : scope,\n\t\t\tstack       : e.stack || undefined,\n\t\t\ttimestamp   : new Date().toUTCString(),\n\t\t\ttype        : e.type || \"TypeError\"\n\t\t};\n\n\t\tutility.log( o.stack || o.message, warning !== true ? \"error\" : \"warn\" );\n\n\t\treturn undefined;\n\t},\n\n\t/**\n\t * Creates a \"class\" extending Object, with optional decoration\n\t *\n\t * @method extend\n\t * @memberOf utility\n\t * @param  {Object} obj Object to extend\n\t * @param  {Object} arg [Optional] Object for decoration\n\t * @return {Object}     Decorated obj\n\t * @example\n\t * var extendObj = keigai.util.extend( someObj, {newProperty: value} );\n\t */\n\textend : function ( obj, arg ) {\n\t\tvar o;\n\n\t\tif ( obj === undefined ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\to = Object.create( obj );\n\n\t\tif ( arg instanceof Object ) {\n\t\t\tutility.merge( o, arg );\n\t\t}\n\n\t\treturn o;\n\t},\n\n\t/**\n\t * Generates an ID value\n\t *\n\t * @method genId\n\t * @memberOf utility\n\t * @param  {Mixed}   obj [Optional] Object to receive id\n\t * @param  {Boolean} dom [Optional] Verify the ID is unique in the DOM, default is false\n\t * @return {Mixed}       Object or id\n\t * @private\n\t */\n\tgenId : function ( obj, dom ) {\n\t\tdom = ( dom === true );\n\t\tvar id;\n\n\t\tif ( obj && ( obj.id || ( obj instanceof Array ) || ( typeof obj == \"string\" || obj instanceof String ) ) ) {\n\t\t\treturn obj;\n\t\t}\n\n\t\tif ( dom ) {\n\t\t\tdo {\n\t\t\t\tid = utility.domId( utility.uuid( true ) );\n\t\t\t}\n\t\t\twhile ( utility.dom( \"#\" + id ) );\n\t\t}\n\t\telse {\n\t\t\tid = utility.domId( utility.uuid( true ) );\n\t\t}\n\n\t\tif ( typeof obj == \"object\" ) {\n\t\t\tobj.id = id;\n\n\t\t\treturn obj;\n\t\t}\n\t\telse {\n\t\t\treturn id;\n\t\t}\n\t},\n\n\t/**\n\t * Iterates an Object and executes a function against the properties.\n\t * Returning `false` halts iteration.\n\t *\n\t * @method iterate\n\t * @memberOf utility\n\t * @param  {Object}   obj Object to iterate\n\t * @param  {Function} fn  Function to execute against properties\n\t * @return {Object}       Object\n\t * @example\n\t * keigai.util.iterate( {...}, function ( value, key ) {\n\t *   ...\n\t * } );\n\t */\n\titerate : function ( obj, fn ) {\n\t\tarray.each( Object.keys( obj ), function ( i ) {\n\t\t\treturn fn.call( obj, obj[i], i );\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Writes argument to the console\n\t *\n\t * @method log\n\t * @memberOf utility\n\t * @param  {String} arg    String to write to the console\n\t * @param  {String} target [Optional] Target console, default is \"log\"\n\t * @return {Undefined}     undefined\n\t * @example\n\t * keigai.util.log( \"Something bad happened\", \"warn\" );\n\t */\n\tlog : function ( arg, target ) {\n\t\tvar ts, msg;\n\n\t\tif ( typeof console != \"undefined\" ) {\n\t\t\tts  = typeof arg != \"object\";\n\t\t\tmsg = ts ? \"[\" + new Date().toLocaleTimeString() + \"] \" + arg : arg;\n\t\t\tconsole[target || \"log\"]( msg );\n\t\t}\n\t},\n\n\t/**\n\t * Merges obj with arg\n\t *\n\t * @method merge\n\t * @memberOf utility\n\t * @param  {Object} obj Object to decorate\n\t * @param  {Object} arg Decoration\n\t * @return {Object}     Decorated Object\n\t * @example\n\t * var obj = {a: true};\n\t *\n\t * keigai.util.merge( obj, {b: false} )\n\t * obj.b; // false\n\t */\n\tmerge : function ( obj, arg ) {\n\t\tutility.iterate( arg, function ( v, k ) {\n\t\t\tif ( ( obj[k] instanceof Array ) && ( v instanceof Array ) ) {\n\t\t\t\tarray.merge( obj[k], v );\n\t\t\t}\n\t\t\telse if ( ( obj[k] instanceof Object ) && ( v instanceof Object ) ) {\n\t\t\t\tutility.iterate( v, function ( x, y ) {\n\t\t\t\t\tobj[k][y] = utility.clone( x );\n\t\t\t\t} );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tobj[k] = utility.clone( v );\n\t\t\t}\n\t\t} );\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Parses a URI into an Object\n\t *\n\t * @method parse\n\t * @memberOf utility\n\t * @param  {String} uri URI to parse\n\t * @return {Object}     Parsed URI\n\t * @example\n\t * var parsed = keigai.util.parse( location.href );\n\t *\n\t * parsed;\n\t * {\n\t *   auth     : \"\",\n\t *   hash     : \"\",\n\t *   host     : \"\",\n\t *   hostname : \"\",\n\t *   query    : {},\n\t *   pathname : \"\",\n\t *   port     : n,\n\t *   protocol : \"\",\n\t *   search   : \"\",\n\t * }\n\t */\n\tparse : function ( uri ) {\n\t\tvar obj    = {},\n\t\t    parsed = {},\n\t\t    host, protocol;\n\n\t\tif ( uri === undefined ) {\n\t\t\turi = !server ? location.href : \"\";\n\t\t}\n\n\t\tif ( !server ) {\n\t\t\tobj      = document.createElement( \"a\" );\n\t\t\tobj.href = uri;\n\t\t\thost     = obj.href.match( regex.host )[1];\n\t\t\tprotocol = obj.href.match( regex.protocol )[1];\n\t\t}\n\t\telse {\n\t\t\tobj = url.parse( uri );\n\t\t}\n\n\t\tif ( server ) {\n\t\t\tutility.iterate( obj, function ( v, k ) {\n\t\t\t\tif ( v === null ) {\n\t\t\t\t\tobj[k] = undefined;\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tparsed = {\n\t\t\tauth     : server ? null : regex.auth.exec( uri ),\n\t\t\tprotocol : obj.protocol || protocol,\n\t\t\thostname : obj.hostname || host,\n\t\t\tport     : obj.port ? number.parse( obj.port, 10 ) : \"\",\n\t\t\tpathname : obj.pathname,\n\t\t\tsearch   : obj.search   || \"\",\n\t\t\thash     : obj.hash     || \"\",\n\t\t\thost     : obj.host     || host\n\t\t};\n\n\t\t// 'cause IE is ... IE; required for data.batch()\n\t\tif ( client.ie ) {\n\t\t\tif ( parsed.protocol === \":\" ) {\n\t\t\t\tparsed.protocol = location.protocol;\n\t\t\t}\n\n\t\t\tif ( string.isEmpty( parsed.hostname ) ) {\n\t\t\t\tparsed.hostname = location.hostname;\n\t\t\t}\n\n\t\t\tif ( string.isEmpty( parsed.host ) ) {\n\t\t\t\tparsed.host = location.host;\n\t\t\t}\n\n\t\t\tif ( parsed.pathname.charAt( 0 ) !== \"/\" ) {\n\t\t\t\tparsed.pathname = \"/\" + parsed.pathname;\n\t\t\t}\n\t\t}\n\n\t\tparsed.auth  = obj.auth || ( parsed.auth === null ? \"\" : parsed.auth[1] );\n\t\tparsed.href  = obj.href || ( parsed.protocol + \"//\" + ( string.isEmpty( parsed.auth ) ? \"\" : parsed.auth + \"@\" ) + parsed.host + parsed.pathname + parsed.search + parsed.hash );\n\t\tparsed.path  = obj.path || parsed.pathname + parsed.search;\n\t\tparsed.query = utility.queryString( null, parsed.search );\n\n\t\treturn parsed;\n\t},\n\n\t/**\n\t * Creates a partially applied Function\n\t *\n\t * @method partial\n\t * @memberOf utility\n\t * @return {Function} Partial Function\n\t * @example\n\t * function f ( a, b ) {\n\t *   return a + b;\n\t * }\n\t *\n\t * var g = keigai.util.partial( f, 2 );\n\t *\n\t * g( 2 ); // 4\n\t */\n\tpartial : function () {\n\t\tvar args = array.cast( arguments ),\n\t\t    fn   = args.shift();\n\n\t\treturn function () {\n\t\t\treturn fn.apply( fn, args.concat( array.cast( arguments ) ) );\n\t\t};\n\t},\n\n\t/**\n\t * Prevents default behavior of an Event\n\t *\n\t * @method prevent\n\t * @memberOf utility\n\t * @param  {Object} ev Event\n\t * @return {Object}    Event\n\t * @example\n\t * keigai.util.prevent( Event );\n\t */\n\tprevent : function ( ev ) {\n\t\tif ( typeof ev.preventDefault == \"function\" ) {\n\t\t\tev.preventDefault();\n\t\t}\n\n\t\treturn ev;\n\t},\n\n\t/**\n\t * Parses a query string & coerces values\n\t *\n\t * @method queryString\n\t * @memberOf utility\n\t * @param  {String} arg     [Optional] Key to find in the querystring\n\t * @param  {String} qstring [Optional] Query string to parse\n\t * @return {Mixed}          Value or Object of key:value pairs\n\t * @private\n\t */\n\tqueryString : function ( arg, qstring ) {\n\t\tvar obj    = {},\n\t\t    result = qstring !== undefined ? ( qstring.indexOf( \"?\" ) > -1 ? qstring.replace( /.*\\?/, \"\" ) : null ) : ( server || string.isEmpty( location.search ) ? null : location.search.replace( \"?\", \"\" ) );\n\n\t\tif ( result !== null && !string.isEmpty( result ) ) {\n\t\t\tresult = result.split( \"&\" );\n\t\t\tarray.each( result, function ( prop ) {\n\t\t\t\tvar item = prop.split( \"=\" );\n\n\t\t\t\tif ( string.isEmpty( item[0] ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif ( item[1] === undefined ) {\n\t\t\t\t\titem[1] = \"\";\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\titem[1] = utility.coerce( decodeURIComponent( item[1] ) );\n\t\t\t\t}\n\n\t\t\t\tif ( obj[item[0]] === undefined ) {\n\t\t\t\t\tobj[item[0]] = item[1];\n\t\t\t\t}\n\t\t\t\telse if ( !( obj[item[0]] instanceof Array ) ) {\n\t\t\t\t\tobj[item[0]] = [obj[item[0]]];\n\t\t\t\t\tobj[item[0]].push( item[1] );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tobj[item[0]].push( item[1] );\n\t\t\t\t}\n\t\t\t} );\n\t\t}\n\n\t\tif ( arg !== null && arg !== undefined ) {\n\t\t\tobj = obj[arg];\n\t\t}\n\n\t\treturn obj;\n\t},\n\n\t/**\n\t * Accepts Deferreds or Promises as arguments, or an Array of either\n\t *\n\t * @method race\n\t * @memberOf utility\n\t * @return {Object} {@link keigai.Deferred}\n\t * @example\n\t * var deferreds = [],\n\t *     defer1    = keigai.util.defer(),\n\t *     defer2    = keigai.util.defer();\n\t *\n\t * deferreds.push( defer1 );\n\t * deferreds.push( defer2 );\n\t *\n\t * // Executes when one deferred is resolved or rejected\n\t * keigai.util.race( deferreds ).then( function ( arg ) ) {\n\t *   ...\n\t * }, function ( err ) {\n\t *   ...\n\t * } );\n\t *\n\t * ...\n\t *\n\t * defer1.resolve( true );\n\t * defer2.resolve( true );\n\t */\n\trace : function () {\n\t\tvar defer = deferred.factory(),\n\t\t    args  = array.cast( arguments );\n\n\t\t// Did we receive an Array? if so it overrides any other arguments\n\t\tif ( args[0] instanceof Array ) {\n\t\t\targs = args[0];\n\t\t}\n\n\t\t// None, end on next tick\n\t\tif ( args.length === 0 ) {\n\t\t\tdefer.resolve( null );\n\t\t}\n\t\t// Setup and wait\n\t\telse {\n\t\t\tPromise.race( args ).then( function ( results ) {\n\t\t\t\tdefer.resolve( results );\n\t\t\t}, function ( e ) {\n\t\t\t\tdefer.reject( e );\n\t\t\t} );\n\t\t}\n\n\t\treturn defer;\n\t},\n\n\t/**\n\t * Asynchronous DOM rendering (cannot be cancelled, suggested for reactive behavior)\n\t *\n\t * @method render\n\t * @memberOf utility\n\t * @param  {Function} fn Function to execute on next 'frame'\n\t * @return {Object} {@link keigai.Deferred}\n\t * @example\n\t * keigai.util.render( function () {\n\t *     return keitai.util.element.html( document.querySelector( \"#id\" ), \"Hello World\" )\n\t * } ).then( function ( arg ) {\n\t *     // arg is the return value of your function\n\t * }, function ( e ) {\n\t *     // Handle e\n\t * } );\n\t */\n\trender : function ( fn ) {\n\t\tvar defer = deferred.factory();\n\n\t\tRENDER( function ( arg ) {\n\t\t\ttry {\n\t\t\t\tdefer.resolve( fn( arg ) );\n\t\t\t}\n\t\t\tcatch ( e ) {\n\t\t\t\tdefer.reject( e );\n\t\t\t}\n\t\t} );\n\n\t\treturn defer;\n\t},\n\n\t/**\n\t * Creates a recursive function. Return false from the function to halt recursion.\n\t *\n\t * @method repeat\n\t * @memberOf utility\n\t * @param  {Function} fn  Function to execute repeatedly\n\t * @param  {Number}   ms  Milliseconds to stagger the execution\n\t * @param  {String}   id  [Optional] Timeout ID\n\t * @param  {Boolean}  now Executes `fn` and then setup repetition, default is `true`\n\t * @return {String}       Timeout ID\n\t * @example\n\t * keigai.util.repeat( function () {\n\t *   ...\n\t *\n\t *   // Cancelling repetition at some point in the future\n\t *   if ( someCondition ) {\n\t *     return false;\n\t *   }\n\t * }, 1000, \"repeating\" );\n\t */\n\trepeat : function ( fn, ms, id, now ) {\n\t\tms  = ms || 10;\n\t\tid  = id || utility.uuid( true );\n\t\tnow = ( now !== false );\n\n\t\t// Could be valid to return false from initial execution\n\t\tif ( now && fn() === false ) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Creating repeating execution\n\t\tutility.defer( function () {\n\t\t\tvar recursive = function ( fn, ms, id ) {\n\t\t\t\tvar recursive = this;\n\n\t\t\t\tif ( fn() !== false ) {\n\t\t\t\t\tutility.repeating[id] = setTimeout( function () {\n\t\t\t\t\t\trecursive.call( recursive, fn, ms, id );\n\t\t\t\t\t}, ms );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tdelete utility.repeating[id];\n\t\t\t\t}\n\t\t\t};\n\n\t\t\trecursive.call( recursive, fn, ms, id );\n\t\t}, ms, id, true );\n\n\t\treturn id;\n\t},\n\n\t/**\n\t * Stops an Event from bubbling, & prevents default behavior\n\t *\n\t * @method stop\n\t * @memberOf utility\n\t * @param  {Object} ev Event\n\t * @return {Object}    Event\n\t * @example\n\t * keigai.util.stop( Event );\n\t */\n\tstop : function ( ev ) {\n\t\tif ( typeof ev.stopPropagation == \"function\" ) {\n\t\t\tev.stopPropagation();\n\t\t}\n\n\t\tutility.prevent( ev );\n\n\t\treturn ev;\n\t},\n\n\t/**\n\t * Returns the Event target\n\t *\n\t * @method target\n\t * @memberOf utility\n\t * @param  {Object} ev Event\n\t * @return {Object}    Event target\n\t * @example\n\t * var target = keigai.util.target( Event );\n\t */\n\ttarget : function ( ev ) {\n\t\treturn ev.target || ev.srcElement;\n\t},\n\n\t/**\n\t * Generates a version 4 UUID\n\t *\n\t * @method uuid\n\t * @memberOf utility\n\t * @param  {Boolean} strip [Optional] Strips - from UUID\n\t * @return {String}        UUID\n\t * @example\n\t * var uuid4 = keigai.util.uuid();\n\t */\n\tuuid : function ( strip ) {\n\t\tvar s = function () { return ( ( ( 1 + Math.random() ) * 0x10000 ) | 0 ).toString( 16 ).substring( 1 ); },\n\t\t    r = [8, 9, \"a\", \"b\"],\n\t\t    o;\n\n\t\to = ( s() + s() + \"-\" + s() + \"-4\" + s().substr( 0, 3 ) + \"-\" + r[Math.floor( Math.random() * 4 )] + s().substr( 0, 3 ) + \"-\" + s() + s() + s() );\n\n\t\tif ( strip === true ) {\n\t\t\to = o.replace( /-/g, \"\" );\n\t\t}\n\n\t\treturn o;\n\t},\n\n\t/**\n\t * Walks `obj` and returns `arg`, for when you can't easily access `arg`\n\t *\n\t * @method  walk\n\t * @memberOf utility\n\t * @param  {Mixed}  obj  Object or Array\n\t * @param  {String} arg  String describing the property to return\n\t * @return {Mixed}       Target or undefined\n\t * @example\n\t * var obj = {a: [{b: true}]};\n\t *\n\t * keigai.util.walk( obj, \"a[0].b\" ); // true\n\t */\n\twalk : function ( obj, arg ) {\n\t\tvar output = obj;\n\n\t\tarray.each( arg.replace( /\\]$/, \"\" ).replace( /\\]/g, \".\" ).replace( /\\.\\./g, \".\" ).split( /\\.|\\[/ ), function ( i ) {\n\t\t\tif ( output[i] === undefined || output[i] === null ) {\n\t\t\t\toutput = undefined;\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\toutput = output[i];\n\t\t} );\n\n\t\treturn output;\n\t},\n\n\t/**\n\t * Accepts Deferreds or Promises as arguments, or an Array of either\n\t *\n\t * @method when\n\t * @memberOf utility\n\t * @return {Object} {@link keigai.Deferred}\n\t * @example\n\t * var deferreds = [],\n\t *     defer1    = keigai.util.defer(),\n\t *     defer2    = keigai.util.defer();\n\t *\n\t * deferreds.push( defer1 );\n\t * deferreds.push( defer2 );\n\t *\n\t * // Executes when both deferreds have resolved or one has rejected\n\t * keigai.util.when( deferreds ).then( function ( args ) ) {\n\t *   ...\n\t * }, function ( err ) {\n\t *   ...\n\t * } );\n\t *\n\t * ...\n\t *\n\t * defer1.resolve( true );\n\t * defer2.resolve( true );\n\t */\n\twhen : function () {\n\t\tvar defer = deferred.factory(),\n\t\t    args  = array.cast( arguments );\n\n\t\t// Did we receive an Array? if so it overrides any other arguments\n\t\tif ( args[0] instanceof Array ) {\n\t\t\targs = args[0];\n\t\t}\n\n\t\t// None, end on next tick\n\t\tif ( args.length === 0 ) {\n\t\t\tdefer.resolve( null );\n\t\t}\n\t\t// Setup and wait\n\t\telse {\n\t\t\tPromise.all( args ).then( function ( results ) {\n\t\t\t\tdefer.resolve( results );\n\t\t\t}, function ( e ) {\n\t\t\t\tdefer.reject( e );\n\t\t\t} );\n\t\t}\n\n\t\treturn defer;\n\t},\n\n\t/**\n\t * Worker factory\n\t *\n\t * @method worker\n\t * @memberOf utility\n\t * @param  {Object} defer Deferred to receive message from Worker\n\t * @return {Object}       Worker\n\t * @private\n\t */\n\tworker : function ( defer ) {\n\t\tvar obj = new Worker( WORKER );\n\n\t\tobj.onerror = function ( err ) {\n\t\t\tdefer.reject( err );\n\t\t\tobj.terminate();\n\t\t};\n\n\t\tobj.onmessage = function ( ev ) {\n\t\t\tdefer.resolve( ev.data );\n\t\t\tobj.terminate();\n\t\t};\n\n\t\treturn obj;\n\t}\n};\n\n/**\n * XMLHttpRequest shim for node.js\n *\n * @method xhr\n * @private\n * @return {Object} XMLHttpRequest instance\n */\nfunction xhr () {\n\tvar UNSENT           = 0,\n\t    OPENED           = 1,\n\t    HEADERS_RECEIVED = 2,\n\t    LOADING          = 3,\n\t    DONE             = 4,\n\t    ERR_REFUSED      = /ECONNREFUSED/,\n\t    ready            = new RegExp( HEADERS_RECEIVED + \"|\" + LOADING ),\n\t    XMLHttpRequest, headers, dispatch, success, failure, state;\n\n\theaders = {\n\t\t\"user-agent\"   : \"keigai/1.0.3 node.js/\" + process.versions.node.replace( /^v/, \"\" ) + \" (\" + string.capitalize( process.platform ) + \" V8/\" + process.versions.v8 + \" )\",\n\t\t\"content-type\" : \"text/plain\",\n\t\t\"accept\"       : \"*/*\"\n\t};\n\n\t/**\n\t * Dispatches an event\n\t *\n\t * @method dispatch\n\t * @memberOf xhr\n\t * @param  {String} arg Event to dispatch\n\t * @return {Object}     XMLHttpRequest instance\n\t */\n\tdispatch = function ( arg ) {\n\t\tvar fn = \"on\" + arg;\n\n\t\tif ( typeof this[fn] == \"function\" ) {\n\t\t\tthis[fn]();\n\t\t}\n\n\t\tthis.dispatchEvent( arg );\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Changes the readyState of an XMLHttpRequest\n\t *\n\t * @method state\n\t * @memberOf xhr\n\t * @param  {String} arg New readyState\n\t * @return {Object}     XMLHttpRequest instance\n\t */\n\tstate = function ( arg ) {\n\t\tif ( this.readyState !== arg ) {\n\t\t\tthis.readyState = arg;\n\t\t\tdispatch.call( this, \"readystatechange\" );\n\n\t\t\tif ( this.readyState === DONE && !this._error ) {\n\t\t\t\tdispatch.call( this, \"load\" );\n\t\t\t\tdispatch.call( this, \"loadend\" );\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Response handler\n\t *\n\t * @method success\n\t * @memberOf xhr\n\t * @param  {Object} res HTTP(S) Response Object\n\t * @return {Undefined}  undefined\n\t */\n\tsuccess = function ( res ) {\n\t\tvar self = this;\n\n\t\tstate.call( this, HEADERS_RECEIVED );\n\t\tthis.status      = res.statusCode;\n\t\tthis._resheaders = res.headers;\n\n\t\tif ( this._resheaders[\"set-cookie\"] && this._resheaders[\"set-cookie\"] instanceof Array ) {\n\t\t\tthis._resheaders[\"set-cookie\"] = this._resheaders[\"set-cookie\"].join( \";\" );\n\t\t}\n\n\t\tres.on( \"data\", function ( arg ) {\n\t\t\tres.setEncoding( \"utf8\" );\n\n\t\t\tif ( self._send ) {\n\t\t\t\tif ( arg ) {\n\t\t\t\t\tself.responseText += arg;\n\t\t\t\t}\n\n\t\t\t\tstate.call( self, LOADING );\n\t\t\t}\n\t\t} );\n\n\t\tres.on( \"end\", function () {\n\t\t\tif ( self._send ) {\n\t\t\t\tstate.call( self, DONE );\n\t\t\t\tself._send = false;\n\t\t\t}\n\t\t} );\n\t};\n\n\t/**\n\t * Response error handler\n\t *\n\t * @method failure\n\t * @memberOf xhr\n\t * @param  {Object} e Error\n\t * @return {Undefined} undefined\n\t */\n\tfailure = function ( e ) {\n\t\tthis.status       = ERR_REFUSED.test( e.message ) ? 503 : 500;\n\t\tthis.statusText   = \"\";\n\t\tthis.responseText = e.message;\n\t\tthis._error       = true;\n\t\tthis._send        = false;\n\t\tdispatch.call( this, \"error\" );\n\t\tstate.call( this, DONE );\n\t};\n\n\t/**\n\t * Creates a new XMLHttpRequest\n\t *\n\t * @constructor\n\t * @private\n\t * @memberOf xhr\n\t * @return {Object} XMLHttpRequest instance\n\t */\n\tXMLHttpRequest = function () {\n\t\tthis.onabort            = null;\n\t\tthis.onerror            = null;\n\t\tthis.onload             = null;\n\t\tthis.onloadend          = null;\n\t\tthis.onloadstart        = null;\n\t\tthis.onreadystatechange = null;\n\t\tthis.readyState         = UNSENT;\n\t\tthis.response           = null;\n\t\tthis.responseText       = \"\";\n\t\tthis.responseType       = \"\";\n\t\tthis.responseXML        = null;\n\t\tthis.status             = UNSENT;\n\t\tthis.statusText         = \"\";\n\t\tthis.observer           = observable.factory();\n\n\t\t// Psuedo private for prototype chain\n\t\tthis._error             = false;\n\t\tthis._headers           = {};\n\t\tthis._params            = {};\n\t\tthis._request           = null;\n\t\tthis._resheaders        = {};\n\t\tthis._send              = false;\n\t};\n\n\t/**\n\t * Extending Base\n\t *\n\t * @memberOf keigai.XMLHttpRequest\n\t * @type {Object} {@link keigai.Base}\n\t */\n\tXMLHttpRequest.prototype = base.factory();\n\n\t/**\n\t * Setting constructor loop\n\t *\n\t * @method constructor\n\t * @memberOf keigai.XMLHttpRequest\n\t * @type {Function}\n\t * @private\n\t */\n\tXMLHttpRequest.prototype.constructor = XMLHttpRequest;\n\n\t/**\n\t * Aborts a request\n\t *\n\t * @method abort\n\t * @memberOf XMLHttpRequest\n\t * @return {Object} XMLHttpRequest instance\n\t */\n\tXMLHttpRequest.prototype.abort = function () {\n\t\tif ( this._request !== null ) {\n\t\t\tthis._request.abort();\n\t\t\tthis._request     = null;\n\t\t\tthis.responseText = \"\";\n\t\t\tthis.responseXML  = \"\";\n\t\t\tthis._error       = true;\n\t\t\tthis._headers     = {};\n\n\t\t\tif ( this._send === true || ready.test( this.readyState ) ) {\n\t\t\t\tthis._send = false;\n\t\t\t\tstate.call( this, DONE );\n\t\t\t}\n\n\t\t\tdispatch.call( this, \"abort\" );\n\t\t\tthis.readyState = UNSENT;\n\t\t}\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Gets all response headers\n\t *\n\t * @method getAllResponseHeaders\n\t * @memberOf XMLHttpRequest\n\t * @return {Object} Response headers\n\t */\n\tXMLHttpRequest.prototype.getAllResponseHeaders = function () {\n\t\tvar result = \"\";\n\n\t\tif ( this.readyState < HEADERS_RECEIVED ) {\n\t\t\tthrow new Error( label.invalidStateNoHeaders );\n\t\t}\n\n\t\tutility.iterate( this._resheaders, function ( v, k ) {\n\t\t\tresult += k + \": \" + v + \"\\n\";\n\t\t} );\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * Gets a specific response header\n\t *\n\t * @method getResponseHeader\n\t * @memberOf XMLHttpRequest\n\t * @param  {String} header Header to get\n\t * @return {String}        Response header value\n\t */\n\tXMLHttpRequest.prototype.getResponseHeader = function ( header ) {\n\t\tvar result;\n\n\t\tif ( this.readyState < HEADERS_RECEIVED || this._error ) {\n\t\t\tthrow new Error( label.invalidStateNoHeaders );\n\t\t}\n\n\t\tresult = this._resheaders[header] || this._resheaders[header.toLowerCase()];\n\n\t\treturn result;\n\t};\n\n\t/**\n\t * Prepares an XMLHttpRequest instance to make a request\n\t *\n\t * @method open\n\t * @memberOf XMLHttpRequest\n\t * @param  {String}  method   HTTP method\n\t * @param  {String}  url      URL to receive request\n\t * @param  {Boolean} async    [Optional] Asynchronous request\n\t * @param  {String}  user     [Optional] Basic auth username\n\t * @param  {String}  password [Optional] Basic auth password\n\t * @return {Object}           XMLHttpRequest instance\n\t */\n\tXMLHttpRequest.prototype.open = function ( method, url, async, user, password ) {\n\t\tvar self = this;\n\n\t\tif ( async !== true ) {\n\t\t\tthrow new Error( label.invalidStateNoSync );\n\t\t}\n\n\t\tthis.abort();\n\t\tthis._error  = false;\n\t\tthis._params = {\n\t\t\tmethod   : method,\n\t\t\turl      : url,\n\t\t\tasync    : async    || true,\n\t\t\tuser     : user     || null,\n\t\t\tpassword : password || null\n\t\t};\n\n\t\tutility.iterate( headers, function ( v, k ) {\n\t\t\tself._headers[k] = v;\n\t\t} );\n\n\t\tthis.readyState = OPENED;\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Overrides the Content-Type of the request\n\t *\n\t * @method overrideMimeType\n\t * @memberOf XMLHttpRequest\n\t * @param  {String} mime Mime type of the request ( media type )\n\t * @return {Object}      XMLHttpRequest instance\n\t */\n\tXMLHttpRequest.prototype.overrideMimeType = function ( mime ) {\n\t\tthis._headers[\"content-type\"] = mime;\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Sends an XMLHttpRequest request\n\t *\n\t * @method send\n\t * @memberOf XMLHttpRequest\n\t * @param  {Mixed} data [Optional] Payload to send with the request\n\t * @return {Object}     XMLHttpRequest instance\n\t */\n\tXMLHttpRequest.prototype.send = function ( data ) {\n\t\tdata     = data || null;\n\t\tvar self = this,\n\t\t    options, parsed, request, obj;\n\n\t\tif ( this.readyState < OPENED ) {\n\t\t\tthrow new Error( label.invalidStateNotOpen );\n\t\t}\n\t\telse if ( this._send ) {\n\t\t\tthrow new Error( label.invalidStateNotSending );\n\t\t}\n\n\t\tparsed      = utility.parse( this._params.url );\n\t\tparsed.port = parsed.port || ( parsed.protocol === \"https:\" ? 443 : 80 );\n\n\t\tif ( this._params.user !== null && this._params.password !== null ) {\n\t\t\tparsed.auth = this._params.user + \":\" + this._params.password;\n\t\t}\n\n\t\t// Specifying Content-Length accordingly\n\t\tif ( regex.put_post.test( this._params.method ) ) {\n\t\t\tif ( data === null ) {\n\t\t\t\tthis._headers[\"content-length\"] = 0;\n\t\t\t}\n\t\t\telse if ( typeof data == \"string\" ) {\n\t\t\t\tthis._headers[\"content-length\"] = Buffer.byteLength( data );\n\t\t\t}\n\t\t\telse if ( data instanceof Buffer || typeof data.toString == \"function\" ) {\n\t\t\t\tdata = data.toString();\n\t\t\t\tthis._headers[\"content-length\"] = Buffer.byteLength( data );\n\t\t\t}\n\t\t\telse {\n\t\t\t\tthrow new Error( label.invalidArguments );\n\t\t\t}\n\t\t}\n\n\t\tthis._headers.host = parsed.host;\n\n\t\tif ( this._headers[\"x-requested-with\"] === \"XMLHttpRequest\" ) {\n\t\t\tdelete this._headers[\"x-requested-with\"];\n\t\t}\n\n\t\toptions = {\n\t\t\thostname : parsed.hostname,\n\t\t\tpath     : parsed.path,\n\t\t\tport     : parsed.port,\n\t\t\tmethod   : this._params.method,\n\t\t\theaders  : this._headers\n\t\t};\n\n\t\tif ( parsed.protocol === \"https:\" ) {\n\t\t\toptions.rejectUnauthorized = false;\n\t\t\toptions.agent              = false;\n\t\t}\n\n\t\tif ( parsed.auth ) {\n\t\t\toptions.auth = parsed.auth;\n\t\t}\n\n\t\tthis._send = true;\n\t\tdispatch.call( this, \"readystatechange\" );\n\n\t\tobj = parsed.protocol === \"http:\" ? http : https;\n\n\t\trequest = obj.request( options, function ( arg ) {\n\t\t\tsuccess.call( self, arg );\n\t\t} ).on( \"error\", function ( e ) {\n\t\t\tfailure.call( self, e );\n\t\t} );\n\n\t\tdata === null ? request.setSocketKeepAlive( true ) : request.write( data, \"utf8\" );\n\t\tthis._request = request;\n\t\trequest.end();\n\n\t\tdispatch.call( this, \"loadstart\" );\n\n\t\treturn this;\n\t};\n\n\t/**\n\t * Sets a request header of an XMLHttpRequest instance\n\t *\n\t * @method setRequestHeader\n\t * @memberOf XMLHttpRequest\n\t * @param {String} header HTTP header\n\t * @param {String} value  Header value\n\t * @return {Object}       XMLHttpRequest instance\n\t */\n\tXMLHttpRequest.prototype.setRequestHeader = function ( header, value ) {\n\t\tif ( this.readyState !== OPENED ) {\n\t\t\tthrow new Error( label.invalidStateNotUsable );\n\t\t}\n\t\telse if ( this._send ) {\n\t\t\tthrow new Error( label.invalidStateNotSending );\n\t\t}\n\n\t\tthis._headers[header.toLowerCase()] = value;\n\n\t\treturn this;\n\t};\n\n\treturn XMLHttpRequest;\n}\n\n/**\n * @namespace xml\n * @private\n */\nvar xml = {\n\t/**\n\t * Returns XML (Document) Object from a String\n\t *\n\t * @method decode\n\t * @memberOf xml\n\t * @param  {String} arg XML String\n\t * @return {Object}     XML Object or undefined\n\t */\n\tdecode : function ( arg ) {\n\t\tif ( typeof arg != \"string\" || string.isEmpty( arg ) ) {\n\t\t\tthrow new Error( label.invalidArguments );\n\t\t}\n\n\t\treturn new DOMParser().parseFromString( arg, \"text/xml\" );\n\t},\n\n\t/**\n\t * Returns XML String from an Object or Array\n\t *\n\t * @method encode\n\t * @memberOf xml\n\t * @param  {Mixed} arg Object or Array to cast to XML String\n\t * @return {String}    XML String or undefined\n\t */\n\tencode : function ( arg, wrap ) {\n\t\ttry {\n\t\t\tif ( arg === undefined ) {\n\t\t\t\tthrow new Error( label.invalidArguments );\n\t\t\t}\n\n\t\t\twrap    = ( wrap !== false );\n\t\t\tvar x   = wrap ? \"<xml>\" : \"\",\n\t\t\t    top = ( arguments[2] !== false ),\n\t\t\t    node;\n\n\t\t\t/**\n\t\t\t * Encodes a value as a node\n\t\t\t *\n\t\t\t * @method node\n\t\t\t * @memberOf xml.encode\n\t\t\t * @private\n\t\t\t * @param  {String} name  Node name\n\t\t\t * @param  {String} value Node value\n\t\t\t * @return {String}       Node\n\t\t\t */\n\t\t\tnode = function ( name, value ) {\n\t\t\t\tvar output = \"<n>v</n>\";\n\n\t\t\t\toutput = output.replace( \"v\", ( regex.cdata.test( value ) ? \"<![CDATA[\" + value + \"]]>\" : value ) );\n\t\t\t\treturn output.replace(/<(\\/)?n>/g, \"<$1\" + name + \">\");\n\t\t\t};\n\n\t\t\tif ( arg !== null && arg.xml ) {\n\t\t\t\targ = arg.xml;\n\t\t\t}\n\n\t\t\tif ( arg instanceof Document ) {\n\t\t\t\targ = ( new XMLSerializer() ).serializeToString( arg );\n\t\t\t}\n\n\t\t\tif ( regex.boolean_number_string.test( typeof arg ) ) {\n\t\t\t\tx += node( \"item\", arg );\n\t\t\t}\n\t\t\telse if ( typeof arg == \"object\" ) {\n\t\t\t\tutility.iterate( arg, function ( v, k ) {\n\t\t\t\t\tx += xml.encode( v, ( typeof v == \"object\" ), false ).replace( /item|xml/g, isNaN( k ) ? k : \"item\" );\n\t\t\t\t} );\n\t\t\t}\n\n\t\t\tx += wrap ? \"</xml>\" : \"\";\n\n\t\t\tif ( top ) {\n\t\t\t\tx = \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF8\\\"?>\" + x;\n\t\t\t}\n\n\t\t\treturn x;\n\t\t}\n\t\tcatch ( e ) {\n\t\t\tutility.error( e, arguments, this );\n\n\t\t\treturn undefined;\n\t\t}\n\t},\n\n\t/**\n\t * Validates `arg` is XML\n\t *\n\t * @method valid\n\t * @memberOf xml\n\t * @param  {String} arg String to validate\n\t * @return {Boolean}    `true` if valid XML\n\t */\n\tvalid : function ( arg ) {\n\t\treturn ( xml.decode( arg ).getElementsByTagName( \"parsererror\" ).length === 0 );\n\t}\n};\n\n/**\n * Bootstraps environment\n *\n * @method bootstrap\n * @private\n * @return {Undefined} undefined\n */\nfunction bootstrap () {\n\t// Describing the Client\n\tif ( !server ) {\n\t\tclient.version = client.version();\n\n\t\t// IE8 and older is not supported\n\t\tif ( client.ie && client.version < 9 ) {\n\t\t\tthrow new Error( label.upgrade );\n\t\t}\n\n\t\t// getElementsByClassName shim for IE9\n\t\tif ( Element.prototype.getElementsByClassName === undefined ) {\n\t\t\tElement.prototype.getElementsByClassName = function ( arg ) {\n\t\t\t\treturn document.querySelectorAll( \".\" + arg );\n\t\t\t};\n\t\t}\n\n\t\t// classList shim for IE9\n\t\tif ( !document.documentElement.classList ) {\n\t\t\t( function ( view ) {\n\t\t\t\tvar ClassList, getter, proto, target, descriptor;\n\n\t\t\t\tif ( !( \"HTMLElement\" in view ) && !( \"Element\" in view ) ) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tClassList = function ( obj ) {\n\t\t\t\t\tvar classes = string.explode( obj.className, \" \" ),\n\t\t\t\t\t    self    = this;\n\n\t\t\t\t\tarray.each( classes, function ( i ) {\n\t\t\t\t\t\tself.push( i );\n\t\t\t\t\t} );\n\n\t\t\t\t\tthis.updateClassName = function () {\n\t\t\t\t\t\tobj.className = this.join( \" \" );\n\t\t\t\t\t};\n\t\t\t\t};\n\n\t\t\t\tgetter = function () {\n\t\t\t\t\treturn new ClassList( this );\n\t\t\t\t};\n\n\t\t\t\tproto  = ClassList.prototype = [];\n\t\t\t\ttarget = ( view.HTMLElement || view.Element ).prototype;\n\n\t\t\t\tproto.add = function ( arg ) {\n\t\t\t\t\tif ( !array.contains( this, arg ) ) {\n\t\t\t\t\t\tthis.push( arg );\n\t\t\t\t\t\tthis.updateClassName();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tproto.contains = function ( arg ) {\n\t\t\t\t\treturn array.contains( this, arg );\n\t\t\t\t};\n\n\t\t\t\tproto.remove = function ( arg ) {\n\t\t\t\t\tif ( array.contains( this, arg ) ) {\n\t\t\t\t\t\tarray.remove( this, arg );\n\t\t\t\t\t\tthis.updateClassName();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tproto.toggle = function ( arg ) {\n\t\t\t\t\tarray[array.contains( this, arg ) ? \"remove\" : \"add\"]( this, arg );\n\t\t\t\t\tthis.updateClassName();\n\t\t\t\t};\n\n\t\t\t\tif ( Object.defineProperty ) {\n\t\t\t\t\tdescriptor = {\n\t\t\t\t\t\tget          : getter,\n\t\t\t\t\t\tenumerable   : true,\n\t\t\t\t\t\tconfigurable : true\n\t\t\t\t\t};\n\n\t\t\t\t\tObject.defineProperty( target, \"classList\", descriptor );\n\t\t\t\t}\n\t\t\t\telse if ( Object.prototype.__defineGetter__) {\n\t\t\t\t\ttarget.__defineGetter__( \"classList\", getter );\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tthrow new Error( \"Could not create classList shim\" );\n\t\t\t\t}\n\t\t\t} )( global );\n\t\t}\n\t}\n\telse {\n\t\t// XHR shim\n\t\tXMLHttpRequest = xhr();\n\t}\n\n\t// Caching functions\n\thas   = Object.prototype.hasOwnProperty;\n\tslice = Array.prototype.slice;\n\n\t// DataStore Worker \"script\"\n\tif ( webWorker ) {\n\t\tWORKER = global.URL.createObjectURL( utility.blob( \"var \" + string.fromObject( array, \"array\" ) + \", \" + string.fromObject( regex, \"regex\" ) + \", \" + string.fromObject( string, \"string\" ) + \", \" + string.fromObject( utility, \"utility\" ) + \"; onmessage = \" + store.worker.toString() + \";\" ) );\n\t}\n\n\tTIME = new Date().getTime();\n\n\t// Setting up `utility.render()`\n\tRENDER = global.requestAnimationFrame || function ( fn ) {\n\t\tvar offset = new Date().getTime() - TIME;\n\n\t\tutility.defer( function () {\n\t\t\tfn( offset );\n\t\t}, 16, offset );\n\t};\n}\n\n// Bootstrapping\nbootstrap();\n\n// Interface\nreturn {\n\tfilter  : filter.factory,\n\tlist    : list.factory,\n\tgrid    : grid.factory,\n\tstore   : store.factory,\n\tutil    : {\n\t\t$        : utility.$,\n\t\tarray    : array,\n\t\tbase     : utility.base,\n\t\tclone    : utility.clone,\n\t\tcoerce   : utility.coerce,\n\t\tcurry    : utility.curry,\n\t\tcsv      : csv,\n\t\tdefer    : deferred.factory,\n\t\tdelay    : utility.defer,\n\t\telement  : element,\n\t\textend   : utility.extend,\n\t\tgenId    : utility.genId,\n\t\titerate  : utility.iterate,\n\t\tjson     : json,\n\t\tjsonp    : client.jsonp,\n\t\tlog      : utility.log,\n\t\tlru      : lru.factory,\n\t\tmath     : math,\n\t\tmerge    : utility.merge,\n\t\tnumber   : number,\n\t\tobserver : observable.factory,\n\t\tparse    : utility.parse,\n\t\tpartial  : utility.partial,\n\t\tprevent  : utility.prevent,\n\t\trace     : utility.race,\n\t\trender   : utility.render,\n\t\trepeat   : utility.repeat,\n\t\trequest  : client.request,\n\t\tstop     : utility.stop,\n\t\tstring   : string,\n\t\ttarget   : utility.target,\n\t\tuuid     : utility.uuid,\n\t\twalk     : utility.walk,\n\t\twhen     : utility.when\n\t},\n\tversion : \"1.0.3\"\n};\n} )();\n\n// Node, AMD & window supported\nif ( typeof exports != \"undefined\" ) {\n\tmodule.exports = lib;\n}\nelse if ( typeof define == \"function\" ) {\n\tdefine( function () {\n\t\treturn lib;\n\t} );\n}\nelse {\n\tglobal.keigai = lib;\n}\n} )( this );\n"]}